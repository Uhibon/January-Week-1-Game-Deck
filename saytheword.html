<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Say the Word – January Week 1</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530; --ink:#fff; --gold:#ffd166; --green:#22c55e; --red:#ef4444; --purple:#a855f7;
  --outline:#ffffff26; --radius:26px; --micSize:56px; --barH:96px;
  --goldGlow:0 0 8px #facc15,0 0 20px #fde68a;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  min-height:100%;
  background:var(--bg);
  color:var(--ink);
  font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  display:flex;flex-direction:column;align-items:center;
}
header{text-align:center;padding:20px 16px 10px}
header h1{font-family:'Cinzel',serif;letter-spacing:.5px;font-size:clamp(1.8rem,5.2vw,2.6rem);}
header h2{font-family:'Cinzel',serif;letter-spacing:1px;margin-top:6px;font-size:clamp(2.0rem,6.2vw,3rem);}
.subtitle-stack{display:flex;justify-content:center;align-items:center;gap:.4rem;font-weight:700;font-size:clamp(1.05rem,3vw,1.3rem);line-height:1.2;}
.subtitle-stack .en{font-family:'Cinzel',serif;}
.subtitle-stack .jp{font-family:'Noto Sans JP',sans-serif;}
.subtitle-stack .en::after{content:" – ";opacity:.8}
hr.sep{border:0;height:1px;background:linear-gradient(90deg,transparent,#ffffff33,transparent);margin:12px 0 8px}
footer{margin-top:auto;padding:14px 10px;opacity:.9;font-size:1rem;font-family:'Cinzel',serif}
.page{width:100%;max-width:980px;margin:0 auto;display:none;padding:8px 16px 28px}
.page.active{display:block}
#page-game{display:flex;flex-direction:column;align-items:center;margin-top:30px;gap:28px;}
.stripeBar{position:relative;width:min(560px,90vw);height:var(--barH);border-radius:30px;overflow:hidden;margin:0 auto 24px auto;box-shadow:0 8px 24px rgba(0,0,0,.25), inset 0 0 0 4px rgba(255,255,255,.08);}
.stripeInner{position:absolute;inset:0;background-size:100% var(--barH);animation:stripesV 3.2s linear infinite;filter:saturate(1.05) brightness(1.08)}
@keyframes stripesV{from{background-position:0 0}to{background-position:0 var(--barH)}}
.sv1{background-image:repeating-linear-gradient(0deg,#ff7eb9 0 18px,#5ee6ff 18px 36px,#ffd166 36px 54px)}
.sv2{background-image:repeating-linear-gradient(0deg,#a78bfa 0 18px,#60a5fa 18px 36px,#f472b6 36px 54px)}
.sv3{background-image:repeating-linear-gradient(0deg,#34d399 0 18px,#fbbf24 18px 36px,#60a5fa 36px 54px)}
.sv4{background-image:repeating-linear-gradient(0deg,#fca5a5 0 18px,#86efac 18px 36px,#93c5fd 36px 54px)}
.sv5{background-image:repeating-linear-gradient(0deg,#f9a8d4 0 18px,#fef08a 18px 36px,#6ee7b7 36px 54px)}
.jpLabel{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;font-weight:900;letter-spacing:.02em;text-shadow:0 1px 0 #0006,0 3px 12px #0008;}
.jp{font-size:clamp(1.5rem,3.8vw,2.1rem)}
.hira{font-size:clamp(1.05rem,3vw,1.25rem);opacity:.95}
.answerRow{width:min(560px,90vw);display:grid;grid-template-columns:1fr var(--micSize);gap:16px;align-items:center;justify-content:center;}
.answerBox{position:relative;height:96px;border-radius:30px;background:#fff;color:#111;display:flex;align-items:center;justify-content:center;font-size:clamp(1.15rem,3.2vw,1.45rem);font-weight:800;letter-spacing:.01em;box-shadow:0 10px 26px rgba(0,0,0,.3);transition:all .3s ease;}
.answerBox.correct{background:var(--green);color:#052b11;box-shadow:0 0 0 3px rgba(34,197,94,.75),0 10px 28px rgba(34,197,94,.35)}
.answerBox.wrong{background:#fee2e2;color:#991b1b;box-shadow:0 0 0 3px #ef4444aa;animation:shake .45s}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}}
.pulsing{animation:purplePulse 1.2s ease-in-out infinite;}
@keyframes purplePulse{
  0%,100%{box-shadow:0 0 0 0 rgba(168,85,247,0.8),0 0 18px 6px rgba(168,85,247,0.4);}
  50%{box-shadow:0 0 40px 15px rgba(192,132,252,0.9),0 0 60px 25px rgba(168,85,247,0.7);}
}
.micBtn{width:var(--micSize);height:var(--micSize);border-radius:50%;border:none;cursor:pointer;display:grid;place-items:center;background:radial-gradient(circle at 30% 30%,#a78bfa 0%,#7c3aed 62%,#4c1d95 100%);box-shadow:0 0 20px #a855f7aa,0 0 45px #7c3aed66;transition:transform .1s ease;}
.micBtn svg{width:24px;height:24px;fill:#fff;}
.micBtn:active{transform:scale(.95);}
.micBtn.idle{animation:breath 2.2s ease-in-out infinite}
@keyframes breath{0%,100%{filter:brightness(1)}50%{filter:brightness(1.25)}}
.micBtn:disabled{opacity:.5;filter:saturate(.6);cursor:not-allowed}
.btn-next{background:var(--gold);color:#000;box-shadow:var(--goldGlow);border:0;border-radius:28px;padding:12px 34px;font-weight:800;font-size:1.05rem;cursor:pointer;display:none;margin-top:14px;}
.counter{margin-top:10px;text-align:center;opacity:.9;font-size:1rem;}
.confetti{position:fixed;width:10px;height:10px;border-radius:50%;pointer-events:none;z-index:10;opacity:.9;}
@media(max-width:700px){:root{--barH:88px;--micSize:52px}.answerBox{height:90px}}
</style>
</head>
<body>
<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>SAY THE WORD</h2>
  <div class="subtitle-stack"><div class="en">January Week 1</div><div class="jp">１月第１週</div></div>
  <hr class="sep">
</header>

<section id="page-game" class="page active">
  <div class="stripeBar">
    <div id="stripeInner" class="stripeInner sv1"></div>
    <div class="jpLabel"><span id="jpTxt" class="jp"></span><span id="hiraTxt" class="hira"></span></div>
  </div>

  <div class="answerRow">
    <div class="answerBox" id="answerBox"><div id="answerText">&nbsp;</div></div>
    <button id="micBtn" class="micBtn idle" aria-label="Speak">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3z"/>
        <path d="M19 11a1 1 0 0 0-2 0 5 5 0 0 1-10 0 1 1 0 0 0-2 0 7 7 0 0 0 6 6.93V21h-3a1 1 0 0 0 0 2h8a1 1 0 0 0 0-2h-3v-3.07A7 7 0 0 0 19 11z"/>
      </svg>
    </button>
  </div>

  <button id="nextBtn" class="btn-next">NEXT ➜ / 次へ ➜</button>
  <div id="counter" class="counter">1/15</div>
</section>

<section id="page-results" class="page">
  <div class="result-box">
    <div id="resultMsg" class="result-msg">結果</div>
    <div id="resultScore" class="result-score">0/15 (0%)</div>
  </div>
  <div class="actions" style="display:flex;gap:12px;justify-content:center">
    <button id="playAgain" class="btn-next" style="display:inline-block">もう一度</button>
    <button onclick="location.href='index.html'" class="btn-next" style="display:inline-block">Back to Menu</button>
  </div>
</section>

<footer>Bryan's English School</footer>

<audio id="s_ding" src="assets/audio/ding.mp3" preload="auto"></audio>
<audio id="s_fart" src="assets/audio/fart.mp3" preload="auto"></audio>
<audio id="s_r05" src="assets/audio/result_0-5.mp3" preload="auto"></audio>
<audio id="s_r610" src="assets/audio/result_6-10.mp3" preload="auto"></audio>
<audio id="s_r1114" src="assets/audio/result_11-14.mp3" preload="auto"></audio>
<audio id="s_r15" src="assets/audio/result_15.mp3" preload="auto"></audio>

<script>
const MASTER=[
  {en:"goal",jp:"目標",hira:"もくひょう"},
  {en:"plan",jp:"計画",hira:"けいかく"},
  {en:"future",jp:"未来",hira:"みらい"},
  {en:"dream",jp:"夢",hira:"ゆめ"},
  {en:"challenge",jp:"挑戦",hira:"ちょうせん"},
  {en:"try",jp:"挑戦する",hira:"ちょうせん する"},
  {en:"change",jp:"変える",hira:"かえる"},
  {en:"habit",jp:"習慣",hira:"しゅうかん"},
  {en:"exercise",jp:"運動",hira:"うんどう"},
  {en:"study",jp:"勉強",hira:"べんきょう"},
  {en:"learn",jp:"学ぶ",hira:"まなぶ"},
  {en:"practice",jp:"練習",hira:"れんしゅう"},
  {en:"success",jp:"成功",hira:"せいこう"},
  {en:"focus",jp:"集中",hira:"しゅうちゅう"},
  {en:"motivation",jp:"やる気",hira:"やるき"}
];
const $=s=>document.querySelector(s);
function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);}
function playSound(id){const s=$("#"+id);if(!s)return; s.currentTime=0; s.play().catch(()=>{});}
function playSage(word,onend){if(!word)return;const name=word.toLowerCase();const a=new Audio(`audio/${name}.mp3`);if(onend)a.onended=onend;a.play().catch(()=>{if(onend)onend();});}
function confettiBurst(el,count=60){const r=el.getBoundingClientRect();for(let i=0;i<count;i++){const d=document.createElement('div');d.className='confetti';d.style.left=(r.left+r.width/2)+'px';d.style.top=(r.top+r.height/2)+'px';d.style.background=`hsl(${Math.random()*360},100%,60%)`;const x=(Math.random()-0.5)*300;const y=(Math.random()-1)*300;d.animate([{transform:`translate(0,0)`},{transform:`translate(${x}px,${y}px)`,opacity:0}],{duration:1000+Math.random()*600,easing:"ease-out"});document.body.appendChild(d);setTimeout(()=>d.remove(),1600);}}
const stripeInner=$('#stripeInner');
const jpTxt=$('#jpTxt'), hiraTxt=$('#hiraTxt');
const answerBox=$('#answerBox'), answerText=$('#answerText');
const micBtn=$('#micBtn'), nextBtn=$('#nextBtn'), counterEl=$('#counter');
let order=shuffle([...MASTER]);
let idx=0,score=0,stripeIx=0,recognition=null,listening=false,answered=false;
const stripeSets=['sv1','sv2','sv3','sv4','sv5'];

function startListening(){
  if(listening||answered)return;
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!SR){alert('Speech Recognition not supported');return;}
  recognition=new SR();
  recognition.lang='en-US'; recognition.interimResults=false; recognition.maxAlternatives=1;
  listening=true; micBtn.classList.add('pulsing'); answerBox.classList.add('pulsing');
  recognition.start();
  recognition.onresult=e=>{
    const raw=e.results[0][0].transcript;
    const heard=raw.toLowerCase().replace(/[^a-z]/g,'');
    answerText.textContent=raw.trim();
    evaluate(heard);
  };
  recognition.onerror=()=>{answerText.textContent='';};
  recognition.onend=()=>{listening=false;micBtn.classList.remove('pulsing');answerBox.classList.remove('pulsing');};
}
micBtn.addEventListener('click',startListening);

function updateCounter(){counterEl.textContent=`${idx+1}/15`;}
function showCard(){
  const item=order[idx];
  stripeInner.className='stripeInner '+stripeSets[stripeIx%stripeSets.length]; stripeIx++;
  jpTxt.textContent=item.jp; hiraTxt.textContent=`（${item.hira}）`;
  answerText.textContent=''; answerBox.classList.remove('wrong','correct','pulsing'); answerBox.style.background='#fff'; answerBox.style.color='#111';
  nextBtn.style.display='none'; answered=false; updateCounter();
}

function evaluate(heard){
  const correct=order[idx].en.toLowerCase().replace(/[^a-z]/g,'');
  if(heard===correct){
    answered=true; micBtn.classList.remove('pulsing'); answerBox.classList.remove('pulsing');
    answerBox.classList.add('correct');
    playSound('s_ding');
    confettiBurst(answerBox,60);
    setTimeout(()=>{  // 1-second delay before Sage
      playSage(order[idx].en,()=>{ nextBtn.style.display='inline-block'; });
    },1000);
    score++;
  }else{
    answerBox.classList.add('wrong');
    playSound('s_fart');
    setTimeout(()=>{
      answerBox.classList.remove('wrong');
      answerBox.style.background='#fff';
      answerBox.style.color='#111';
      answerText.textContent='';
    },700);
  }
}

nextBtn.addEventListener('click',()=>{
  idx++; if(idx<order.length){showCard();} else{showResults();}
});

function showResults(){
  $('#page-game').classList.remove('active');
  const res=$('#page-results'); res.classList.add('active');
  const pct=Math.round((score/order.length)*100);
  let msg='いいね！あと少しでパーフェクト！',snd=$('#s_r1114');
  if(score<=5){msg='ブーリキュラム見てないでしょ！';snd=$('#s_r05');}
  else if(score<=10){msg='YouTube見すぎ！ブーリキュラムもやろう！';snd=$('#s_r610');}
  else if(score===15){msg='すごい！あなたは地球で一番頭がいい！';snd=$('#s_r15');}
  $('#resultMsg').textContent=msg;
  $('#resultScore').textContent=`${score}/15（${pct}%）`;
  snd.currentTime=0; snd.play().catch(()=>{});
  if(score===15){for(let i=0;i<160;i++) setTimeout(()=>{confettiBurst(document.body,1)},i*10);}
}

$('#playAgain').addEventListener('click',()=>{
  document.body.className='';
  order=shuffle([...MASTER]);
  idx=0; score=0; stripeIx=0; answered=false;
  $('#page-results').classList.remove('active');
  $('#page-game').classList.add('active');
  showCard();
});

function preloadAll(){
  MASTER.forEach(i=>{
    const a=new Audio(`audio/${i.en.toLowerCase()}.mp3`); a.load();
  });
  ['s_ding','s_fart','s_r05','s_r610','s_r1114','s_r15'].forEach(id=>{
    const el=$("#"+id); if(el) el.load();
  });
}

// INIT
preloadAll();
showCard();
</script>
</body>
</html>
