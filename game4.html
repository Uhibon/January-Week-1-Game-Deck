<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Game 4 ‚Äì Eigo Adventure!</title>
<meta name="theme-color" content="#ffffff" />
<link rel="icon" type="image/png" href="booha-ghost.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet" />
<style>
:root{
  --ink:#111111; --muted:#5f6673; --bg:#f5f7fb; --radius:28px;
  --accent:#ff7eb9; --accent2:#5ee6ff; --gold:#ffd166; --good:#22c55e; --bad:#ef4444;
  --glow:#ffd6e8; --glow2:#fff3a6;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}

/* Page */
html,body{height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;}

/* Header */
header{
  padding:18px 16px 8px; text-align:center; font-family:'Cinzel',serif;
}
header h1{ font-size:clamp(28px,4.8vw,48px); letter-spacing:1px; font-weight:900;}
header h2{ font-size:clamp(16px,2.8vw,22px); color:var(--muted); margin-top:4px; font-weight:700;}

/* Card */
.card{
  width:min(1000px,92vw);
  margin:20px auto;
  background:#fff;
  border:2px solid rgba(0,0,0,.08);
  border-radius:var(--radius);
  box-shadow:0 30px 80px rgba(0,0,0,.12);
  overflow:hidden;
}

/* Top bar */
.top{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:14px 18px; background:#fafafa;
  border-bottom:1px solid rgba(0,0,0,.08);
}
.badge{
  font-family:'Cinzel',serif; font-weight:800;
  background:linear-gradient(90deg,#ff7eb9,#5ee6ff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  letter-spacing:.5px;
}
.progress{
  display:flex; align-items:center; gap:10px; color:var(--muted); font-weight:600;
}
.progress .dot{
  width:10px;height:10px;border-radius:50%; background:#e2e6ef; box-shadow:0 0 6px rgba(0,0,0,.05) inset;
}
.progress .dot.active{ background:#7dd3fc; }
.score{
  font-weight:800; color:#00a86b;
}

/* Paragraph area */
.content{
  padding:20px clamp(14px,4vw,28px) 8px;
}
h3#paraTitle{
  font-family:'Cinzel',serif; font-weight:900;
  font-size:clamp(18px,3.6vw,26px);
  margin-bottom:14px; letter-spacing:.5px;
}

.sentenceBlock{
  padding:14px 0 12px;
  border-bottom:1px dashed rgba(0,0,0,.06);
}
.sentence{
  font-size:clamp(18px,2.6vw,24px);
  line-height:1.55;
}
.blank{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:120px; padding:0 10px; margin:0 4px;
  border-bottom:3px dashed rgba(0,0,0,.35);
  color:#111; font-weight:800; letter-spacing:.5px;
  border-radius:10px;
}
.blank.waiting{ box-shadow:0 0 0 4px rgba(0,0,0,.06) inset; }
.blank.correct{
  background:linear-gradient(90deg,#fff680,#a6f7b2);
  color:#111; border-bottom-color:transparent; box-shadow:0 0 18px rgba(255,246,128,.55);
  animation:pop .35s ease;
}
@keyframes pop{ 0%{transform:scale(.92)} 100%{transform:scale(1)} }

.jp{
  margin-top:6px;
  color:#2e3340;
  font-size:clamp(14px,2.3vw,18px);
  text-shadow:0 0 10px var(--glow2);
}
.kana{
  margin-top:2px;
  color:#6b7280;
  font-size:clamp(13px,2.1vw,16px);
  text-shadow:0 0 8px var(--glow);
}

/* Controls */
.controls{
  display:flex; flex-wrap:wrap; gap:10px; padding:16px 18px 18px; justify-content:center;
  border-top:1px solid rgba(0,0,0,.08); background:#fafafa;
}
button{
  appearance:none; border:0; padding:12px 16px; border-radius:14px;
  font-weight:800; letter-spacing:.3px; cursor:pointer;
  color:#111; background:linear-gradient(90deg,#ff7eb9,#5ee6ff);
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
button.secondary{ color:#111; background:#eaeef7; }
button.good{ background:linear-gradient(90deg,#a6f7b2,#fff680); color:#111; }
button.bad{ background:#ef4444; color:#fff; }
button:disabled{ filter:grayscale(.5) brightness(.9); cursor:not-allowed; }

/* Mic indicator */
.mic{
  display:flex; align-items:center; gap:10px; color:#4b5563; font-weight:700;
}
.micDot{
  width:12px;height:12px;border-radius:50%; background:#cbd5e1;
  box-shadow:0 0 0 0 rgba(94,230,255,.45);
}
.mic.listening .micDot{ background:#5ee6ff; animation:ping 1.5s infinite; }
@keyframes ping{
  0%{ box-shadow:0 0 0 0 rgba(94,230,255,.45); }
  70%{ box-shadow:0 0 0 14px rgba(94,230,255,0); }
  100%{ box-shadow:0 0 0 0 rgba(94,230,255,0); }
}

/* Footer */
footer{
  text-align:center; color:#7b8391; padding:16px 0 28px; font-size:14px;
}

/* Result overlay */
#result{
  position:fixed; inset:0; background:rgba(0,0,0,.35);
  display:none; align-items:center; justify-content:center; z-index:9;
}
.resultCard{
  width:min(680px,92vw); background:#ffffff; border:2px solid rgba(0,0,0,.1);
  border-radius:24px; padding:24px; text-align:center;
  box-shadow:0 30px 100px rgba(0,0,0,.25);
}
.resultCard h2{ font-family:'Cinzel',serif; font-weight:900; font-size:clamp(26px,4.5vw,42px); margin-bottom:6px; color:#0b1530;}
.resultCard p{ color:#4b5563; margin-bottom:16px; }
.bigScore{ font-size:clamp(26px,6vw,56px); font-weight:900; color:#00a86b; margin:10px 0 20px; }

/* Confetti (simple) */
.confetti{
  position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:10;
}
.confetti i{
  position:absolute; width:8px; height:14px; top:-20px; opacity:.9;
  background:linear-gradient(180deg,#fff680,#ff7eb9);
  transform:rotate(10deg);
  animation:fetti 3.2s linear forwards;
}
@keyframes fetti{
  to{ transform:translateY(110vh) rotate(360deg); opacity:1;}
}
</style>
</head>
<body>

<header>
  <h1>The Boo-riculum</h1>
  <h2>„Ç≤„Éº„É†ÔºîÔºöEigo Adventure!ÔºàËã±Ë™û„Ç¢„Éâ„Éô„É≥„ÉÅ„É£„ÉºÔºâ</h2>
</header>

<main class="card" id="app">
  <div class="top">
    <div class="badge">January ‚Äì Goals & New Beginnings</div>
    <div class="progress">
      <div id="dots"></div>
      <div class="score" id="scoreLabel">Score: 0%</div>
    </div>
  </div>

  <div class="content">
    <h3 id="paraTitle">Paragraph 1 / 10</h3>
    <div id="sentences"></div>
  </div>

  <div class="controls">
    <button id="btnPlay">‚ñ∂Ô∏è Play sentence</button>
    <button class="secondary" id="btnRepeat">‚Üª Repeat</button>
    <button class="secondary" id="btnReveal">üëÄ Reveal word</button>
    <button class="good" id="btnNext" disabled>Next ‚Üí</button>
    <div class="mic" id="mic">
      <div class="micDot"></div> <span id="micText">Mic: ready</span>
    </div>
  </div>
</main>

<div id="result">
  <div class="resultCard">
    <h2>Adventure Complete!</h2>
    <p>Great listening, reading, and speaking.</p>
    <div class="bigScore" id="finalScore">„Éö„É©„Éö„É©„É¨„Éô„É´ 0%</div>
    <button onclick="location.href='index.html'" class="good">‚Üê Back to Game Deck</button>
  </div>
  <div class="confetti" id="confetti"></div>
</div>

<footer>
  Bryan's English School
</footer>

<script>
/* ---------------------------
   DATA: 10 paragraphs √ó 5
   Each item also includes kana lines.
----------------------------*/
const PARAGRAPHS = [
  { // 1 ‚Äì Fresh Start
    en: [
      "It‚Äôs January, and I _____ start something new.",
      "Every morning, I write my _____ in my notebook.",
      "I _____ a little, even on weekends.",
      "I _____ because this year feels different.",
      "I will _____ to make every day special."
    ],
    answers: ["will","goals","study","smile","try"],
    jp: [
      "ÔºëÊúà„Åß„Åô„ÄÇÊñ∞„Åó„ÅÑ„Åì„Å®„ÇíÂßã„ÇÅ„Åæ„Åô„ÄÇ",
      "ÊØéÊúù„ÄÅ„Éé„Éº„Éà„Å´ÁõÆÊ®ô„ÇíÊõ∏„Åç„Åæ„Åô„ÄÇ",
      "ÈÄ±Êú´„Åß„ÇÇÂ∞ë„ÅóÂãâÂº∑„Åó„Åæ„Åô„ÄÇ",
      "‰ªäÂπ¥„ÅØÈÅï„ÅÜÊ∞ó„Åå„Åó„Å¶Á¨ë„ÅÑ„Åæ„Åô„ÄÇ",
      "ÊØéÊó•„ÇíÁâπÂà•„Å´„Åô„Çã„Åü„ÇÅ„Å´ÊåëÊà¶„Åó„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„ÅÑ„Å°„Åå„Å§„Åß„Åô„ÄÇ„ÅÇ„Åü„Çâ„Åó„ÅÑ„Åì„Å®„Çí„ÅØ„Åò„ÇÅ„Åæ„Åô„ÄÇ",
      "„Åæ„ÅÑ„ÅÇ„Åï„ÄÅ„Éé„Éº„Éà„Å´„ÇÇ„Åè„Å≤„Çá„ÅÜ„Çí„Åã„Åç„Åæ„Åô„ÄÇ",
      "„Åó„ÇÖ„ÅÜ„Åæ„Å§„Åß„ÇÇ„Åô„Åì„Åó„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åì„Å®„Åó„ÅØ„Å°„Åå„ÅÜ„Åç„Åå„Åó„Å¶„Çè„Çâ„ÅÑ„Åæ„Åô„ÄÇ",
      "„Åæ„ÅÑ„Å´„Å°„Çí„Å®„Åè„Åπ„Å§„Å´„Åô„Çã„Åü„ÇÅ„Å´„Å°„Çá„ÅÜ„Åõ„Çì„Åó„Åæ„Åô„ÄÇ"
    ]
  },
  { // 2 ‚Äì The Plan
    en: [
      "I will wake up _____ and eat breakfast.",
      "I‚Äôm going to _____ before school.",
      "I will not be _____ anymore.",
      "I will _____ carefully in class.",
      "I will _____ my classmates when they need me."
    ],
    answers: ["early","read","late","listen","help"],
    jp: [
      "Êó©Ëµ∑„Åç„Åó„Å¶Êúù„Åî„ÅØ„Çì„ÇíÈ£ü„Åπ„Åæ„Åô„ÄÇ",
      "Â≠¶Ê†°„ÅÆÂâç„Å´Ë™≠„Åø„Åæ„Åô„ÄÇ",
      "„ÇÇ„ÅÜÈÅÖÂàª„Åó„Åæ„Åõ„Çì„ÄÇ",
      "ÊéàÊ•≠„Åß„Åó„Å£„Åã„ÇäËÅû„Åç„Åæ„Åô„ÄÇ",
      "„ÇØ„É©„Çπ„É°„Ç§„Éà„ÇíÊâã‰ºù„ÅÑ„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„ÅØ„ÇÑ„Åä„Åç„Åó„Å¶„ÅÇ„Åï„Åî„ÅØ„Çì„Çí„Åü„Åπ„Åæ„Åô„ÄÇ",
      "„Åå„Å£„Åì„ÅÜ„ÅÆ„Åæ„Åà„Å´„Çà„Åø„Åæ„Åô„ÄÇ",
      "„ÇÇ„ÅÜ„Å°„Åì„Åè„Åó„Åæ„Åõ„Çì„ÄÇ",
      "„Åò„ÇÖ„Åé„Çá„ÅÜ„Åß„Åó„Å£„Åã„Çä„Åç„Åç„Åæ„Åô„ÄÇ",
      "„ÇØ„É©„Çπ„É°„Ç§„Éà„Çí„Å¶„Å§„Å†„ÅÑ„Åæ„Åô„ÄÇ"
    ]
  },
  { // 3 ‚Äì At School
    en: [
      "My teacher says, ‚ÄúDo your _____!‚Äù",
      "I will _____ my desk today.",
      "I will _____ more English in class.",
      "I will _____ new words in my notebook.",
      "I will _____ learning every subject."
    ],
    answers: ["best","clean","speak","write","enjoy"],
    jp: [
      "ÂÖàÁîü„ÅØ„Äå„Éô„Çπ„Éà„ÇíÂ∞Ω„Åè„Åó„Å¶„Äç„Å®Ë®Ä„ÅÑ„Åæ„Åô„ÄÇ",
      "‰ªäÊó•„ÅØÊú∫„ÇíÁâá„Å•„Åë„Åæ„Åô„ÄÇ",
      "ÊéàÊ•≠„ÅßËã±Ë™û„Çí„ÇÇ„Å£„Å®Ë©±„Åó„Åæ„Åô„ÄÇ",
      "„Éé„Éº„Éà„Å´Êñ∞„Åó„ÅÑÂçòË™û„ÇíÊõ∏„Åç„Åæ„Åô„ÄÇ",
      "„Åô„Åπ„Å¶„ÅÆÊïôÁßë„ÅÆÂ≠¶„Å≥„ÇíÊ•Ω„Åó„Åø„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åõ„Çì„Åõ„ÅÑ„ÅØ„Äå„Éô„Çπ„Éà„Çí„Å§„Åè„Åó„Å¶„Äç„Å®„ÅÑ„ÅÑ„Åæ„Åô„ÄÇ",
      "„Åç„Çá„ÅÜ„ÅØ„Å§„Åè„Åà„Çí„Åã„Åü„Å•„Åë„Åæ„Åô„ÄÇ",
      "„Åò„ÇÖ„Åé„Çá„ÅÜ„Åß„Åà„ÅÑ„Åî„Çí„ÇÇ„Å£„Å®„ÅØ„Å™„Åó„Åæ„Åô„ÄÇ",
      "„Éé„Éº„Éà„Å´„ÅÇ„Åü„Çâ„Åó„ÅÑ„Åü„Çì„Åî„Çí„Åã„Åç„Åæ„Åô„ÄÇ",
      "„Åô„Åπ„Å¶„ÅÆ„Åç„Çá„ÅÜ„Åã„ÅÆ„Åæ„Å™„Å≥„Çí„Åü„ÅÆ„Åó„Åø„Åæ„Åô„ÄÇ"
    ]
  },
  { // 4 ‚Äì Making Friends
    en: [
      "I will _____ a new friend this week.",
      "We will _____ about our favorite games.",
      "We will _____ home together.",
      "We will _____ at funny stories.",
      "Friendship makes school _____."
    ],
    answers: ["make","talk","walk","laugh","fun"],
    jp: [
      "‰ªäÈÄ±„ÄÅÊñ∞„Åó„ÅÑÂèã„Å†„Å°„Çí‰Ωú„Çä„Åæ„Åô„ÄÇ",
      "Â•Ω„Åç„Å™„Ç≤„Éº„É†„Å´„Å§„ÅÑ„Å¶Ë©±„Åó„Åæ„Åô„ÄÇ",
      "‰∏ÄÁ∑í„Å´Ê≠©„ÅÑ„Å¶Â∏∞„Çä„Åæ„Åô„ÄÇ",
      "„Åä„ÇÇ„Åó„Çç„ÅÑË©±„Å´Á¨ë„ÅÑ„Åæ„Åô„ÄÇ",
      "ÂèãÊÉÖ„ÅØÂ≠¶Ê†°„ÇíÊ•Ω„Åó„Åè„Åó„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åì„Çì„Åó„ÇÖ„ÅÜ„ÄÅ„ÅÇ„Åü„Çâ„Åó„ÅÑ„Å®„ÇÇ„Å†„Å°„Çí„Å§„Åè„Çä„Åæ„Åô„ÄÇ",
      "„Åô„Åç„Å™„Ç≤„Éº„É†„Å´„Å§„ÅÑ„Å¶„ÅØ„Å™„Åó„Åæ„Åô„ÄÇ",
      "„ÅÑ„Å£„Åó„Çá„Å´„ÅÇ„Çã„ÅÑ„Å¶„Åã„Åà„Çä„Åæ„Åô„ÄÇ",
      "„Åä„ÇÇ„Åó„Çç„ÅÑ„ÅØ„Å™„Åó„Å´„Çè„Çâ„ÅÑ„Åæ„Åô„ÄÇ",
      "„ÇÜ„ÅÜ„Åò„Çá„ÅÜ„ÅØ„Åå„Å£„Åì„ÅÜ„Çí„Åü„ÅÆ„Åó„Åè„Åó„Åæ„Åô„ÄÇ"
    ]
  },
  { // 5 ‚Äì Good Habits
    en: [
      "I will _____ a good habit this month.",
      "I will _____ more books.",
      "I will _____ English every day.",
      "I will _____ yesterday‚Äôs lesson.",
      "I will _____ until it feels easy."
    ],
    answers: ["start","read","practice","review","continue"],
    jp: [
      "‰ªäÊúà„ÅØËâØ„ÅÑÁøíÊÖ£„ÇíÂßã„ÇÅ„Åæ„Åô„ÄÇ",
      "„ÇÇ„Å£„Å®Êú¨„ÇíË™≠„Åø„Åæ„Åô„ÄÇ",
      "ÊØéÊó•Ëã±Ë™û„ÇíÁ∑¥Áøí„Åó„Åæ„Åô„ÄÇ",
      "Êò®Êó•„ÅÆ„É¨„ÉÉ„Çπ„É≥„ÇíÂæ©Áøí„Åó„Åæ„Åô„ÄÇ",
      "Á∞°Âçò„Å´„Å™„Çã„Åæ„ÅßÁ∂ö„Åë„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åì„Çì„Åí„Å§„ÅØ„Çà„ÅÑ„Åó„ÇÖ„ÅÜ„Åã„Çì„Çí„ÅØ„Åò„ÇÅ„Åæ„Åô„ÄÇ",
      "„ÇÇ„Å£„Å®„Åª„Çì„Çí„Çà„Åø„Åæ„Åô„ÄÇ",
      "„Åæ„ÅÑ„Å´„Å°„Åà„ÅÑ„Åî„Çí„Çå„Çì„Åó„ÇÖ„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åç„ÅÆ„ÅÜ„ÅÆ„É¨„ÉÉ„Çπ„É≥„Çí„Åµ„Åè„Åó„ÇÖ„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åã„Çì„Åü„Çì„Å´„Å™„Çã„Åæ„Åß„Å§„Å•„Åë„Åæ„Åô„ÄÇ"
    ]
  },
  { // 6 ‚Äì Challenges
    en: [
      "Sometimes I will _____ my goal.",
      "Sometimes I will feel _____.",
      "I will _____ again and again.",
      "I will _____ on small steps.",
      "I will never _____ up."
    ],
    answers: ["forget","tired","try","focus","give"],
    jp: [
      "„Å®„Åç„Å©„ÅçÁõÆÊ®ô„ÇíÂøò„Çå„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô„ÄÇ",
      "Áñ≤„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ",
      "‰ΩïÂ∫¶„ÇÇÊåëÊà¶„Åó„Åæ„Åô„ÄÇ",
      "Â∞è„Åï„Å™‰∏ÄÊ≠©„Å´ÈõÜ‰∏≠„Åó„Åæ„Åô„ÄÇ",
      "Ê±∫„Åó„Å¶„ÅÇ„Åç„Çâ„ÇÅ„Åæ„Åõ„Çì„ÄÇ"
    ],
    kana: [
      "„Å®„Åç„Å©„Åç„ÇÇ„Åè„Å≤„Çá„ÅÜ„Çí„Çè„Åô„Çå„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô„ÄÇ",
      "„Å§„Åã„Çå„Çã„Åì„Å®„ÇÇ„ÅÇ„Çä„Åæ„Åô„ÄÇ",
      "„Å™„Çì„Å©„ÇÇ„Å°„Çá„ÅÜ„Åõ„Çì„Åó„Åæ„Åô„ÄÇ",
      "„Å°„ÅÑ„Åï„Å™„ÅÑ„Å£„ÅΩ„Å´„Åó„ÇÖ„ÅÜ„Å°„ÇÖ„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åë„Å£„Åó„Å¶„ÅÇ„Åç„Çâ„ÇÅ„Åæ„Åõ„Çì„ÄÇ"
    ]
  },
  { // 7 ‚Äì At Home
    en: [
      "After school, I will _____ my room.",
      "I will _____ my family with dinner.",
      "I will _____ before playing games.",
      "I will _____ my parents my homework.",
      "I will _____ them for helping me."
    ],
    answers: ["clean","help","study","show","thank"],
    jp: [
      "ÊîæË™≤Âæå„ÄÅÈÉ®Â±ã„ÇíÊéÉÈô§„Åó„Åæ„Åô„ÄÇ",
      "Â§ïÈ£ü„ÇíÂÆ∂Êóè„Å®Êâã‰ºù„ÅÑ„Åæ„Åô„ÄÇ",
      "„Ç≤„Éº„É†„ÅÆÂâç„Å´ÂãâÂº∑„Åó„Åæ„Åô„ÄÇ",
      "ÂÆøÈ°å„Çí‰∏°Ë¶™„Å´Ë¶ã„Åõ„Åæ„Åô„ÄÇ",
      "Êâã‰ºù„Å£„Å¶„Åè„Çå„Åü„Åì„Å®„Å´ÊÑüË¨ù„Åó„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åª„ÅÜ„Åã„Åî„ÄÅ„Å∏„ÇÑ„Çí„Åù„ÅÜ„Åò„Åó„Åæ„Åô„ÄÇ",
      "„ÇÜ„ÅÜ„Åó„Çá„Åè„Çí„Åã„Åû„Åè„Å®„Å¶„Å§„Å†„ÅÑ„Åæ„Åô„ÄÇ",
      "„Ç≤„Éº„É†„ÅÆ„Åæ„Åà„Å´„Åπ„Çì„Åç„Çá„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åó„ÇÖ„Åè„Å†„ÅÑ„Çí„Çä„Çá„ÅÜ„Åó„Çì„Å´„Åø„Åõ„Åæ„Åô„ÄÇ",
      "„Å¶„Å§„Å†„Å£„Å¶„Åè„Çå„Åü„Åì„Å®„Å´„Åã„Çì„Åó„ÇÉ„Åó„Åæ„Åô„ÄÇ"
    ]
  },
  { // 8 ‚Äì Free Time
    en: [
      "On weekends, I will _____ pictures.",
      "I will _____ to music in English.",
      "I will _____ a movie with subtitles.",
      "I will _____ new words from songs.",
      "I will _____ and feel proud."
    ],
    answers: ["draw","listen","watch","learn","relax"],
    jp: [
      "ÈÄ±Êú´„ÅØÁµµ„ÇíÊèè„Åç„Åæ„Åô„ÄÇ",
      "Ëã±Ë™û„ÅÆÈü≥Ê•Ω„ÇíËÅ¥„Åç„Åæ„Åô„ÄÇ",
      "Â≠óÂπï‰ªò„Åç„ÅÆÊò†Áîª„ÇíË¶ã„Åæ„Åô„ÄÇ",
      "Ê≠å„Åã„ÇâÊñ∞„Åó„ÅÑÂçòË™û„ÇíÂ≠¶„Å≥„Åæ„Åô„ÄÇ",
      "„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Å¶Ë™á„Çâ„Åó„ÅèÊÄù„ÅÑ„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åó„ÇÖ„ÅÜ„Åæ„Å§„ÅØ„Åà„Çí„Åã„Åç„Åæ„Åô„ÄÇ",
      "„Åà„ÅÑ„Åî„ÅÆ„Åä„Çì„Åå„Åè„Çí„Åç„Åç„Åæ„Åô„ÄÇ",
      "„Åò„Åæ„Åè„Å§„Åç„ÅÆ„Åà„ÅÑ„Åå„Çí„Åø„Åæ„Åô„ÄÇ",
      "„ÅÜ„Åü„Åã„Çâ„ÅÇ„Åü„Çâ„Åó„ÅÑ„Åü„Çì„Åî„Çí„Åæ„Å™„Å≥„Åæ„Åô„ÄÇ",
      "„É™„É©„ÉÉ„ÇØ„Çπ„Åó„Å¶„Åª„Åì„Çâ„Åó„Åè„Åä„ÇÇ„ÅÑ„Åæ„Åô„ÄÇ"
    ]
  },
  { // 9 ‚Äì Reflection
    en: [
      "I think about my _____ every week.",
      "I will _____ what I learned.",
      "I will _____ my ideas with my teacher.",
      "I will _____ small successes.",
      "I will _____ to keep going."
    ],
    answers: ["progress","remember","share","celebrate","promise"],
    jp: [
      "ÊØéÈÄ±„ÄÅËá™ÂàÜ„ÅÆÈÄ≤Ê≠©„Å´„Å§„ÅÑ„Å¶ËÄÉ„Åà„Åæ„Åô„ÄÇ",
      "Â≠¶„Çì„Å†„Åì„Å®„ÇíË¶ö„Åà„Å¶„Åä„Åç„Åæ„Åô„ÄÇ",
      "ÂÖàÁîü„Å®Ëá™ÂàÜ„ÅÆËÄÉ„Åà„ÇíÂÖ±Êúâ„Åó„Åæ„Åô„ÄÇ",
      "Â∞è„Åï„Å™ÊàêÂäü„ÇíÁ•ù„ÅÑ„Åæ„Åô„ÄÇ",
      "Á∂ö„Åë„Çã„Åì„Å®„ÇíÁ¥ÑÊùü„Åó„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åæ„ÅÑ„Åó„ÇÖ„ÅÜ„ÄÅ„Åò„Å∂„Çì„ÅÆ„Åó„Çì„ÅΩ„Å´„Å§„ÅÑ„Å¶„Åã„Çì„Åå„Åà„Åæ„Åô„ÄÇ",
      "„Åæ„Å™„Çì„Å†„Åì„Å®„Çí„Åä„Åº„Åà„Å¶„Åä„Åç„Åæ„Åô„ÄÇ",
      "„Åõ„Çì„Åõ„ÅÑ„Å®„Åò„Å∂„Çì„ÅÆ„Åã„Çì„Åå„Åà„Çí„Åç„Çá„ÅÜ„ÇÜ„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Å°„ÅÑ„Åï„Å™„Åõ„ÅÑ„Åì„ÅÜ„Çí„ÅÑ„Çè„ÅÑ„Åæ„Åô„ÄÇ",
      "„Å§„Å•„Åë„Çã„Åì„Å®„Çí„ÇÑ„Åè„Åù„Åè„Åó„Åæ„Åô„ÄÇ"
    ]
  },
  { // 10 ‚Äì The Goal
    en: [
      "This year, I will _____ in many ways.",
      "I will _____ in myself.",
      "I will _____ big and stay kind.",
      "I will _____ English with confidence.",
      "I will _____ like a Booha star."
    ],
    answers: ["grow","believe","dream","speak","shine"],
    jp: [
      "‰ªäÂπ¥„ÄÅ„ÅÑ„Çç„ÅÑ„Çç„Å™Èù¢„ÅßÊàêÈï∑„Åó„Åæ„Åô„ÄÇ",
      "Ëá™ÂàÜ„Çí‰ø°„Åò„Åæ„Åô„ÄÇ",
      "Â§ß„Åç„Å™Â§¢„ÇíÊåÅ„Å°„ÄÅË¶™Âàá„Å´„Åó„Åæ„Åô„ÄÇ",
      "Ëá™‰ø°„ÇíÊåÅ„Å£„Å¶Ëã±Ë™û„ÇíË©±„Åó„Åæ„Åô„ÄÇ",
      "„Éñ„Éº„Éè„ÅÆÊòü„ÅÆ„Çà„ÅÜ„Å´Ëºù„Åç„Åæ„Åô„ÄÇ"
    ],
    kana: [
      "„Åì„Å®„Åó„ÄÅ„ÅÑ„Çç„ÅÑ„Çç„Å™„ÇÅ„Çì„Åß„Åõ„ÅÑ„Å°„Çá„ÅÜ„Åó„Åæ„Åô„ÄÇ",
      "„Åò„Å∂„Çì„Çí„Åó„Çì„Åò„Åæ„Åô„ÄÇ",
      "„Åä„Åä„Åç„Å™„ÇÜ„ÇÅ„Çí„ÇÇ„Å°„ÄÅ„Åó„Çì„Åõ„Å§„Å´„Åó„Åæ„Åô„ÄÇ",
      "„Åò„Åó„Çì„Çí„ÇÇ„Å£„Å¶„Åà„ÅÑ„Åî„Çí„ÅØ„Å™„Åó„Åæ„Åô„ÄÇ",
      "„Éñ„Éº„Éè„ÅÆ„Åª„Åó„ÅÆ„Çà„ÅÜ„Å´„Åã„Åå„ÇÑ„Åç„Åæ„Åô„ÄÇ"
    ]
  }
];

let currentPara = 0;
let currentSent = 0;
let score = 0;
let totalBlanks = PARAGRAPHS.reduce((a,p)=>a+p.answers.length,0);

const elSentences = document.getElementById('sentences');
const elParaTitle = document.getElementById('paraTitle');
const elDots = document.getElementById('dots');
const elScore = document.getElementById('scoreLabel');
const elMic = document.getElementById('mic');
const elMicText = document.getElementById('micText');

const btnPlay = document.getElementById('btnPlay');
const btnRepeat = document.getElementById('btnRepeat');
const btnReveal = document.getElementById('btnReveal');
const btnNext = document.getElementById('btnNext');

/* ---------------------------
   Speech Synthesis helpers (Sage-like pacing)
----------------------------*/
function speakFull(text, {rate=0.9}={}) {
  if (!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = rate; u.pitch = 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}
function speakPart(text, {rate=0.95}={}) {
  if (!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = rate; u.pitch = 1;
  window.speechSynthesis.speak(u);
}

/* Wait/continue state */
let waitingForAnswer = false;
let waitTimer = null;
let continuedOnce = false;

/* Build top dots */
function buildDots(){
  elDots.innerHTML='';
  for (let i=0;i<PARAGRAPHS.length;i++){
    const d=document.createElement('div');
    d.className='dot'+(i===currentPara?' active':'');
    elDots.appendChild(d);
  }
}
function updateScore(){
  const pct = Math.round((score/totalBlanks)*100);
  elScore.textContent = `Score: ${pct}%`;
}

function renderParagraph(){
  const p = PARAGRAPHS[currentPara];
  elParaTitle.textContent = `Paragraph ${currentPara+1} / ${PARAGRAPHS.length}`;
  elSentences.innerHTML='';
  currentSent = 0;

  // sentences + blanks + JP/Kana
  p.en.forEach((line,idx)=>{
    const block = document.createElement('div');
    block.className='sentenceBlock';

    const s = document.createElement('div');
    s.className='sentence';
    const parts = line.split('_____');
    const spanBefore = document.createElement('span');
    spanBefore.textContent = parts[0] || '';
    const blank = document.createElement('span');
    blank.className='blank';
    blank.dataset.idx = idx;
    blank.textContent = '__________';
    const spanAfter = document.createElement('span');
    spanAfter.textContent = parts[1] || '';
    s.append(spanBefore, blank, spanAfter);

    const j = document.createElement('div');
    j.className = 'jp';
    j.textContent = p.jp[idx];

    const k = document.createElement('div');
    k.className = 'kana';
    k.textContent = p.kana[idx];

    block.append(s, j, k);
    elSentences.appendChild(block);
  });

  buildDots();
  updateActiveBlank();
  updateScore();
  btnNext.disabled = true;
}

function activeBlankEl(){
  return elSentences.querySelector(`.blank[data-idx="${currentSent}"]`);
}
function updateActiveBlank(){
  elSentences.querySelectorAll('.blank').forEach(b=>b.classList.remove('waiting'));
  const b = activeBlankEl();
  if (b) b.classList.add('waiting');
}

/* Plays prefix, waits for student, then continues suffix.
   If timeout (~8s), gives hint by reading full sentence slowly. */
function playGuidedForCurrent(){
  const p = PARAGRAPHS[currentPara];
  const line = p.en[currentSent];
  const [prefix, suffixRaw=''] = line.split('_____');
  const suffix = suffixRaw.trim(); // includes any trailing words after blank

  // reset state
  clearTimeout(waitTimer);
  waitingForAnswer = true;
  continuedOnce = false;

  if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  // 1) Speak the prefix up to the blank
  speakPart(prefix.trim(), {rate:0.95});

  // 2) Start timeout for hint
  waitTimer = setTimeout(()=>{
    if (!continuedOnce) {
      // Speak the entire sentence as a slow hint
      speakFull(line.replace('_____','').trim(), {rate:0.8});
      continuedOnce = true;
    }
  }, 8000);
}

/* Continue the suffix after a correct answer (only once). */
function continueSuffixAfterAnswer(){
  if (continuedOnce) return;
  const p = PARAGRAPHS[currentPara];
  const line = p.en[currentSent];
  const [prefix, suffixRaw=''] = line.split('_____');
  const suffix = suffixRaw.trim();
  if (!suffix) { continuedOnce = true; return; }
  // Speak the rest of the sentence
  speakPart(suffix, {rate:0.95});
  continuedOnce = true;
}

/* Reveal + advance helpers */
function revealWord(){
  const p = PARAGRAPHS[currentPara];
  const ans = p.answers[currentSent];
  const b = activeBlankEl();
  if (!b) return;
  b.textContent = ans;
  b.classList.add('correct');
  b.classList.remove('waiting');
  score++; updateScore();
  continueSuffixAfterAnswer();
  nextWordOrParagraph(350);
}

function nextWordOrParagraph(delay=250){
  clearTimeout(waitTimer);
  waitingForAnswer = false;

  const p = PARAGRAPHS[currentPara];
  currentSent++;
  if (currentSent >= p.en.length){
    // Paragraph complete
    btnNext.disabled = false;
    btnNext.focus();
    stopListening();
  }else{
    updateActiveBlank();
  }
}

function nextParagraph(){
  currentPara++;
  if (currentPara >= PARAGRAPHS.length){
    finish();
  }else{
    renderParagraph();
    listen(); // re-arm mic
  }
}

/* ---------------------------
   Speech Recognition (wait-for-answer)
----------------------------*/
let recog, canListen=false;
function initRecog(){
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!R){
    elMicText.textContent = 'Mic: unavailable';
    return;
  }
  recog = new R();
  recog.lang = 'en-US';
  recog.interimResults = true;
  recog.continuous = true;

  recog.onstart = ()=>{ elMic.classList.add('listening'); elMicText.textContent='Listening‚Ä¶'; };
  recog.onend   = ()=>{ elMic.classList.remove('listening'); elMicText.textContent= canListen?'Listening paused':'Mic: ready'; if (canListen) try{recog.start();}catch(e){} };
  recog.onerror = ()=>{ elMic.classList.remove('listening'); elMicText.textContent='Mic error'; };

  recog.onresult = (e)=>{
    const p = PARAGRAPHS[currentPara];
    const target = p.answers[currentSent]?.toLowerCase();
    if (!target) return;
    let said = '';
    for (let i = e.resultIndex; i < e.results.length; i++){
      said += e.results[i][0].transcript + ' ';
    }
    said = said.toLowerCase();

    // Accept close matches
    const ok = said.includes(target) || closeEnough(said, target);
    if (ok && waitingForAnswer){
      const b = activeBlankEl();
      if (b){
        b.textContent = p.answers[currentSent];
        b.classList.add('correct');
        b.classList.remove('waiting');
        score++; updateScore();
        waitingForAnswer = false;
        clearTimeout(waitTimer);
        continueSuffixAfterAnswer();
        // short delay so students see success before moving
        setTimeout(()=> nextWordOrParagraph(), 350);
      }
    }
  };
  canListen = true;
}

function closeEnough(input, target){
  const last = input.trim().split(/\s+/).pop()||'';
  const dist = levenshtein(last, target);
  if (target.length <= 5) return dist <= 1;
  return dist <= 2;
}

function levenshtein(a,b){
  const m = [];
  for (let i=0;i<=a.length;i++){ m[i]=[i]; }
  for (let j=1;j<=b.length;j++){ m[0][j]=j; }
  for (let i=1;i<=a.length;i++){
    for (let j=1;j<=b.length;j++){
      const cost = a[i-1] === b[j-1] ? 0 : 1;
      m[i][j] = Math.min(
        m[i-1][j] + 1,
        m[i][j-1] + 1,
        m[i-1][j-1] + cost
      );
    }
  }
  return m[a.length][b.length];
}

function listen(){
  if (recog && canListen){
    try{ recog.start(); }catch(e){}
  }
}
function stopListening(){
  if (recog){
    canListen=false;
    try{ recog.stop(); }catch(e){}
  }
}

/* ---------------------------
   Result / Confetti
----------------------------*/
function finish(){
  stopListening();
  const overlay = document.getElementById('result');
  const final = document.getElementById('finalScore');
  const pct = Math.round((score/totalBlanks)*100);
  final.textContent = `„Éö„É©„Éö„É©„É¨„Éô„É´ ${pct}%`;
  overlay.style.display='flex';
  if (pct >= 85) launchConfetti(120);
  else if (pct >= 60) launchConfetti(60);
  else launchConfetti(30);
}
function launchConfetti(n=100){
  const c = document.getElementById('confetti');
  c.innerHTML='';
  const colors = ['#fff680','#ff7eb9','#5ee6ff','#a6f7b2','#c77dff'];
  for (let i=0;i<n;i++){
    const piece = document.createElement('i');
    piece.style.left = Math.random()*100 + 'vw';
    piece.style.background = `linear-gradient(180deg, ${colors[i%colors.length]}, #fff)`;
    piece.style.animationDelay = (Math.random()*0.8)+'s';
    piece.style.transform = `rotate(${(Math.random()*40-20)}deg)`;
    c.appendChild(piece);
  }
}

/* ---------------------------
   Buttons
----------------------------*/
btnPlay.addEventListener('click', ()=> playGuidedForCurrent());
btnRepeat.addEventListener('click', ()=> playGuidedForCurrent());
btnReveal.addEventListener('click', revealWord);
btnNext.addEventListener('click', ()=>{ btnNext.disabled=true; nextParagraph(); });

/* ---------------------------
   Init
----------------------------*/
function buildDotsInit(){
  elDots.innerHTML='';
  for (let i=0;i<PARAGRAPHS.length;i++){
    const d=document.createElement('div');
    d.className='dot';
    elDots.appendChild(d);
  }
}
buildDotsInit();
renderParagraph();
initRecog();
listen();
updateScore();
</script>

</body>
</html>
