<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Speak & Listen ‚Äì January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530;--ink:#fff;--gold1:#fdd86d;--gold2:#ffb347;
  --outline:#ffffff26;--radius:24px;
  --goldGlow:0 0 8px #facc15,0 0 20px #fde68a;
  --blueGlow:0 0 10px #60a5fa,0 0 20px #3b82f6;
  --greenGlow:0 0 10px #4ade80,0 0 20px #22c55e;
  --redGlow:0 0 10px #f87171,0 0 20px #ef4444;
  --purpleGlow:0 0 12px #c084fc,0 0 24px #a855f7;
  --pinkGlow:0 0 12px #f472b6,0 0 24px #ec4899;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--ink);
  min-height:100vh;display:flex;flex-direction:column;align-items:center;overflow:hidden;}
header{text-align:center;padding:1.3rem 0 1rem;font-family:'Cinzel',serif;}
header h1{font-size:clamp(1.4rem,4vw,2.2rem);letter-spacing:2px;text-shadow:0 0 10px rgba(255,255,255,.5);}
header h2{font-size:clamp(1rem,3vw,1.3rem);color:var(--gold1);text-shadow:var(--goldGlow);}
main{flex:1;display:flex;flex-direction:column;align-items:center;width:100%;max-width:700px;text-align:center;padding:0 1rem;}

.sageWrapper{position:relative;width:100%;display:flex;align-items:center;justify-content:center;margin-top:1rem;}
.playBtn{
  position:absolute;left:-18px;top:50%;transform:translateY(-50%);
  width:60px;height:60px;border-radius:50%;
  background:linear-gradient(135deg,var(--gold1),var(--gold2));
  box-shadow:0 0 12px rgba(255,255,255,.5),0 0 24px rgba(255,255,255,.3);
  display:flex;align-items:center;justify-content:center;cursor:pointer;animation:shimmer 2s infinite;z-index:5;
}
.playBtn::after{content:"‚ñ∂";color:#000;font-size:1.4rem;font-weight:900;}
@keyframes shimmer{0%,100%{box-shadow:0 0 10px #fff,0 0 20px #fff;}50%{box-shadow:0 0 20px #ffe27a,0 0 40px #ffd700;}}

#sageBox{width:100%;min-height:140px;border-radius:var(--radius);overflow:hidden;position:relative;
  font-size:clamp(1.4rem,5vw,2rem);font-weight:900;display:flex;align-items:center;justify-content:center;text-align:center;}
#sageBox::before{content:'';position:absolute;inset:0;z-index:0;
  animation:stripeMove 8s linear infinite;background-size:100% 300%;
  background:repeating-linear-gradient(to bottom,#ffd6ff,#caffbf,#9bf6ff,#a0c4ff,#ffadad);}
@keyframes stripeMove{0%{background-position:0 0;}100%{background-position:0 100%;}}
#sageText{position:relative;z-index:1;color:#fff;padding:0 1rem;font-weight:700;text-shadow:0 0 8px #000,0 0 16px #000;}
.word{opacity:0;margin:0 .45rem;transition:opacity .25s ease;}

.studentWrapper{position:relative;width:100%;margin-top:1rem;}
#studentBox{width:100%;min-height:90px;background:#fff;border-radius:var(--radius);margin-bottom:1.4rem;
  box-shadow:inset 0 0 20px rgba(0,0,0,.15);color:#000;font-size:1.3rem;
  display:flex;align-items:center;justify-content:center;padding:0.5rem 2.5rem;transition:all .3s;position:relative;}
#studentBox.active{box-shadow:0 0 20px 8px #22c55e;background:#e8ffe8;}
#studentBox.inactive{border:4px solid #ef4444;}
.micBtn{
  position:absolute;right:-18px;top:50%;transform:translateY(-50%);
  width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,#a855f7,#7e22ce);
  box-shadow:var(--purpleGlow);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;
}
.micBtn::after{content:"üé§";font-size:1.3rem;}

.option{border:2px solid var(--outline);border-radius:var(--radius);padding:1rem;margin:0.5rem 0;width:100%;
  font-size:clamp(1.1rem,4vw,1.4rem);font-weight:700;background:#00000020;cursor:pointer;transition:opacity .2s;}
.option.played{opacity:.6;}

#hintBox{margin-top:.8rem;font-size:1rem;color:var(--gold1);text-shadow:var(--goldGlow);}
.buttonsRow{display:flex;gap:.6rem;justify-content:center;margin-top:1rem;}
button{padding:.7rem 2rem;border-radius:var(--radius);
  color:#000;font-weight:900;font-family:'Cinzel',serif;font-size:1.1rem;border:none;cursor:pointer;}
#pointsBtn{background:linear-gradient(135deg,#3b82f6,#60a5fa);box-shadow:var(--blueGlow);}
#nextBtn{background:linear-gradient(135deg,#f472b6,#ec4899);box-shadow:var(--pinkGlow);}

#pointsContainer{position:fixed;bottom:1rem;right:1rem;display:flex;flex-direction:column;align-items:center;gap:0.3rem;}
#pointsLabel{color:var(--gold1);font-family:'Cinzel',serif;font-size:1rem;text-shadow:var(--goldGlow);}
#pointsCircle{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--gold1),var(--gold2));
  display:flex;align-items:center;justify-content:center;color:#000;font-family:'Cinzel',serif;
  font-size:1.4rem;font-weight:900;box-shadow:var(--goldGlow);transition:transform .3s;}
#counter{position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);font-family:'Cinzel',serif;color:#fff;font-size:1rem;}
footer{text-align:center;color:#fff;padding:1rem 0;font-family:'Cinzel',serif;font-size:0.9rem;letter-spacing:1px;text-shadow:0 0 6px rgba(255,255,255,.4);}
</style>
</head>
<body>
<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>Eigo Adventure ‚Äì January Week 1</h2>
</header>
<div id="pointsContainer">
  <div id="pointsLabel">Points</div>
  <div id="pointsCircle">0</div>
</div>
<main>
  <div class="sageWrapper">
    <div class="playBtn" id="playBtn"></div>
    <div id="sageBox"><div id="sageText"></div></div>
  </div>
  <div class="studentWrapper">
    <div id="studentBox" class="inactive">
      <div class="micBtn" id="micBtn"></div>
    </div>
  </div>
  <div id="options"></div>
  <div id="hintBox"></div>
  <div class="buttonsRow">
    <button id="pointsBtn">Points „É¢„Éº„Éâ</button>
    <button id="nextBtn">Ê¨°„Å∏ ‚ñ∂</button>
  </div>
</main>
<div id="counter">1 / 15</div>
<footer>Bryan‚Äôs English School</footer>
<script>
const EIGO="assets/audio/eigo.mp3";
const PRAISE=['yes_good_job.mp3','perfect_english.mp3','wow_nice_work.mp3'];
const TRY_AGAIN=['hmm_try_again.mp3','what_language_was_that.mp3','do_you_have_a_cookie_in_your_mouth.mp3'];

const questions=[
  {q:"What do you eat for breakfast?",a:0,audio:"what_do_you_eat_for_breakfast.mp3",answers:["I eat rice and miso soup for breakfast.","I eat curry for breakfast.","I eat toothpaste for breakfast.","I eat pencils and notebooks for breakfast."]},
  {q:"What do you do after school?",a:0,audio:"what_do_you_do_after_school.mp3",answers:["I do my homework after school.","I climb trees after school.","I build a spaceship after school.","I wrestle with ghosts after school."]},
  {q:"What do you do after dinner?",a:0,audio:"what_do_you_do_after_dinner.mp3",answers:["I help my parents clean the table after dinner.","I juggle spaghetti after dinner.","I play soccer in the kitchen after dinner.","I sleep under the table after dinner."]}
];

let current=0,points=0,recog,listening=false,playing=false,pointsMode=false,spokenSet=new Set();
const $=s=>document.querySelector(s);
const sageText=$("#sageText"),playBtn=$("#playBtn"),micBtn=$("#micBtn"),studentBox=$("#studentBox"),nextBtn=$("#nextBtn"),pointsBtn=$("#pointsBtn"),pointsCircle=$("#pointsCircle"),counter=$("#counter"),optionsBox=$("#options"),hintBox=$("#hintBox");

function normalize(s){return s.toLowerCase().replace(/[‚Äô‚Äò¬¥`]/g,"'").replace(/[^a-z0-9'\s]/g,' ').replace(/\s+/g,' ').trim();}
function pulsePoints(){pointsCircle.style.transform='scale(1.3)';setTimeout(()=>pointsCircle.style.transform='scale(1)',300);}
function updateUI(){pointsCircle.textContent=points;counter.textContent=(current+1)+' / '+questions.length;}
function animateWords(t){sageText.innerHTML='';t.split(' ').forEach((w,i)=>{const span=document.createElement('span');span.className='word';span.textContent=w;sageText.appendChild(span);setTimeout(()=>span.style.opacity=1,150*i);});}
function audioPlay(p){return new Promise(r=>{const a=new Audio(p);a.onended=r;a.onerror=r;a.play().catch(r);});}
function playLocalAudio(f){const p=f.includes('/')?f:`assets/audio/${f}`;return audioPlay(p);}

function initRecog(){const R=window.SpeechRecognition||window.webkitSpeechRecognition;if(!R)return;recog=new R();recog.lang='en-US';recog.interimResults=true;
  recog.onstart=()=>{listening=true;studentBox.classList.add('active');studentBox.classList.remove('inactive');studentBox.textContent='';};
  recog.onend=()=>{listening=false;studentBox.classList.remove('active');studentBox.classList.add('inactive');if(pointsMode)startMic();};
  recog.onresult=e=>{const t=Array.from(e.results).map(r=>r[0].transcript).join(' ');studentBox.textContent=t;checkSpeech(t);};}
function startMic(){if(!recog)initRecog();if(recog&&!listening){try{recog.start();}catch{}}}

async function playQuestion(){if(playing)return;playing=true;await navigator.mediaDevices.getUserMedia({audio:true}).catch(()=>{});const q=questions[current];animateWords(q.q);await playLocalAudio(q.audio);playing=false;startMic();}

function renderAnswers(){optionsBox.innerHTML='';spokenSet.clear();questions[current].answers.forEach((a,i)=>{const d=document.createElement('div');d.className='option';d.textContent=a;d.dataset.idx=i;optionsBox.appendChild(d);});}

async function checkSpeech(sp){const q=questions[current];
  if(pointsMode){
    for(const d of [...optionsBox.children]){
      const text=d.textContent;
      if(spokenSet.has(text))continue;
      if(normalize(sp)===normalize(text)){
        await playLocalAudio(PRAISE[Math.floor(Math.random()*PRAISE.length)]);
        await playLocalAudio(EIGO);
        points+=1;spokenSet.add(text);pulsePoints();updateUI();d.remove();return;
      }
    }
    await playLocalAudio(TRY_AGAIN[Math.floor(Math.random()*TRY_AGAIN.length)]);
    return;
  }
  let m=-1;for(let i=0;i<q.answers.length;i++){if(normalize(sp)===normalize(q.answers[i])){m=i;break;}}
  if(m===q.a){await playLocalAudio(PRAISE[Math.floor(Math.random()*PRAISE.length)]);await playLocalAudio(EIGO);points+=5;pulsePoints();updateUI();nextBtn.style.display='inline-block';pointsBtn.style.display='inline-block';}
  else if(m!==-1){await playLocalAudio(TRY_AGAIN[Math.floor(Math.random()*TRY_AGAIN.length)]);}  
}

function loadQ(){sageText.textContent='';studentBox.textContent='';renderAnswers();updateUI();nextBtn.style.display='none';pointsBtn.style.display='inline-block';}

playBtn.onclick=playQuestion;
micBtn.onclick=()=>{if(!recog)initRecog();if(listening){try{recog.stop();}catch{}}else startMic();};
nextBtn.onclick=()=>{try{if(listening)recog.stop();}catch{}current++;if(current>=questions.length)current=0;loadQ();};
pointsBtn.onclick=()=>{pointsMode=!pointsMode;pointsBtn.style.opacity=pointsMode?0.6:1;if(pointsMode)startMic();};

loadQ();
</script>
</body>
</html>
