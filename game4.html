<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Game 4 – Eigo Adventure!</title>
<meta name="theme-color" content="#ffffff" />
<link rel="icon" type="image/png" href="booha-ghost.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&display=swap" rel="stylesheet" />
<style>
:root{
  --ink:#111111; --muted:#5f6673; --bg:#f5f7fb; --radius:28px;
  --accent:#ff7eb9; --accent2:#5ee6ff; --gold:#ffd166; --good:#22c55e; --bad:#ef4444;
  --glow:#ffd6e8; --glow2:#fff3a6;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0}

/* Page */
html,body{height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif;}

/* Header */
header{
  padding:18px 16px 8px; text-align:center; font-family:'Cinzel',serif;
}
header h1{ font-size:clamp(28px,4.8vw,48px); letter-spacing:1px; font-weight:900;}
header h2{ font-size:clamp(16px,2.8vw,22px); color:var(--muted); margin-top:4px; font-weight:700;}

/* Card */
.card{
  width:min(1000px,92vw);
  margin:20px auto;
  background:#fff;
  border:2px solid rgba(0,0,0,.08);
  border-radius:var(--radius);
  box-shadow:0 30px 80px rgba(0,0,0,.12);
  overflow:hidden;
}

/* Top bar */
.top{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:14px 18px; background:#fafafa;
  border-bottom:1px solid rgba(0,0,0,.08);
}
.badge{
  font-family:'Cinzel',serif; font-weight:800;
  background:linear-gradient(90deg,#ff7eb9,#5ee6ff);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  letter-spacing:.5px;
}
.progress{
  display:flex; align-items:center; gap:10px; color:var(--muted); font-weight:600;
}
.progress .dot{
  width:10px;height:10px;border-radius:50%; background:#e2e6ef; box-shadow:0 0 6px rgba(0,0,0,.05) inset;
}
.progress .dot.active{ background:#7dd3fc; }
.score{
  font-weight:800; color:#00a86b;
}

/* Paragraph area */
.content{
  padding:20px clamp(14px,4vw,28px) 8px;
}
h3#paraTitle{
  font-family:'Cinzel',serif; font-weight:900;
  font-size:clamp(18px,3.6vw,26px);
  margin-bottom:14px; letter-spacing:.5px;
}

.sentenceBlock{
  padding:14px 0 12px;
  border-bottom:1px dashed rgba(0,0,0,.06);
}
.sentence{
  font-size:clamp(18px,2.6vw,24px);
  line-height:1.55;
}
.blank{
  display:inline-flex; align-items:center; justify-content:center;
  min-width:120px; padding:0 10px; margin:0 4px;
  border-bottom:3px dashed rgba(0,0,0,.35);
  color:#111; font-weight:800; letter-spacing:.5px;
  border-radius:10px;
}
.blank.waiting{ box-shadow:0 0 0 4px rgba(0,0,0,.06) inset; }
.blank.correct{
  background:linear-gradient(90deg,#fff680,#a6f7b2);
  color:#111; border-bottom-color:transparent; box-shadow:0 0 18px rgba(255,246,128,.55);
  animation:pop .35s ease;
}
@keyframes pop{ 0%{transform:scale(.92)} 100%{transform:scale(1)} }

.jp{
  margin-top:6px;
  color:#2e3340;
  font-size:clamp(14px,2.3vw,18px);
  text-shadow:0 0 10px var(--glow2);
}
.kana{
  margin-top:2px;
  color:#6b7280;
  font-size:clamp(13px,2.1vw,16px);
  text-shadow:0 0 8px var(--glow);
}

/* Controls */
.controls{
  display:flex; flex-wrap:wrap; gap:10px; padding:16px 18px 18px; justify-content:center;
  border-top:1px solid rgba(0,0,0,.08); background:#fafafa;
}
button{
  appearance:none; border:0; padding:12px 16px; border-radius:14px;
  font-weight:800; letter-spacing:.3px; cursor:pointer;
  color:#111; background:linear-gradient(90deg,#ff7eb9,#5ee6ff);
  box-shadow:0 12px 30px rgba(0,0,0,.12);
}
button.secondary{ color:#111; background:#eaeef7; }
button.good{ background:linear-gradient(90deg,#a6f7b2,#fff680); color:#111; }
button.bad{ background:#ef4444; color:#fff; }
button:disabled{ filter:grayscale(.5) brightness(.9); cursor:not-allowed; }

/* Mic indicator */
.mic{
  display:flex; align-items:center; gap:10px; color:#4b5563; font-weight:700;
}
.micDot{
  width:12px;height:12px;border-radius:50%; background:#cbd5e1;
  box-shadow:0 0 0 0 rgba(94,230,255,.45);
}
.mic.listening .micDot{ background:#5ee6ff; animation:ping 1.5s infinite; }
@keyframes ping{
  0%{ box-shadow:0 0 0 0 rgba(94,230,255,.45); }
  70%{ box-shadow:0 0 0 14px rgba(94,230,255,0); }
  100%{ box-shadow:0 0 0 0 rgba(94,230,255,0); }
}

/* Footer */
footer{
  text-align:center; color:#7b8391; padding:16px 0 28px; font-size:14px;
}

/* Result overlay */
#result{
  position:fixed; inset:0; background:rgba(0,0,0,.35);
  display:none; align-items:center; justify-content:center; z-index:9;
}
.resultCard{
  width:min(680px,92vw); background:#ffffff; border:2px solid rgba(0,0,0,.1);
  border-radius:24px; padding:24px; text-align:center;
  box-shadow:0 30px 100px rgba(0,0,0,.25);
}
.resultCard h2{ font-family:'Cinzel',serif; font-weight:900; font-size:clamp(26px,4.5vw,42px); margin-bottom:6px; color:#0b1530;}
.resultCard p{ color:#4b5563; margin-bottom:16px; }
.bigScore{ font-size:clamp(26px,6vw,56px); font-weight:900; color:#00a86b; margin:10px 0 20px; }

/* Confetti (simple) */
.confetti{
  position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:10;
}
.confetti i{
  position:absolute; width:8px; height:14px; top:-20px; opacity:.9;
  background:linear-gradient(180deg,#fff680,#ff7eb9);
  transform:rotate(10deg);
  animation:fetti 3.2s linear forwards;
}
@keyframes fetti{
  to{ transform:translateY(110vh) rotate(360deg); opacity:1;}
}
</style>
</head>
<body>

<header>
  <h1>The Boo-riculum</h1>
  <h2>ゲーム４：Eigo Adventure!（英語アドベンチャー）</h2>
</header>

<main class="card" id="app">
  <div class="top">
    <div class="badge">January – Goals & New Beginnings</div>
    <div class="progress">
      <div id="dots"></div>
      <div class="score" id="scoreLabel">Score: 0%</div>
    </div>
  </div>

  <div class="content">
    <h3 id="paraTitle">Paragraph 1 / 10</h3>
    <div id="sentences"></div>
  </div>

  <div class="controls">
    <button id="btnPlay">▶️ Play sentence</button>
    <button class="secondary" id="btnRepeat">↻ Repeat</button>
    <button class="secondary" id="btnReveal">👀 Reveal word</button>
    <button class="good" id="btnNext" disabled>Next →</button>
    <div class="mic" id="mic">
      <div class="micDot"></div> <span id="micText">Mic: ready</span>
    </div>
  </div>
</main>

<div id="result">
  <div class="resultCard">
    <h2>Adventure Complete!</h2>
    <p>Great listening, reading, and speaking.</p>
    <div class="bigScore" id="finalScore">ペラペラレベル 0%</div>
    <button onclick="location.href='index.html'" class="good">← Back to Game Deck</button>
  </div>
  <div class="confetti" id="confetti"></div>
</div>

<footer>
  Bryan's English School
</footer>

<script>
/* ---------------------------
   DATA: 10 paragraphs × 5
   Each item also includes kana lines.
----------------------------*/
const PARAGRAPHS = [
  { // 1 – Fresh Start
    en: [
      "It’s January, and I _____ start something new.",
      "Every morning, I write my _____ in my notebook.",
      "I _____ a little, even on weekends.",
      "I _____ because this year feels different.",
      "I will _____ to make every day special."
    ],
    answers: ["will","goals","study","smile","try"],
    jp: [
      "１月です。新しいことを始めます。",
      "毎朝、ノートに目標を書きます。",
      "週末でも少し勉強します。",
      "今年は違う気がして笑います。",
      "毎日を特別にするために挑戦します。"
    ],
    kana: [
      "いちがつです。あたらしいことをはじめます。",
      "まいあさ、ノートにもくひょうをかきます。",
      "しゅうまつでもすこしべんきょうします。",
      "ことしはちがうきがしてわらいます。",
      "まいにちをとくべつにするためにちょうせんします。"
    ]
  },
  { // 2 – The Plan
    en: [
      "I will wake up _____ and eat breakfast.",
      "I’m going to _____ before school.",
      "I will not be _____ anymore.",
      "I will _____ carefully in class.",
      "I will _____ my classmates when they need me."
    ],
    answers: ["early","read","late","listen","help"],
    jp: [
      "早起きして朝ごはんを食べます。",
      "学校の前に読みます。",
      "もう遅刻しません。",
      "授業でしっかり聞きます。",
      "クラスメイトを手伝います。"
    ],
    kana: [
      "はやおきしてあさごはんをたべます。",
      "がっこうのまえによみます。",
      "もうちこくしません。",
      "じゅぎょうでしっかりききます。",
      "クラスメイトをてつだいます。"
    ]
  },
  { // 3 – At School
    en: [
      "My teacher says, “Do your _____!”",
      "I will _____ my desk today.",
      "I will _____ more English in class.",
      "I will _____ new words in my notebook.",
      "I will _____ learning every subject."
    ],
    answers: ["best","clean","speak","write","enjoy"],
    jp: [
      "先生は「ベストを尽くして」と言います。",
      "今日は机を片づけます。",
      "授業で英語をもっと話します。",
      "ノートに新しい単語を書きます。",
      "すべての教科の学びを楽しみます。"
    ],
    kana: [
      "せんせいは「ベストをつくして」といいます。",
      "きょうはつくえをかたづけます。",
      "じゅぎょうでえいごをもっとはなします。",
      "ノートにあたらしいたんごをかきます。",
      "すべてのきょうかのまなびをたのしみます。"
    ]
  },
  { // 4 – Making Friends
    en: [
      "I will _____ a new friend this week.",
      "We will _____ about our favorite games.",
      "We will _____ home together.",
      "We will _____ at funny stories.",
      "Friendship makes school _____."
    ],
    answers: ["make","talk","walk","laugh","fun"],
    jp: [
      "今週、新しい友だちを作ります。",
      "好きなゲームについて話します。",
      "一緒に歩いて帰ります。",
      "おもしろい話に笑います。",
      "友情は学校を楽しくします。"
    ],
    kana: [
      "こんしゅう、あたらしいともだちをつくります。",
      "すきなゲームについてはなします。",
      "いっしょにあるいてかえります。",
      "おもしろいはなしにわらいます。",
      "ゆうじょうはがっこうをたのしくします。"
    ]
  },
  { // 5 – Good Habits
    en: [
      "I will _____ a good habit this month.",
      "I will _____ more books.",
      "I will _____ English every day.",
      "I will _____ yesterday’s lesson.",
      "I will _____ until it feels easy."
    ],
    answers: ["start","read","practice","review","continue"],
    jp: [
      "今月は良い習慣を始めます。",
      "もっと本を読みます。",
      "毎日英語を練習します。",
      "昨日のレッスンを復習します。",
      "簡単になるまで続けます。"
    ],
    kana: [
      "こんげつはよいしゅうかんをはじめます。",
      "もっとほんをよみます。",
      "まいにちえいごをれんしゅうします。",
      "きのうのレッスンをふくしゅうします。",
      "かんたんになるまでつづけます。"
    ]
  },
  { // 6 – Challenges
    en: [
      "Sometimes I will _____ my goal.",
      "Sometimes I will feel _____.",
      "I will _____ again and again.",
      "I will _____ on small steps.",
      "I will never _____ up."
    ],
    answers: ["forget","tired","try","focus","give"],
    jp: [
      "ときどき目標を忘れてしまいます。",
      "疲れることもあります。",
      "何度も挑戦します。",
      "小さな一歩に集中します。",
      "決してあきらめません。"
    ],
    kana: [
      "ときどきもくひょうをわすれてしまいます。",
      "つかれることもあります。",
      "なんどもちょうせんします。",
      "ちいさないっぽにしゅうちゅうします。",
      "けっしてあきらめません。"
    ]
  },
  { // 7 – At Home
    en: [
      "After school, I will _____ my room.",
      "I will _____ my family with dinner.",
      "I will _____ before playing games.",
      "I will _____ my parents my homework.",
      "I will _____ them for helping me."
    ],
    answers: ["clean","help","study","show","thank"],
    jp: [
      "放課後、部屋を掃除します。",
      "夕食を家族と手伝います。",
      "ゲームの前に勉強します。",
      "宿題を両親に見せます。",
      "手伝ってくれたことに感謝します。"
    ],
    kana: [
      "ほうかご、へやをそうじします。",
      "ゆうしょくをかぞくとてつだいます。",
      "ゲームのまえにべんきょうします。",
      "しゅくだいをりょうしんにみせます。",
      "てつだってくれたことにかんしゃします。"
    ]
  },
  { // 8 – Free Time
    en: [
      "On weekends, I will _____ pictures.",
      "I will _____ to music in English.",
      "I will _____ a movie with subtitles.",
      "I will _____ new words from songs.",
      "I will _____ and feel proud."
    ],
    answers: ["draw","listen","watch","learn","relax"],
    jp: [
      "週末は絵を描きます。",
      "英語の音楽を聴きます。",
      "字幕付きの映画を見ます。",
      "歌から新しい単語を学びます。",
      "リラックスして誇らしく思います。"
    ],
    kana: [
      "しゅうまつはえをかきます。",
      "えいごのおんがくをききます。",
      "じまくつきのえいがをみます。",
      "うたからあたらしいたんごをまなびます。",
      "リラックスしてほこらしくおもいます。"
    ]
  },
  { // 9 – Reflection
    en: [
      "I think about my _____ every week.",
      "I will _____ what I learned.",
      "I will _____ my ideas with my teacher.",
      "I will _____ small successes.",
      "I will _____ to keep going."
    ],
    answers: ["progress","remember","share","celebrate","promise"],
    jp: [
      "毎週、自分の進歩について考えます。",
      "学んだことを覚えておきます。",
      "先生と自分の考えを共有します。",
      "小さな成功を祝います。",
      "続けることを約束します。"
    ],
    kana: [
      "まいしゅう、じぶんのしんぽについてかんがえます。",
      "まなんだことをおぼえておきます。",
      "せんせいとじぶんのかんがえをきょうゆうします。",
      "ちいさなせいこうをいわいます。",
      "つづけることをやくそくします。"
    ]
  },
  { // 10 – The Goal
    en: [
      "This year, I will _____ in many ways.",
      "I will _____ in myself.",
      "I will _____ big and stay kind.",
      "I will _____ English with confidence.",
      "I will _____ like a Booha star."
    ],
    answers: ["grow","believe","dream","speak","shine"],
    jp: [
      "今年、いろいろな面で成長します。",
      "自分を信じます。",
      "大きな夢を持ち、親切にします。",
      "自信を持って英語を話します。",
      "ブーハの星のように輝きます。"
    ],
    kana: [
      "ことし、いろいろなめんでせいちょうします。",
      "じぶんをしんじます。",
      "おおきなゆめをもち、しんせつにします。",
      "じしんをもってえいごをはなします。",
      "ブーハのほしのようにかがやきます。"
    ]
  }
];

let currentPara = 0;
let currentSent = 0;
let score = 0;
let totalBlanks = PARAGRAPHS.reduce((a,p)=>a+p.answers.length,0);

const elSentences = document.getElementById('sentences');
const elParaTitle = document.getElementById('paraTitle');
const elDots = document.getElementById('dots');
const elScore = document.getElementById('scoreLabel');
const elMic = document.getElementById('mic');
const elMicText = document.getElementById('micText');

const btnPlay = document.getElementById('btnPlay');
const btnRepeat = document.getElementById('btnRepeat');
const btnReveal = document.getElementById('btnReveal');
const btnNext = document.getElementById('btnNext');

/* ---------------------------
   Speech Synthesis helpers (Sage-like pacing)
----------------------------*/
function speakFull(text, {rate=0.9}={}) {
  if (!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = rate; u.pitch = 1;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}
function speakPart(text, {rate=0.95}={}) {
  if (!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US'; u.rate = rate; u.pitch = 1;
  window.speechSynthesis.speak(u);
}

/* Wait/continue state */
let waitingForAnswer = false;
let waitTimer = null;
let continuedOnce = false;

/* Build top dots */
function buildDots(){
  elDots.innerHTML='';
  for (let i=0;i<PARAGRAPHS.length;i++){
    const d=document.createElement('div');
    d.className='dot'+(i===currentPara?' active':'');
    elDots.appendChild(d);
  }
}
function updateScore(){
  const pct = Math.round((score/totalBlanks)*100);
  elScore.textContent = `Score: ${pct}%`;
}

function renderParagraph(){
  const p = PARAGRAPHS[currentPara];
  elParaTitle.textContent = `Paragraph ${currentPara+1} / ${PARAGRAPHS.length}`;
  elSentences.innerHTML='';
  currentSent = 0;

  // sentences + blanks + JP/Kana
  p.en.forEach((line,idx)=>{
    const block = document.createElement('div');
    block.className='sentenceBlock';

    const s = document.createElement('div');
    s.className='sentence';
    const parts = line.split('_____');
    const spanBefore = document.createElement('span');
    spanBefore.textContent = parts[0] || '';
    const blank = document.createElement('span');
    blank.className='blank';
    blank.dataset.idx = idx;
    blank.textContent = '__________';
    const spanAfter = document.createElement('span');
    spanAfter.textContent = parts[1] || '';
    s.append(spanBefore, blank, spanAfter);

    const j = document.createElement('div');
    j.className = 'jp';
    j.textContent = p.jp[idx];

    const k = document.createElement('div');
    k.className = 'kana';
    k.textContent = p.kana[idx];

    block.append(s, j, k);
    elSentences.appendChild(block);
  });

  buildDots();
  updateActiveBlank();
  updateScore();
  btnNext.disabled = true;
}

function activeBlankEl(){
  return elSentences.querySelector(`.blank[data-idx="${currentSent}"]`);
}
function updateActiveBlank(){
  elSentences.querySelectorAll('.blank').forEach(b=>b.classList.remove('waiting'));
  const b = activeBlankEl();
  if (b) b.classList.add('waiting');
}

/* Plays prefix, waits for student, then continues suffix.
   If timeout (~8s), gives hint by reading full sentence slowly. */
function playGuidedForCurrent(){
  const p = PARAGRAPHS[currentPara];
  const line = p.en[currentSent];
  const [prefix, suffixRaw=''] = line.split('_____');
  const suffix = suffixRaw.trim(); // includes any trailing words after blank

  // reset state
  clearTimeout(waitTimer);
  waitingForAnswer = true;
  continuedOnce = false;

  if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  // 1) Speak the prefix up to the blank
  speakPart(prefix.trim(), {rate:0.95});

  // 2) Start timeout for hint
  waitTimer = setTimeout(()=>{
    if (!continuedOnce) {
      // Speak the entire sentence as a slow hint
      speakFull(line.replace('_____','').trim(), {rate:0.8});
      continuedOnce = true;
    }
  }, 8000);
}

/* Continue the suffix after a correct answer (only once). */
function continueSuffixAfterAnswer(){
  if (continuedOnce) return;
  const p = PARAGRAPHS[currentPara];
  const line = p.en[currentSent];
  const [prefix, suffixRaw=''] = line.split('_____');
  const suffix = suffixRaw.trim();
  if (!suffix) { continuedOnce = true; return; }
  // Speak the rest of the sentence
  speakPart(suffix, {rate:0.95});
  continuedOnce = true;
}

/* Reveal + advance helpers */
function revealWord(){
  const p = PARAGRAPHS[currentPara];
  const ans = p.answers[currentSent];
  const b = activeBlankEl();
  if (!b) return;
  b.textContent = ans;
  b.classList.add('correct');
  b.classList.remove('waiting');
  score++; updateScore();
  continueSuffixAfterAnswer();
  nextWordOrParagraph(350);
}

function nextWordOrParagraph(delay=250){
  clearTimeout(waitTimer);
  waitingForAnswer = false;

  const p = PARAGRAPHS[currentPara];
  currentSent++;
  if (currentSent >= p.en.length){
    // Paragraph complete
    btnNext.disabled = false;
    btnNext.focus();
    stopListening();
  }else{
    updateActiveBlank();
  }
}

function nextParagraph(){
  currentPara++;
  if (currentPara >= PARAGRAPHS.length){
    finish();
  }else{
    renderParagraph();
    listen(); // re-arm mic
  }
}

/* ---------------------------
   Speech Recognition (wait-for-answer)
----------------------------*/
let recog, canListen=false;
function initRecog(){
  const R = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!R){
    elMicText.textContent = 'Mic: unavailable';
    return;
  }
  recog = new R();
  recog.lang = 'en-US';
  recog.interimResults = true;
  recog.continuous = true;

  recog.onstart = ()=>{ elMic.classList.add('listening'); elMicText.textContent='Listening…'; };
  recog.onend   = ()=>{ elMic.classList.remove('listening'); elMicText.textContent= canListen?'Listening paused':'Mic: ready'; if (canListen) try{recog.start();}catch(e){} };
  recog.onerror = ()=>{ elMic.classList.remove('listening'); elMicText.textContent='Mic error'; };

  recog.onresult = (e)=>{
    const p = PARAGRAPHS[currentPara];
    const target = p.answers[currentSent]?.toLowerCase();
    if (!target) return;
    let said = '';
    for (let i = e.resultIndex; i < e.results.length; i++){
      said += e.results[i][0].transcript + ' ';
    }
    said = said.toLowerCase();

    // Accept close matches
    const ok = said.includes(target) || closeEnough(said, target);
    if (ok && waitingForAnswer){
      const b = activeBlankEl();
      if (b){
        b.textContent = p.answers[currentSent];
        b.classList.add('correct');
        b.classList.remove('waiting');
        score++; updateScore();
        waitingForAnswer = false;
        clearTimeout(waitTimer);
        continueSuffixAfterAnswer();
        // short delay so students see success before moving
        setTimeout(()=> nextWordOrParagraph(), 350);
      }
    }
  };
  canListen = true;
}

function closeEnough(input, target){
  const last = input.trim().split(/\s+/).pop()||'';
  const dist = levenshtein(last, target);
  if (target.length <= 5) return dist <= 1;
  return dist <= 2;
}

function levenshtein(a,b){
  const m = [];
  for (let i=0;i<=a.length;i++){ m[i]=[i]; }
  for (let j=1;j<=b.length;j++){ m[0][j]=j; }
  for (let i=1;i<=a.length;i++){
    for (let j=1;j<=b.length;j++){
      const cost = a[i-1] === b[j-1] ? 0 : 1;
      m[i][j] = Math.min(
        m[i-1][j] + 1,
        m[i][j-1] + 1,
        m[i-1][j-1] + cost
      );
    }
  }
  return m[a.length][b.length];
}

function listen(){
  if (recog && canListen){
    try{ recog.start(); }catch(e){}
  }
}
function stopListening(){
  if (recog){
    canListen=false;
    try{ recog.stop(); }catch(e){}
  }
}

/* ---------------------------
   Result / Confetti
----------------------------*/
function finish(){
  stopListening();
  const overlay = document.getElementById('result');
  const final = document.getElementById('finalScore');
  const pct = Math.round((score/totalBlanks)*100);
  final.textContent = `ペラペラレベル ${pct}%`;
  overlay.style.display='flex';
  if (pct >= 85) launchConfetti(120);
  else if (pct >= 60) launchConfetti(60);
  else launchConfetti(30);
}
function launchConfetti(n=100){
  const c = document.getElementById('confetti');
  c.innerHTML='';
  const colors = ['#fff680','#ff7eb9','#5ee6ff','#a6f7b2','#c77dff'];
  for (let i=0;i<n;i++){
    const piece = document.createElement('i');
    piece.style.left = Math.random()*100 + 'vw';
    piece.style.background = `linear-gradient(180deg, ${colors[i%colors.length]}, #fff)`;
    piece.style.animationDelay = (Math.random()*0.8)+'s';
    piece.style.transform = `rotate(${(Math.random()*40-20)}deg)`;
    c.appendChild(piece);
  }
}

/* ---------------------------
   Buttons
----------------------------*/
btnPlay.addEventListener('click', ()=> playGuidedForCurrent());
btnRepeat.addEventListener('click', ()=> playGuidedForCurrent());
btnReveal.addEventListener('click', revealWord);
btnNext.addEventListener('click', ()=>{ btnNext.disabled=true; nextParagraph(); });

/* ---------------------------
   Init
----------------------------*/
function buildDotsInit(){
  elDots.innerHTML='';
  for (let i=0;i<PARAGRAPHS.length;i++){
    const d=document.createElement('div');
    d.className='dot';
    elDots.appendChild(d);
  }
}
buildDotsInit();
renderParagraph();
initRecog();
listen();
updateScore();
</script>

</body>
</html>
