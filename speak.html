<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,viewport-fit=cover" />
<title>Booha Speak & Repeat – January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{--bg:#0b1530;--ink:#fff;--outline:#ffffff26;--radius:26px;}
*{box-sizing:border-box;margin:0}
body{background:var(--bg);color:var(--ink);font-family:"Noto Sans JP",sans-serif;}
header{text-align:center;padding:24px 10px}
.h1{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(34px,6vw,54px)}
.h2{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(22px,4.5vw,36px)}
.h3{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(16px,3.6vw,22px)}
.h4{font-weight:800;font-size:clamp(14px,3.4vw,20px);color:#cfe1ff}
footer{text-align:center;color:#c9d4ec;font-family:'Cinzel',serif;font-weight:700;padding:30px 10px}
.wrap{max-width:1100px;margin:auto;padding:0 16px 80px}
.panel{padding:20px;border:1px solid var(--outline);border-radius:var(--radius);
background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));}
.card{position:relative;border:1px solid var(--outline);border-radius:var(--radius);
padding:22px 16px 22px 80px;margin-bottom:10px;overflow:hidden;background:rgba(255,255,255,.04)}
.en{font-weight:900;font-size:clamp(26px,7.4vw,48px);text-align:center;line-height:1.25}
.en .word{display:inline-block;padding:0 .06em;color:#fff;transition:color .25s ease}
.en .word.blue{color:#60a5fa}
.heart{position:absolute;left:0;top:0;transform:translate(-50%,0);font-size:22px;color:#ff7eb9;opacity:0;
animation:heartUp .9s ease-out forwards}
@keyframes heartUp{0%{transform:translate(-50%,0) scale(1);opacity:1}
100%{transform:translate(-50%,-60px) scale(1.4);opacity:0}}
.playBtn{position:absolute;left:16px;top:50%;transform:translateY(-50%);
width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;display:grid;place-items:center;
font-weight:900;font-size:20px;color:#351b00;
background:radial-gradient(circle at 30% 30%,#ffe8a3,#ffd36a 60%,#ffb800 100%);
box-shadow:0 0 0 3px rgba(255,213,120,.35),0 0 16px rgba(255,214,120,.45),
inset 0 3px 6px rgba(255,255,255,.6),inset 0 -6px 14px rgba(201,112,0,.55);
animation:goldPulse 1.8s ease-in-out infinite}
@keyframes goldPulse{
0%,100%{box-shadow:0 0 0 3px rgba(255,213,120,.25),0 0 10px rgba(255,214,120,.35),
inset 0 2px 5px rgba(255,255,255,.55),inset 0 -6px 14px rgba(201,112,0,.55);}
50%{box-shadow:0 0 0 4px rgba(255,213,120,.45),0 0 22px rgba(255,214,120,.85),
inset 0 4px 8px rgba(255,255,255,.85),inset 0 -8px 18px rgba(201,112,0,.75);}
}
.sweep{position:absolute;top:0;left:-100%;width:100%;height:100%;background:#fff680;opacity:.85;z-index:0}
.jp{text-align:center;font-weight:700;font-size:clamp(16px,3.8vw,22px);color:#d8e7ff}
.hira{text-align:center;font-size:clamp(14px,3.4vw,18px);color:#bcd3ff;margin-top:6px}
.meterWrap{display:flex;justify-content:center;margin:22px 0}
.meter{position:relative;width:min(64vw,280px);height:min(64vw,280px);display:grid;place-items:center}
.ring{position:absolute;inset:0;border-radius:50%;
background:conic-gradient(#ff7eb9,#a6f7b2,#7dd3fc,#fff680,#c77dff,#8aff80,#ff7eb9);
-webkit-mask:radial-gradient(circle,transparent 60%,black 62%);
mask:radial-gradient(circle,transparent 60%,black 62%);
animation:rainbowCycle 2.8s linear infinite}
@keyframes rainbowCycle{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
.meterCore{position:absolute;inset:12%;border-radius:50%;
background:radial-gradient(circle at 50% 40%,rgba(255,255,255,.2),rgba(255,255,255,.05));
display:grid;place-items:center;text-align:center;animation:corePulse 3s ease-in-out infinite}
@keyframes corePulse{0%,100%{transform:scale(1)}50%{transform:scale(1.12)}}
.meterText{font-weight:900;font-size:clamp(18px,6vw,28px)}
.btnRow{display:flex;justify-content:center;gap:10px;margin-top:10px}
.btn{border:none;border-radius:999px;padding:14px 20px;font-weight:900;font-size:clamp(18px,4vw,22px);cursor:pointer}
.btn.begin{background:linear-gradient(180deg,#1ee99a,#0ea85d);color:#002a11}
.btn.retry{background:linear-gradient(180deg,#8ec5ff,#1e6eff);color:#00163a}
.btn.next{background:linear-gradient(180deg,#ff9ad7,#ff4fa6);color:#38001a}
.btn:disabled{opacity:.5;cursor:not-allowed}
.scoreBox{margin:14px auto 6px;max-width:620px;text-align:center;padding:14px 16px;border-radius:18px;
background:rgba(255,255,255,.05);font-weight:900;font-size:clamp(18px,4.2vw,24px)}
</style>
</head>
<body>
<header>
<div class="h1">THE BOO-RICULUM</div>
<div class="h2">SPEAK & REPEAT</div>
<div class="h3">January Week 1 – Speaking Practice</div>
<div class="h4">１月第１週 – スピーキング練習</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="card">
      <button id="playBtn" class="playBtn">▶</button>
      <div id="sweep" class="sweep"></div>
      <div id="en" class="en">Press スタート to start</div>
    </div>
    <div id="jp" class="jp"></div>
    <div id="hira" class="hira"></div>

    <div class="meterWrap">
      <div class="meter">
        <div id="ring" class="ring"></div>
        <div class="meterCore"><div id="meterText" class="meterText">リスニング中</div></div>
      </div>
    </div>

    <div class="btnRow">
      <button id="beginBtn" class="btn begin">スタート<br><small>Start</small></button>
      <button id="retryBtn" class="btn retry" style="display:none">もう一回</button>
      <button id="nextBtn" class="btn next" style="display:none">つぎへ</button>
    </div>
    <div id="scoreBox" class="scoreBox" style="display:none"></div>
  </div>
</div>

<footer>Bryan’s English School</footer>

<script>
const ITEMS=[
{en:"What is your goal this year?",jp:"今年の目標は何ですか。",hira:"(ことし の もくひょう は なん です か)"},
{en:"Why is it important to you?",jp:"あなたにとってなぜ大切ですか。",hira:"(あなた に とって なぜ たいせつ です か)"},
{en:"How will you reach your goal?",jp:"どうやって目標を達成しますか。",hira:"(どうやって もくひょう を たっせい します か)"},
{en:"Who helps you stay motivated?",jp:"やる気を保つのを誰が助けてくれますか。",hira:"(やるき を たもつ の を だれ が たすけて くれ ます か)"},
{en:"What habit do you want to change?",jp:"変えたい習慣は何ですか。",hira:"(かえたい しゅうかん は なん です か)"},
{en:"Do you like making resolutions?",jp:"新年の目標を立てるのは好きですか。",hira:"(しんねん の もくひょう を たてる の は すき です か)"},
{en:"What do you want to try this year?",jp:"今年挑戦したいことは何ですか。",hira:"(ことし ちょうせん したい こと は なん です か)"},
{en:"What’s something new you learned recently?",jp:"最近新しく学んだことは何ですか。",hira:"(さいきん あたらしく まなんだ こと は なん です か)"},
{en:"Is it easy to keep goals?",jp:"目標を続けるのは簡単ですか。",hira:"(もくひょう を つづける の は かんたん です か)"},
{en:"What happens when you don’t try?",jp:"挑戦しないとどうなりますか。",hira:"(ちょうせん しない と どう なり ます か)"},
{en:"What makes you feel proud?",jp:"何があなたを誇らしくさせますか。",hira:"(なに が あなた を ほこらしく させ ます か)"},
{en:"What’s your dream for the future?",jp:"将来の夢は何ですか。",hira:"(しょうらい の ゆめ は なん です か)"},
{en:"How do you stay positive?",jp:"どうやって前向きでいられますか。",hira:"(どうやって まえむき で いられ ます か)"},
{en:"Who inspires you?",jp:"あなたに影響を与える人は誰ですか。",hira:"(あなた に えいきょう を あたえる ひと は だれ です か)"},
{en:"How can English help your goals?",jp:"英語はあなたの目標にどう役立ちますか。",hira:"(えいご は あなた の もくひょう に どう やくだち ます か)"}
];
const enEl=document.getElementById('en'),jpEl=document.getElementById('jp'),hiraEl=document.getElementById('hira');
const beginBtn=document.getElementById('beginBtn'),retryBtn=document.getElementById('retryBtn'),
nextBtn=document.getElementById('nextBtn'),scoreBox=document.getElementById('scoreBox'),
meterText=document.getElementById('meterText'),playBtn=document.getElementById('playBtn'),
sweep=document.getElementById('sweep');
let idx=0,listening=false,currentSage=null,SR;

function stripForFile(s){return s.toLowerCase().replace(/[^a-z0-9]/g,'');}
function playSage(en){
 if(listening)return;
 const f='./audio/'+stripForFile(en)+'.mp3';
 if(currentSage){currentSage.pause();currentSage=null;}
 const a=new Audio(f);a.preload='auto';a.volume=1;a.play().catch(()=>{});currentSage=a;
}
function mountWords(t){enEl.innerHTML=t.split(/\s+/).map(w=>`<span class="word">${w}</span>`).join(' ');}
function popHeartAt(el){
 const h=document.createElement('span');h.className='heart';h.textContent='❤';
 const r=el.getBoundingClientRect(),pr=enEl.getBoundingClientRect();
 h.style.left=(r.left-pr.left+r.width/2)+'px';h.style.top=(r.top-pr.top)+'px';
 enEl.appendChild(h);setTimeout(()=>h.remove(),900);
}
function markSpoken(txt){
 if(!txt)return;
 const set=new Set(txt.toLowerCase().split(' '));
 enEl.querySelectorAll('.word').forEach(w=>{
   const s=w.textContent.toLowerCase();
   if(set.has(s)&&!w.classList.contains('blue')){
     w.classList.add('blue');popHeartAt(w);
   }
 });
}
function keywordScore(target,spoken){
 const keys=target.toLowerCase().split(' ').filter(w=>w.length>2);
 const said=' '+spoken.toLowerCase()+' ';
 let hit=0;for(const k of keys){if(said.includes(' '+k+' '))hit++;}
 return Math.round((hit/keys.length)*100);
}
function showItem(){
 const it=ITEMS[idx];mountWords(it.en);
 jpEl.textContent=it.jp;hiraEl.textContent=it.hira;scoreBox.style.display='none';
}
async function beginRound(){
 listening=true;playBtn.disabled=true;meterText.textContent='リスニング中';
 sweep.style.left='-100%';sweep.style.transition='none';
 SR=new(window.SpeechRecognition||window.webkitSpeechRecognition)();
 SR.lang='en-US';SR.continuous=false;SR.interimResults=true;
 let heard="";
 SR.onresult=e=>{
   let txt="";for(let i=e.resultIndex;i<e.results.length;i++){txt+=e.results[i][0].transcript+" ";}
   heard=txt.trim();markSpoken(heard);
 };
 SR.start();
 const dur=3000,start=performance.now();
 (function step(t){
   const p=Math.min((t-start)/dur,1);
   sweep.style.left=(p*100-100)+'%';
   if(p<1)requestAnimationFrame(step);
 })();
 await new Promise(r=>setTimeout(r,3000));
 SR.stop();listening=false;playBtn.disabled=false;
 const s=keywordScore(ITEMS[idx].en,heard);
 meterText.textContent=s+"%";
 scoreBox.textContent="スコア："+s+"％";
 scoreBox.style.display='block';
 nextBtn.style.display=(s>=75)?'inline-block':'none';
 retryBtn.style.display=(s<75)?'inline-block':'none';
}
beginBtn.onclick=()=>{showItem();beginRound();};
retryBtn.onclick=()=>beginRound();
nextBtn.onclick=()=>{idx++;if(idx>=ITEMS.length){enEl.textContent="Great work today!";
jpEl.textContent="よくできました！";hiraEl.textContent="";nextBtn.style.display='none';retryBtn.style.display='none';beginBtn.style.display='none';return;}showItem();};
playBtn.onclick=()=>playSage(ITEMS[idx].en);
showItem();
</script>
</body>
</html>
