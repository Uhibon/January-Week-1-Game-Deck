<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,viewport-fit=cover" />
<title>Booha Speak & Repeat ‚Äì January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />

<!-- Preload score sounds -->
<link rel="preload" as="audio" href="assets/audio/0-43.mp3" />
<link rel="preload" as="audio" href="assets/audio/44-74.mp3" />
<link rel="preload" as="audio" href="assets/audio/75-99.mp3" />
<link rel="preload" as="audio" href="assets/audio/100.mp3" />

<style>
:root{--bg:#0b1530;--ink:#fff;--outline:#ffffff26;--radius:26px;}
*{box-sizing:border-box;margin:0}
body{background:var(--bg);color:var(--ink);font-family:"Noto Sans JP",sans-serif;}
header{text-align:center;padding:24px 10px}
.h1{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(34px,6vw,54px)}
.h2{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(22px,4.5vw,36px)}
.h3{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(16px,3.6vw,22px)}
.h4{font-weight:800;font-size:clamp(14px,3.4vw,20px);color:#cfe1ff}
footer{text-align:center;color:#c9d4ec;font-family:'Cinzel',serif;font-weight:700;padding:30px 10px}
.wrap{max-width:1100px;margin:auto;padding:0 16px 80px}
.panel{padding:20px;border:1px solid var(--outline);border-radius:var(--radius);
background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));}
.card{position:relative;border:1px solid var(--outline);border-radius:var(--radius);
padding:22px 16px 22px 80px;margin-bottom:10px;overflow:hidden;background:rgba(255,255,255,.04)}

/* Sweeping yellow meter */
.sweep{position:absolute;inset:0;width:100%;height:100%;
background:linear-gradient(0deg,rgba(255,246,128,.9),rgba(255,246,128,.7));
mix-blend-mode:screen;opacity:.75;border-radius:6px;transform:translateX(-100%);z-index:0;}
@keyframes sweepAcross{from{transform:translateX(-100%)}to{transform:translateX(0%)}}
.sweep.run{animation:sweepAcross var(--dur,6s) linear forwards;}

.en{font-weight:900;font-size:clamp(26px,7.4vw,48px);text-align:center;line-height:1.25;
position:relative;z-index:3;}
.en .word{display:inline-block;padding:0 .06em;color:#fff;transition:color .2s,transform .2s}
.en .word.blue{color:#3aa0ff;text-shadow:0 0 12px #3aa0ff,0 0 24px #3aa0ff;transform:translateY(-8px) scale(1.08);}
.en .word.red{color:#ff2a2a;text-shadow:0 0 10px #ff2a2a,0 0 18px #ff2a2a}

/* Hearts */
.heart{position:absolute;left:0;top:0;transform:translate(-50%,0);
font-size:22px;color:#ff7eb9;opacity:0;z-index:4;animation:heartUp .9s ease-out forwards;}
@keyframes heartUp{0%{transform:translate(-50%,0) scale(1);opacity:1}
100%{transform:translate(-50%,-60px) scale(1.4);opacity:0}}

/* Gold play */
.playBtn{position:absolute;left:16px;top:50%;transform:translateY(-50%);
width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;display:grid;place-items:center;
font-weight:900;font-size:20px;color:#351b00;z-index:3;
background:radial-gradient(circle at 30% 30%,#ffe8a3,#ffd36a 60%,#ffb800 100%);
box-shadow:0 0 0 3px rgba(255,213,120,.35),0 0 16px rgba(255,214,120,.45),
inset 0 3px 6px rgba(255,255,255,.6),inset 0 -6px 14px rgba(201,112,0,.55);
animation:goldPulse 1.8s ease-in-out infinite;}
@keyframes goldPulse{0%,100%{box-shadow:0 0 0 3px rgba(255,213,120,.25),0 0 10px rgba(255,214,120,.35),
inset 0 2px 5px rgba(255,255,255,.55),inset 0 -6px 14px rgba(201,112,0,.55)}
50%{box-shadow:0 0 0 4px rgba(255,213,120,.45),0 0 22px rgba(255,214,120,.85),
inset 0 4px 8px rgba(255,255,255,.85),inset 0 -8px 18px rgba(201,112,0,.75)}}

.jp{text-align:center;font-weight:700;font-size:clamp(16px,3.8vw,22px);color:#d8e7ff}
.hira{text-align:center;font-size:clamp(14px,3.4vw,18px);color:#bcd3ff;margin-top:6px}

/* rainbow circle */
.meterWrap{display:flex;justify-content:center;margin:22px 0}
.meter{position:relative;width:min(64vw,280px);height:min(64vw,280px);display:grid;place-items:center}
.ring{position:absolute;inset:0;border-radius:50%;
background:conic-gradient(#ff7eb9,#a6f7b2,#7dd3fc,#fff680,#c77dff,#8aff80,#ff7eb9);
-webkit-mask:radial-gradient(circle,transparent 60%,black 62%);
mask:radial-gradient(circle,transparent 60%,black 62%);
animation:rainbowCycle 3s linear infinite;}
@keyframes rainbowCycle{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
.meterCore{position:absolute;inset:12%;border-radius:50%;
background:radial-gradient(circle at 50% 40%,rgba(255,255,255,.2),rgba(255,255,255,.05));
display:grid;place-items:center;text-align:center;transition:transform .3s ease;}
.meterCore.bigPulse{animation:bigPulse 1.4s ease-in-out infinite;}
@keyframes bigPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.25)}}
.meterText{font-weight:900;font-size:clamp(18px,6vw,28px);line-height:1.25;}
.shimmer{background:linear-gradient(90deg,#fff,#ffd1f3,#d1ffe3,#d1e6ff,#fff680,#ffd1f3,#fff);
-webkit-background-clip:text;background-clip:text;color:transparent;background-size:300% 100%;
animation:shimmerMove 1.2s linear infinite;text-shadow:0 0 18px rgba(255,255,255,.25);}
@keyframes shimmerMove{0%{background-position:0% 0}100%{background-position:100% 0}}

.btnRow{display:flex;justify-content:center;gap:10px;margin-top:10px}
.btn{border:none;border-radius:999px;padding:14px 20px;font-weight:900;font-size:clamp(18px,4vw,22px);cursor:pointer}
.btn.begin{background:linear-gradient(180deg,#1ee99a,#0ea85d);color:#002a11}
.btn.retry{background:linear-gradient(180deg,#8ec5ff,#1e6eff);color:#00163a}
.btn.next{background:linear-gradient(180deg,#ff9ad7,#ff4fa6);color:#38001a}
.scoreBox{margin:14px auto 6px;max-width:620px;text-align:center;padding:14px 16px;border-radius:18px;
background:rgba(255,255,255,.05);font-weight:900;font-size:clamp(18px,4.2vw,24px)}
</style>
</head>
<body>
<header>
  <div class="h1">THE BOO-RICULUM</div>
  <div class="h2">SPEAK & REPEAT</div>
  <div class="h3">January Week 1 ‚Äì Speaking Practice</div>
  <div class="h4">ÔºëÊúàÁ¨¨ÔºëÈÄ± ‚Äì „Çπ„Éî„Éº„Ç≠„É≥„Ç∞Á∑¥Áøí</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="card">
      <div id="sweep" class="sweep"></div>
      <button id="playBtn" class="playBtn">‚ñ∂</button>
      <div id="en" class="en">Press „Çπ„Çø„Éº„Éà to start</div>
    </div>
    <div id="jp" class="jp"></div>
    <div id="hira" class="hira"></div>

    <div class="meterWrap">
      <div class="meter">
        <div class="ring"></div>
        <div id="meterCore" class="meterCore"><div id="meterText" class="meterText">Ready<br><small>„Çπ„Çø„É≥„Éê„Ç§</small></div></div>
      </div>
    </div>

    <div class="btnRow">
      <button id="beginBtn" class="btn begin">„Çπ„Çø„Éº„Éà<br><small>Start</small></button>
      <button id="retryBtn" class="btn retry" style="display:none">„ÇÇ„ÅÜ‰∏ÄÂõû<br><small>Retry</small></button>
      <button id="nextBtn" class="btn next" style="display:none">„Å§„Åé„Å∏<br><small>Next</small></button>
    </div>
    <div id="scoreBox" class="scoreBox" style="display:none"></div>
  </div>
</div>

<footer>Bryan‚Äôs English School</footer>

<script>
const DUR_MS=6000;
let idx=0,listening=false,SR=null,streamAllowed=false;
const enEl=document.getElementById('en'),jpEl=document.getElementById('jp'),hiraEl=document.getElementById('hira');
const beginBtn=document.getElementById('beginBtn'),retryBtn=document.getElementById('retryBtn'),nextBtn=document.getElementById('nextBtn');
const scoreBox=document.getElementById('scoreBox'),meterText=document.getElementById('meterText');
const playBtn=document.getElementById('playBtn'),sweep=document.getElementById('sweep'),meterCore=document.getElementById('meterCore');

/* preload Sage + score audio */
const sage=["whatisyourgoalthisyear","whyisitimportanttoyou","howwillyoureachyourgoal","whohelpsyoustaymotivated","whathabitdoyouwanttochange","doyoulikemakingresolutions","whatdoyouwanttotrythisyear","whatssomethingnewyoulearnedrecently","isiteasytokeepgoals","whathappenswhenyoudonttry","whatmakesyoufeelproud","whatsyourdreamforthefuture","howdoyoustaypositive","whoinspiresyou","howcanenglishhelpyourgoals"];
sage.forEach(f=>{const a=new Audio('./audio/'+f+'.mp3');a.preload='auto';a.load();});
["assets/audio/0-43.mp3","assets/audio/44-74.mp3","assets/audio/75-99.mp3","assets/audio/100.mp3"].forEach(u=>{const a=new Audio(u);a.preload='auto';a.load();});

const ITEMS=[
{en:"What is your goal this year?",jp:"‰ªäÂπ¥„ÅÆÁõÆÊ®ô„ÅØ‰Ωï„Åß„Åô„Åã„ÄÇ",hira:"(„Åì„Å®„Åó „ÅÆ „ÇÇ„Åè„Å≤„Çá„ÅÜ „ÅØ „Å™„Çì „Åß„Åô „Åã)"},
{en:"Why is it important to you?",jp:"„ÅÇ„Å™„Åü„Å´„Å®„Å£„Å¶„Å™„ÅúÂ§ßÂàá„Åß„Åô„Åã„ÄÇ",hira:"(„ÅÇ„Å™„Åü „Å´ „Å®„Å£„Å¶ „Å™„Åú „Åü„ÅÑ„Åõ„Å§ „Åß„Åô „Åã)"},
{en:"How will you reach your goal?",jp:"„Å©„ÅÜ„ÇÑ„Å£„Å¶ÁõÆÊ®ô„ÇíÈÅîÊàê„Åó„Åæ„Åô„Åã„ÄÇ",hira:"(„Å©„ÅÜ„ÇÑ„Å£„Å¶ „ÇÇ„Åè„Å≤„Çá„ÅÜ „Çí „Åü„Å£„Åõ„ÅÑ „Åó„Åæ„Åô „Åã)"},
{en:"Who helps you stay motivated?",jp:"„ÇÑ„ÇãÊ∞ó„Çí‰øù„Å§„ÅÆ„ÇíË™∞„ÅåÂä©„Åë„Å¶„Åè„Çå„Åæ„Åô„Åã„ÄÇ",hira:"(„ÇÑ„Çã„Åç „Çí „Åü„ÇÇ„Å§ „ÅÆ „Çí „Å†„Çå „Åå „Åü„Åô„Åë„Å¶ „Åè„Çå „Åæ„Åô „Åã)"},
{en:"What habit do you want to change?",jp:"Â§â„Åà„Åü„ÅÑÁøíÊÖ£„ÅØ‰Ωï„Åß„Åô„Åã„ÄÇ",hira:"(„Åã„Åà„Åü„ÅÑ „Åó„ÇÖ„ÅÜ„Åã„Çì „ÅØ „Å™„Çì „Åß„Åô „Åã)"},
{en:"Do you like making resolutions?",jp:"Êñ∞Âπ¥„ÅÆÁõÆÊ®ô„ÇíÁ´ã„Å¶„Çã„ÅÆ„ÅØÂ•Ω„Åç„Åß„Åô„Åã„ÄÇ",hira:"(„Åó„Çì„Å≠„Çì „ÅÆ „ÇÇ„Åè„Å≤„Çá„ÅÜ „Çí „Åü„Å¶„Çã „ÅÆ „ÅØ „Åô„Åç „Åß„Åô „Åã)"},
{en:"What do you want to try this year?",jp:"‰ªäÂπ¥ÊåëÊà¶„Åó„Åü„ÅÑ„Åì„Å®„ÅØ‰Ωï„Åß„Åô„Åã„ÄÇ",hira:"(„Åì„Å®„Åó „Å°„Çá„ÅÜ„Åõ„Çì „Åó„Åü„ÅÑ „Åì„Å® „ÅØ „Å™„Çì „Åß„Åô „Åã)"},
{en:"What‚Äôs something new you learned recently?",jp:"ÊúÄËøëÊñ∞„Åó„ÅèÂ≠¶„Çì„Å†„Åì„Å®„ÅØ‰Ωï„Åß„Åô„Åã„ÄÇ",hira:"(„Åï„ÅÑ„Åç„Çì „ÅÇ„Åü„Çâ„Åó„Åè „Åæ„Å™„Çì„Å† „Åì„Å® „ÅØ „Å™„Çì „Åß„Åô „Åã)"},
{en:"Is it easy to keep goals?",jp:"ÁõÆÊ®ô„ÇíÁ∂ö„Åë„Çã„ÅÆ„ÅØÁ∞°Âçò„Åß„Åô„Åã„ÄÇ",hira:"(„ÇÇ„Åè„Å≤„Çá„ÅÜ „Çí „Å§„Å•„Åë„Çã „ÅÆ „ÅØ „Åã„Çì„Åü„Çì „Åß„Åô „Åã)"},
{en:"What happens when you don‚Äôt try?",jp:"ÊåëÊà¶„Åó„Å™„ÅÑ„Å®„Å©„ÅÜ„Å™„Çä„Åæ„Åô„Åã„ÄÇ",hira:"(„Å°„Çá„ÅÜ„Åõ„Çì „Åó„Å™„ÅÑ „Å® „Å©„ÅÜ „Å™„Çä „Åæ„Åô „Åã)"},
{en:"What makes you feel proud?",jp:"‰Ωï„Åå„ÅÇ„Å™„Åü„ÇíË™á„Çâ„Åó„Åè„Åï„Åõ„Åæ„Åô„Åã„ÄÇ",hira:"(„Å™„Å´ „Åå „ÅÇ„Å™„Åü „Çí „Åª„Åì„Çâ„Åó„Åè „Åï„Åõ „Åæ„Åô „Åã)"},
{en:"What‚Äôs your dream for the future?",jp:"Â∞ÜÊù•„ÅÆÂ§¢„ÅØ‰Ωï„Åß„Åô„Åã„ÄÇ",hira:"(„Åó„Çá„ÅÜ„Çâ„ÅÑ „ÅÆ „ÇÜ„ÇÅ „ÅØ „Å™„Çì „Åß„Åô „Åã)"},
{en:"How do you stay positive?",jp:"„Å©„ÅÜ„ÇÑ„Å£„Å¶ÂâçÂêë„Åç„Åß„ÅÑ„Çâ„Çå„Åæ„Åô„Åã„ÄÇ",hira:"(„Å©„ÅÜ„ÇÑ„Å£„Å¶ „Åæ„Åà„ÇÄ„Åç „Åß „ÅÑ„Çâ„Çå „Åæ„Åô „Åã)"},
{en:"Who inspires you?",jp:"„ÅÇ„Å™„Åü„Å´ÂΩ±Èüø„Çí‰∏é„Åà„Çã‰∫∫„ÅØË™∞„Åß„Åô„Åã„ÄÇ",hira:"(„ÅÇ„Å™„Åü „Å´ „Åà„ÅÑ„Åç„Çá„ÅÜ „Çí „ÅÇ„Åü„Åà„Çã „Å≤„Å® „ÅØ „Å†„Çå „Åß„Åô „Åã)"},
{en:"How can English help your goals?",jp:"Ëã±Ë™û„ÅØ„ÅÇ„Å™„Åü„ÅÆÁõÆÊ®ô„Å´„Å©„ÅÜÂΩπÁ´ã„Å°„Åæ„Åô„Åã„ÄÇ",hira:"(„Åà„ÅÑ„Åî „ÅØ „ÅÇ„Å™„Åü „ÅÆ „ÇÇ„Åè„Å≤„Çá„ÅÜ „Å´ „Å©„ÅÜ „ÇÑ„Åè„Å†„Å° „Åæ„Åô „Åã)"}
].sort(()=>Math.random()-0.5);

function normalize(s){return s.toLowerCase().replace(/[‚Äô‚Äò¬¥`]/g,"'").replace(/[^a-z0-9'\s]/g,' ').replace(/\s+/g,' ').trim();}
function toSet(s){return new Set(normalize(s).split(' ').filter(Boolean));}
function mountWords(t){enEl.innerHTML=t.split(/\s+/).map(w=>`<span class="word">${w}</span>`).join(' ');}
function clearHearts(){enEl.querySelectorAll('.heart').forEach(h=>h.remove());}
function popHeartAt(el){const h=document.createElement('span');h.className='heart';h.textContent='‚ù§';
const r=el.getBoundingClientRect(),pr=enEl.getBoundingClientRect();h.style.left=(r.left-pr.left+r.width/2)+'px';h.style.top=(r.top-pr.top)+'px';
enEl.appendChild(h);setTimeout(()=>h.remove(),900);}
function markSpoken(sp){const set=toSet(sp);enEl.querySelectorAll('.word').forEach(w=>{const v=normalize(w.textContent);if(set.has(v)&&!w.classList.contains('blue')){w.classList.add('blue');popHeartAt(w);}});}
function finalizeColors(){enEl.querySelectorAll('.word').forEach(w=>{if(!w.classList.contains('blue'))w.classList.add('red');});}
function keywordScore(t,sp){const k=toSet(t),said=toSet(sp);let hit=0,total=0;k.forEach(x=>{if(x.length>2){total++;if(said.has(x))hit++;}});return total?Math.round((hit/total)*100):0;}

function setReady(){meterText.classList.remove('shimmer');meterCore.classList.remove('bigPulse');meterText.innerHTML='Ready<br><small>„Çπ„Çø„É≥„Éê„Ç§</small>';}
function setListening(){meterText.classList.add('shimmer');meterCore.classList.add('bigPulse');meterText.innerHTML='Listening<br><small>„É™„Çπ„Éã„É≥„Ç∞‰∏≠</small>';}
function setFinished(){meterText.classList.remove('shimmer');meterCore.classList.remove('bigPulse');meterText.innerHTML='Finished<br><small>„Åä„Çè„ÇäÔºÅ</small>';}

/* Audio */
function stripForFile(s){return s.toLowerCase().replace(/[^a-z0-9]/g,'');}
function playSage(en){if(listening)return;const a=new Audio('./audio/'+stripForFile(en)+'.mp3');a.preload='auto';a.volume=1;a.playbackRate=0.95;a.play().catch(()=>{});}

/* Mic */
async function requestMic(){try{const s=await navigator.mediaDevices.getUserMedia({audio:true});s.getTracks().forEach(t=>t.stop());streamAllowed=true;}catch(e){alert("„Éû„Ç§„ÇØ„Åå‰Ωø„Åà„Åæ„Åõ„Çì„ÄÇChrome „Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");}}
function makeRecognizer(){const R=window.SpeechRecognition||window.webkitSpeechRecognition;if(!R)return null;const r=new R();r.lang='en-US';r.continuous=true;r.interimResults=true;try{r.maxAlternatives=5;}catch(_){ }return r;}

/* Round */
async function beginRound(){
  const R=window.SpeechRecognition||window.webkitSpeechRecognition;
  if(!R){alert("„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„Åß„ÅØÈü≥Â£∞Ë™çË≠ò„Åå‰Ωø„Åà„Åæ„Åõ„Çì„ÄÇChrome „Çí‰ΩøÁî®„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");return;}
  if(!streamAllowed){await requestMic();if(!streamAllowed)return;}

  resetVisuals();listening=true;playBtn.disabled=true;retryBtn.style.display='none';nextBtn.style.display='none';setListening();

  SR=makeRecognizer();let heard="";
  SR.onresult=(e)=>{let txt="";for(let i=e.resultIndex;i<e.results.length;i++){txt+=e.results[i][0].transcript+" ";}heard=(heard+" "+txt).trim();markSpoken(heard);};
  SR.onstart=()=>{sweep.classList.remove('run');void sweep.offsetWidth;sweep.classList.add('run');console.log("üé§ mic active");};
  SR.onend=()=>console.log("üé§ mic stopped");
  try{SR.start();}catch(_){}

  await new Promise(r=>setTimeout(r,DUR_MS));
  listening=false;try{SR.stop();}catch(_){}
  setFinished();finalizeColors();

  const s=keywordScore(ITEMS[idx].en,heard);scoreBox.textContent="„Çπ„Ç≥„Ç¢Ôºö"+s+"ÔºÖ";scoreBox.style.display='block';playScoreSound(s);
  nextBtn.style.display=(s>=75)?'inline-block':'none';retryBtn.style.display=(s<75)?'inline-block':'none';playBtn.disabled=false;
}

/* Score SFX */
const scoreFiles={low:"assets/audio/0-43.mp3",mid:"assets/audio/44-74.mp3",high:"assets/audio/75-99.mp3",max:"assets/audio/100.mp3"};
let sfx=new Audio();sfx.preload='auto';
function playScoreSound(score){let src=scoreFiles.low;if(score===100)src=scoreFiles.max;else if(score>=75)src=scoreFiles.high;else if(score>=44)src=scoreFiles.mid;
sfx.pause();sfx.src=src;sfx.currentTime=0;sfx.play().catch(()=>{});}

/* Display next */
function resetVisuals(){sweep.classList.remove('run');void sweep.offsetWidth;clearHearts();enEl.querySelectorAll('.word').forEach(w=>w.classList.remove('blue','red'));scoreBox.style.display='none';}
function showItem(){const it=ITEMS[idx];mountWords(it.en);jpEl.textContent=it.jp;hiraEl.textContent=it.hira;resetVisuals();setReady();}

/* Buttons */
beginBtn.onclick=async()=>{if(!streamAllowed)await requestMic();if(!streamAllowed)return;showItem();beginRound();};
retryBtn.onclick=()=>{showItem();beginRound();};
nextBtn.onclick=()=>{idx++;if(idx>=ITEMS.length){enEl.textContent="Great work today!";jpEl.textContent="„Çà„Åè„Åß„Åç„Åæ„Åó„ÅüÔºÅ";hiraEl.textContent="";nextBtn.style.display='none';retryBtn.style.display='none';beginBtn.style.display='none';setReady();sweep.classList.remove('run');return;}showItem();};
playBtn.onclick=()=>playSage(ITEMS[idx].en);

/* Init */
showItem();
</script>
</body>
</html>
