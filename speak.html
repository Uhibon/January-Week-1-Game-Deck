<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1,viewport-fit=cover" />
<title>Booha Speak & Repeat – January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26; --radius:26px;
  --pink:#ff7eb9; --mint:#a6f7b2; --blue:#7dd3fc; --yell:#fff680; --vio:#c77dff; --green:#22c55e;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,"Noto Sans JP",sans-serif;-webkit-overflow-scrolling:touch}
header{text-align:center;padding:26px 12px 12px}
.h1{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(34px,6.2vw,56px);letter-spacing:.5px;text-transform:uppercase}
.h2{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(22px,4.5vw,36px);margin-top:6px}
.h3{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(16px,3.6vw,22px);margin-top:10px;opacity:.9}
.h4{font-weight:800;font-size:clamp(14px,3.4vw,20px);color:#cfe1ff;margin-top:2px}
footer{text-align:center;color:#c9d4ec;font-family:'Cinzel',serif;font-weight:700;padding:40px 10px}
.wrap{max-width:1100px;margin:0 auto;padding:8px 16px 86px}
.panel{padding:20px;border:1px solid var(--outline);border-radius:var(--radius);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));box-shadow:0 6px 24px rgba(0,0,0,.4)}
.card{position:relative;border:1px solid var(--outline);border-radius:var(--radius);padding:22px 16px 22px 80px;margin-bottom:10px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02));overflow:hidden}
.en{position:relative;font-weight:900;font-size:clamp(26px,7.4vw,48px);line-height:1.22;text-align:center;letter-spacing:.2px;z-index:2}
.en .word{display:inline-block;padding:0 .06em;color:#ffffff;transition:color .25s ease}
.en .word.black{color:#000}
.en .word.blue{color:#60a5fa}
.sweep{position:absolute;top:0;left:-100%;width:100%;height:100%;background:var(--yell);opacity:.85;z-index:1;filter:blur(2px)}
.playBtn{
  position:absolute;left:16px;top:50%;transform:translateY(-50%);
  width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;
  display:grid;place-items:center;font-weight:900;font-size:20px;color:#351b00;
  background:radial-gradient(circle at 30% 30%, #ffe8a3, #ffd36a 60%, #ffb800 100%);
  box-shadow:0 0 0 3px rgba(255,213,120,.35),0 0 16px rgba(255,214,120,.45),
             inset 0 3px 6px rgba(255,255,255,.6),inset 0 -6px 14px rgba(201,112,0,.55);
  text-shadow:0 1px 0 rgba(255,255,255,.7);
  animation:goldPulse 1.8s var(--delay) ease-in-out infinite;
}
.playBtn:active{transform:translateY(-50%) scale(.96)}
@keyframes goldPulse{
  0%,100%{box-shadow:0 0 0 3px rgba(255,213,120,.25),0 0 10px rgba(255,214,120,.35),
    inset 0 2px 5px rgba(255,255,255,.55),inset 0 -6px 14px rgba(201,112,0,.55);}
  50%{box-shadow:0 0 0 4px rgba(255,213,120,.45),0 0 22px rgba(255,214,120,.85),
    inset 0 4px 8px rgba(255,255,255,.85),inset 0 -8px 18px rgba(201,112,0,.75);}
}
.supportBar{margin:8px 0 14px;border:1px solid var(--outline);border-radius:14px;padding:12px 14px;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03))}
.jp{font-weight:700;font-size:clamp(16px,3.8vw,22px);text-align:center;color:#d8e7ff}
.hira{font-size:clamp(14px,3.4vw,18px);text-align:center;color:#bcd3ff;margin-top:6px}
.meterWrap{display:flex;align-items:center;justify-content:center;margin:22px 0}
.meter{position:relative;width:min(64vw,290px);height:min(64vw,290px);display:grid;place-items:center}
.ring{position:absolute;inset:0;border-radius:50%;background:conic-gradient(#22c55e,#facc15,#f43f5e,#a78bfa,#60a5fa,#22c55e);
  -webkit-mask:radial-gradient(circle,transparent 60%,black 62%);
  mask:radial-gradient(circle,transparent 60%,black 62%);
  filter:drop-shadow(0 0 16px rgba(255,255,255,.25));
  animation:rainbowCycle 3s linear infinite;
}
@keyframes rainbowCycle{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}
.meterCore{position:absolute;inset:12%;border-radius:50%;
  background:radial-gradient(circle at 50% 40%,rgba(255,255,255,.14),rgba(255,255,255,.04));
  display:grid;place-items:center;text-align:center;
  animation:corePulse 3s ease-in-out infinite;
}
@keyframes corePulse{
  0%,100%{transform:scale(1);box-shadow:0 0 12px rgba(255,255,255,.2);}
  50%{transform:scale(1.1);box-shadow:0 0 24px rgba(255,255,255,.4);}
}
.meterText{position:relative;font-weight:900;font-size:clamp(18px,6vw,28px);
  text-shadow:0 2px 0 rgba(0,0,0,.35);z-index:2}
.btnRow{display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:10px}
.btn{display:inline-grid;place-items:center;gap:4px;min-width:160px;border:none;border-radius:999px;
  padding:14px 20px;font-weight:900;font-size:clamp(18px,4vw,22px);
  color:#001e08;text-shadow:0 1px 0 rgba(255,255,255,.6);cursor:pointer;transition:transform .05s ease}
.btn:active{transform:scale(.97)}
.btn.begin{background:radial-gradient(circle at 30% 30%,#1ee99a,#15c473,#0ea85d);
  box-shadow:0 0 0 6px rgba(34,197,94,.22),0 0 22px rgba(34,197,94,.8)}
.btn.retry{background:radial-gradient(circle at 30% 30%,#8ec5ff,#4da0ff,#1e6eff);
  box-shadow:0 0 0 6px rgba(77,160,255,.22),0 0 22px rgba(77,160,255,.8);color:#00163a}
.btn.next{background:radial-gradient(circle at 30% 30%,#ff9ad7,#ff6ec7,#ff4fa6);
  box-shadow:0 0 0 6px rgba(255,110,199,.22),0 0 22px rgba(255,110,199,.85);color:#38001a}
.btn:disabled{opacity:.45;cursor:not-allowed}
#progress{text-align:center;color:#cfe1ff;opacity:.9;font-weight:700;margin-top:8px}
.scoreBox{margin:14px auto 6px;max-width:620px;text-align:center;padding:14px 16px;border-radius:18px;
  border:1px solid var(--outline);background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
  font-weight:900;font-size:clamp(18px,4.2vw,24px)}
.scoreBox.good{box-shadow:0 0 28px rgba(34,197,94,.5) inset,0 0 18px rgba(34,197,94,.35)}
.scoreBox.mid{box-shadow:0 0 28px rgba(96,165,250,.5) inset,0 0 18px rgba(96,165,250,.35)}
.scoreBox.bad{box-shadow:0 0 28px rgba(229,57,53,.5) inset,0 0 18px rgba(229,57,53,.35)}
.heart{position:absolute;left:0;top:0;transform:translate(-50%,0);
  font-size:20px;color:#ff7eb9;opacity:0;pointer-events:none;animation:heartUp 900ms ease-out forwards}
@keyframes heartUp{0%{transform:translate(-50%,0) scale(1);opacity:1}
100%{transform:translate(-50%,-60px) scale(1.4);opacity:0}}
.fx{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:1000}
.puff{position:absolute;border-radius:50%;filter:blur(.5px);animation:puffUp 1500ms ease-out forwards}
@keyframes puffUp{0%{opacity:0;transform:translate(-50%,-10px) scale(.6)}
20%{opacity:.95}100%{opacity:0;transform:translate(-50%,-260px) scale(1.45)}}
.confetti{position:absolute;width:12px;height:12px;top:-20px;animation:confettiFall 3.5s linear forwards}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0)}
100%{transform:translateY(110vh) rotate(720deg);opacity:0}}
</style>
</head>
<body>
<header>
  <div class="h1">THE BOO-RICULUM</div>
  <div class="h2">SPEAK &amp; REPEAT</div>
  <div class="h3">January Week 1 – Speaking Practice</div>
  <div class="h4">１月第１週 – スピーキング練習</div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="card">
      <button id="playBtn" class="playBtn" aria-label="Play">▶</button>
      <div class="sweep" id="sweep"></div>
      <div id="en" class="en">Press スタート to start</div>
    </div>
    <div class="supportBar"><div id="jp" class="jp"></div><div id="hira" class="hira"></div></div>
    <div class="meterWrap">
      <div class="meter">
        <div id="ring" class="ring"></div>
        <div class="meterCore"><div id="meterText" class="meterText">リスニング中</div></div>
      </div>
    </div>
    <div class="btnRow">
      <button id="beginBtn" class="btn begin">スタート<br><small>Start</small></button>
      <button id="retryBtn" class="btn retry" style="display:none">もう一回<br><small>Retry</small></button>
      <button id="nextBtn" class="btn next" style="display:none">つぎへ<br><small>Next</small></button>
    </div>
    <div id="progress">０／１５</div>
    <div id="scoreBox" class="scoreBox" style="display:none">スコア：—％</div>
    <div id="support" class="support" style="display:none;text-align:center;color:#ffcf7f;margin-top:10px">
      音声認識がこのブラウザでは使えません。Chrome または Edge を使用してください。
    </div>
  </div>
</div>

<div id="fx" class="fx"></div>
<footer>Bryan’s English School</footer>

<script>
const ITEMS=[ /* same 15 Q&A items */ 
{en:"What is your goal this year?",jp:"今年の目標は何ですか。",hira:"(ことし の もくひょう は なん です か)"}, 
{en:"Why is it important to you?",jp:"あなたにとってなぜ大切ですか。",hira:"(あなた に とって なぜ たいせつ です か)"}, 
{en:"How will you reach your goal?",jp:"どうやって目標を達成しますか。",hira:"(どうやって もくひょう を たっせい します か)"}, 
{en:"Who helps you stay motivated?",jp:"やる気を保つのを誰が助けてくれますか。",hira:"(やるき を たもつ の を だれ が たすけて くれ ます か)"}, 
{en:"What habit do you want to change?",jp:"変えたい習慣は何ですか。",hira:"(かえたい しゅうかん は なん です か)"}, 
{en:"Do you like making resolutions?",jp:"新年の目標を立てるのは好きですか。",hira:"(しんねん の もくひょう を たてる の は すき です か)"}, 
{en:"What do you want to try this year?",jp:"今年挑戦したいことは何ですか。",hira:"(ことし ちょうせん したい こと は なん です か)"}, 
{en:"What’s something new you learned recently?",jp:"最近新しく学んだことは何ですか。",hira:"(さいきん あたらしく まなんだ こと は なん です か)"}, 
{en:"Is it easy to keep goals?",jp:"目標を続けるのは簡単ですか。",hira:"(もくひょう を つづける の は かんたん です か)"}, 
{en:"What happens when you don’t try?",jp:"挑戦しないとどうなりますか。",hira:"(ちょうせん しない と どう なり ます か)"}, 
{en:"What makes you feel proud?",jp:"何があなたを誇らしくさせますか。",hira:"(なに が あなた を ほこらしく させ ます か)"}, 
{en:"What’s your dream for the future?",jp:"将来の夢は何ですか。",hira:"(しょうらい の ゆめ は なん です か)"}, 
{en:"How do you stay positive?",jp:"どうやって前向きでいられますか。",hira:"(どうやって まえむき で いられ ます か)"}, 
{en:"Who inspires you?",jp:"あなたに影響を与える人は誰ですか。",hira:"(あなた に えいきょう を あたえる ひと は だれ です か)"}, 
{en:"How can English help your goals?",jp:"英語はあなたの目標にどう役立ちますか。",hira:"(えいご は あなた の もくひょう に どう やくだち ます か)"}];
const A_0_43=new Audio("assets/audio/0-43.mp3"),A_44_74=new Audio("assets/audio/44-74.mp3"),
A_75_99=new Audio("assets/audio/75-99.mp3"),A_100=new Audio("assets/audio/100.mp3");
[A_0_43,A_44_74,A_75_99,A_100].forEach(a=>{a.preload="auto";a.volume=1});
const enEl=document.getElementById('en'),jpEl=document.getElementById('jp'),hiraEl=document.getElementById('hira'),
beginBtn=document.getElementById('beginBtn'),retryBtn=document.getElementById('retryBtn'),
nextBtn=document.getElementById('nextBtn'),progress=document.getElementById('progress'),
scoreBox=document.getElementById('scoreBox'),support=document.getElementById('support'),
fx=document.getElementById('fx'),ring=document.getElementById('ring'),meterText=document.getElementById('meterText'),
sweep=document.getElementById('sweep'),playBtn=document.getElementById('playBtn');
const LISTEN_SECS=3.0;const sleep=ms=>new Promise(r=>setTimeout(r,ms));
const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
const strip=s=>s.toLowerCase().replace(/[^a-z0-9' ]+/g,' ').replace(/\s+/g,' ').trim();
const stripForFile=s=>s.toLowerCase().replace(/[^a-z0-9]/g,'');
function playAudioSafe(a){try{a.pause();a.currentTime=0;a.play().catch(()=>{});}catch(e){}}
const toFW=n=>n.toString().replace(/\d/g,d=>"０１２３４５６７８９"[d]);
let wordSpans=[];function mountWords(t){const p=t.split(/\s+/).filter(Boolean);
enEl.innerHTML=p.map(w=>`<span class="word">${w}</span>`).join(' ');
wordSpans=[...enEl.querySelectorAll('.word')];}
function startSweep(d=LISTEN_SECS*1000){wordSpans.forEach(w=>w.classList.remove('black','blue'));
const rect=enEl.getBoundingClientRect(),total=rect.width||1,start=performance.now();
sweep.style.left='-100%';sweep.style.opacity=.85;function step(t){const e=t-start,prog=Math.min(e/d,1),x=total*prog;
sweep.style.left=(x-total)+'px';for(const w of wordSpans){const r=w.getBoundingClientRect();
const cx=r.left+r.width/2-rect.left;w.classList.toggle('black',cx<=x);}
if(e<d)requestAnimationFrame(step);else sweep.style.opacity=0;}requestAnimationFrame(step);}
function tokensOf(t){return strip(t).split(' ').filter(Boolean);}
function popHeartAt(el){const h=document.createElement('span');h.className='heart';h.textContent='❤';
const r=el.getBoundingClientRect(),pr=enEl.getBoundingClientRect();
h.style.left=(r.left-pr.left+r.width/2)+'px';h.style.top=(r.top-pr.top)+'px';
enEl.appendChild(h);setTimeout(()=>h.remove(),950);}
function markSpoken(txt){if(!txt)return;const set=new Set(tokensOf(txt));
for(const s of wordSpans){const w=strip(s.textContent);
if(set.has(w)&&!s.classList.contains('blue')){s.classList.add('blue');popHeartAt(s);}}}
function keywordScore(target,txt){const keys=strip(target).split(' ').filter(w=>w.length>2);
const said=' '+strip(txt)+' ';let hit=0;for(const k of keys){if(said.includes(' '+k+' '))hit++;}
return Math.round((hit/keys.length)*100);}
let idx=0;let SR=(window.SpeechRecognition||window.webkitSpeechRecognition)?new(window.SpeechRecognition||window.webkitSpeechRecognition)():null;
if(!SR)support.style.display='block';
let transcriptHeard="";
function updateProgress(){const n=Math.min(idx+1,ITEMS.length);
progress.textContent=`${toFW(n)}／${toFW(ITEMS.length)}`;}
function showItem(){const it=ITEMS[idx];mountWords(it.en);
jpEl.textContent=it.jp;hiraEl.textContent=it.hira;scoreBox.style.display='none';
scoreBox.className='scoreBox';meterText.textContent='リスニング中';
playBtn.style.setProperty('--delay',(Math.random()*2).toFixed(2)+'s');updateProgress();}
function renderScore(s){s=clamp(s,0,100);meterText.textContent=`${s}%`;
let msg=`スコア：${s}％`;if(s<=43)msg+="　｜　ブーーッ！もう一回！";
else if(s<=74)msg+="　｜　もう少し！";else if(s<100)msg+="　｜　よくできました！";
else msg+="　｜　パーフェクト！！";scoreBox.textContent=msg;scoreBox.style.display='block';
scoreBox.className='scoreBox '+(s>=95?'good':(s<50?'bad':'mid'));
if(s===100)playAudioSafe(A_100);else if(s>=75)playAudioSafe(A_75_99);
else if(s>=44)playAudioSafe(A_44_74);else playAudioSafe(A_0_43);
nextBtn.style.display=(s>=75)?'inline-block':'none';
beginBtn.disabled=false;retryBtn.style.display=(s<75)?'inline-block':'none';}
async function beginRound(){beginBtn.disabled=true;retryBtn.style.display='none';nextBtn.style.display='none';
scoreBox.style.display='none';transcriptHeard="";startSweep();playSage(ITEMS[idx].en);
if(!SR){await sleep(LISTEN_SECS*1000);renderScore(100);return;}
SR.lang='en-US';SR.continuous=true;SR.interimResults=true;
SR.onresult=e=>{let t="";for(let i=e.resultIndex;i<e.results.length;i++){t+=e.results[i][0].transcript+" ";}transcriptHeard=t.trim();markSpoken(transcriptHeard);};
try{SR.start();}catch(e){}await sleep(LISTEN_SECS*1000);try{SR.stop();}catch(e){}
const s=keywordScore(ITEMS[idx].en,transcriptHeard);renderScore(s);}
function nextItem(){idx++;if(idx>=ITEMS.length){enEl.innerHTML="Great work today!";
jpEl.textContent="よくがんばりました！";hiraEl.textContent="";
scoreBox.style.display='block';scoreBox.textContent="ぜんぶできました！おつかれさま！";
nextBtn.style.display='none';retryBtn.style.display='none';beginBtn.style.display='none';return;}
showItem();}
let currentSage=null;
function sentenceToFile(en){return'./audio/'+stripForFile(en)+'.mp3';}
function playSage(en){const f=sentenceToFile(en);
try{if(currentSage){currentSage.pause();currentSage=null;}
const a=new Audio(f);a.preload='auto';a.volume=1;a.play().catch(()=>{});currentSage=a;}catch(e){}}
beginBtn.addEventListener('click',async()=>{if(idx===0&&jpEl.textContent==="")showItem();await beginRound();});
retryBtn.addEventListener('click',async()=>{await beginRound();});
nextBtn.addEventListener('click',()=>nextItem());
playBtn.addEventListener('click',()=>playSage(ITEMS[idx].en));
showItem();
</script>
</body>
</html>
