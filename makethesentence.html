<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Make the Sentences â€“ January Week 1</title>
<meta name="theme-color" content="#0b1530" />
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet" />
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26; --heart:#ff4fa6; --radius:26px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:#0b1530;color:var(--ink);font-family:system-ui,"Noto Sans JP",sans-serif;transition:background 1s;}
header{text-align:center;padding:26px 12px 12px}
.h1{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(34px,6.2vw,56px);}
.h2{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(22px,4.5vw,36px);}
.h3{font-family:'Cinzel',serif;font-weight:900;font-size:clamp(16px,3.6vw,22px);}
.h4{font-weight:800;font-size:clamp(14px,3.4vw,20px);color:#cfe1ff;}
.wrap{max-width:1100px;margin:0 auto;padding:8px 16px 80px}
.panel{padding:20px;border:1px solid var(--outline);border-radius:var(--radius);
background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));
box-shadow:0 6px 24px rgba(0,0,0,.4);}

/* JP card */
.jpCard{border-radius:var(--radius);border:1px solid var(--outline);height:160px;
display:flex;align-items:center;justify-content:center;margin-bottom:10px;
background:repeating-linear-gradient(to bottom,#ff6ec7 0 28px,#5ee6ff 28px 56px,#ffd166 56px 84px,
#8aff80 84px 112px,#c77dff 112px 140px,#fff680 140px 168px);
background-size:100% 600px;animation:stripeSlide 18s linear infinite;}
@keyframes stripeSlide{from{background-position-y:0}to{background-position-y:-600px}}
.jpText{font-weight:900;font-size:46px;color:#0b1530;text-shadow:0 1px 0 rgba(255,255,255,.6);}
.hira{text-align:center;color:#d8e7ff;font-size:clamp(14px,3.5vw,18px);margin-bottom:20px}

/* drop areas */
.wordbank,.sentence{display:flex;flex-wrap:wrap;gap:12px;padding:12px;margin-bottom:14px;}
.wordbank{justify-content:center;}
.sentence{justify-content:flex-start;align-items:center;min-height:120px;width:100%;
  border:1px dashed rgba(255,255,255,.25);border-radius:14px;padding:16px 12px;position:relative;}

/* play button */
.playBtn{position:absolute;left:12px;bottom:-60px;width:54px;height:54px;border:none;border-radius:50%;
background:linear-gradient(135deg,#c59b10 0%,#ffd95e 40%,#ffe898 60%,#b68006 100%);
box-shadow:0 0 10px rgba(255,215,64,.6),0 0 16px rgba(255,215,64,.9);
color:#2a1b00;font-weight:900;font-size:26px;opacity:0;pointer-events:none;transition:opacity .3s;}
.playBtn.show{opacity:1;pointer-events:auto;animation:twinkle 2.4s ease-in-out infinite;}
.playBtn::before{content:"â–¶";display:block;text-align:center;line-height:54px;}
@keyframes twinkle{0%,100%{box-shadow:0 0 10px rgba(255,215,64,.6),0 0 16px rgba(255,215,64,.9);}
50%{box-shadow:0 0 16px rgba(255,235,94,1),0 0 24px rgba(255,235,94,1);}}

/* chips */
.word{padding:14px 18px;font-weight:900;font-size:clamp(18px,4.2vw,26px);
border:none;border-radius:20px;cursor:grab;user-select:none;
box-shadow:0 0 0 4px var(--color),0 10px 22px rgba(0,0,0,.35);
background:#fff;color:#06101f;text-shadow:0 1px 0 rgba(255,255,255,.65);}
.word:active{transform:scale(.96)}

/* buttons */
.btn{display:block;margin:16px auto 8px;border:none;border-radius:999px;
padding:16px 36px;font-weight:900;font-size:clamp(18px,4vw,22px);cursor:pointer;}
.btn.green{background:radial-gradient(circle at 30% 30%,#1ee99a,#15c473,#0ea85d);color:#00230f;
box-shadow:0 0 0 5px rgba(34,197,94,.22),0 0 18px rgba(34,197,94,.8);}
.btn.blue{background:radial-gradient(circle at 30% 30%,#66b3ff,#1e6eff);color:#00163a;
box-shadow:0 0 0 5px rgba(102,179,255,.22),0 0 18px rgba(102,179,255,.8);}
.btn.pink{background:radial-gradient(circle at 30% 30%,#ff90e8,#ff53c2,#ff2fa6);color:#30001a;
box-shadow:0 0 0 5px rgba(255,83,194,.25),0 0 18px rgba(255,83,194,.7);}
.btn:disabled{opacity:.4;cursor:not-allowed}

/* FX */
.fx{position:fixed;inset:0;pointer-events:none;z-index:1000}
.heart{position:absolute;color:var(--heart);font-size:clamp(50px,8vw,90px);
animation:heartFly 1.8s ease-out forwards;}
@keyframes heartFly{
  0%{opacity:0;transform:translate(-50%,-10px) scale(.7)}
  15%{opacity:1}
  100%{opacity:0;transform:translate(var(--dx),calc(-300px - var(--up))) scale(1.3)}
}
.smoke{position:absolute;border-radius:50%;width:var(--w,80px);height:var(--h,80px);
background:radial-gradient(circle at 40% 40%,#fff,rgba(255,255,255,.6) 55%,rgba(255,255,255,0) 72%);
filter:blur(0.6px);animation:smokeRise 1.8s ease-out forwards;}
@keyframes smokeRise{
  0%{opacity:0;transform:translate(-50%,0) scale(.7)}
  20%{opacity:.9}
  100%{opacity:0;transform:translate(calc(-50% + var(--sx)),calc(-200px - var(--up))) scale(1.2)}
}

/* results glow colors */
.redGlow{background:#5c0000;}
.orangeGlow{background:#773b00;}
.blueGlow{background:#001b5f;}
.goldGlow{background:#5a4600;}
.confetti{position:fixed;width:10px;height:14px;top:-10px;animation:fall linear forwards;}
@keyframes fall{
  0%{transform:translateY(-10px) rotate(0deg);}
  100%{transform:translateY(110vh) rotate(720deg);}
}

.end{position:fixed;inset:0;display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;}
.end .msg{font-weight:900;font-size:clamp(26px,6vw,42px);}
.end .score{font-weight:900;font-size:clamp(22px,5vw,30px);margin:10px auto 20px;}
footer{text-align:center;color:#c9d4ec;font-family:'Cinzel',serif;font-weight:700;padding:40px 10px}

/* ğŸ”˜ Standard Booha QUIT button (small version) */
.top-nav-btn{
  position:fixed;
  top:10px;
  left:10px;
  z-index:12001;
  border-radius:999px;
  padding:6px 14px;
  border:1px solid #ffffff66;
  background:rgba(15,23,42,.95);
  color:#fff;
  font-size:.78rem;
  font-weight:700;
  letter-spacing:.04em;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:4px;
  box-shadow:0 0 12px rgba(0,0,0,.6);
  backdrop-filter:blur(4px);
}
.top-nav-btn .jp{font-size:.72em;}
.top-nav-btn .en{font-size:.8em;}

/* â“ Glowing help button */
.help-btn{
  position:fixed;
  top:10px;
  right:10px;
  z-index:12001;
  width:40px;
  height:40px;
  border-radius:999px;
  border:1px solid #ffffff88;
  background:radial-gradient(circle at 30% 30%,#7dd3fc,#1e3a8a 65%,#020617 100%);
  color:#fff;
  font-weight:900;
  font-size:20px;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:
    0 0 12px rgba(125,211,252,.9),
    0 0 28px rgba(59,130,246,.9),
    0 0 52px rgba(56,189,248,.9);
  backdrop-filter:blur(4px);
}

/* ğŸªŸ Help modal */
.help-modal{
  position:fixed;
  inset:0;
  z-index:12000;
  display:none;
  align-items:center;
  justify-content:center;
}
.help-modal.show{display:flex;}
.help-backdrop{
  position:absolute;
  inset:0;
  background:rgba(15,23,42,.8);
  backdrop-filter:blur(6px);
}
.help-dialog{
  position:relative;
  z-index:1;
  max-width:720px;
  width:calc(100% - 32px);
  max-height:80vh;
  border-radius:20px;
  border:1px solid #ffffff33;
  background:radial-gradient(circle at top,#111827,#020617 55%);
  box-shadow:0 22px 70px rgba(0,0,0,.9);
  padding:18px 18px 20px;
  display:flex;
  flex-direction:column;
}
.help-dialog h2{
  font-family:'Cinzel',serif;
  font-size:1.2rem;
  text-align:center;
  margin-bottom:6px;
}
.help-sub{
  font-size:.85rem;
  text-align:center;
  color:#c7d2fe;
  margin-bottom:10px;
}
.help-body{
  margin-top:6px;
  padding-right:4px;
  font-size:.9rem;
  line-height:1.6;
  color:#e5e7f5;
  overflow-y:auto;
}
.help-body h3{
  font-size:.9rem;
  margin:10px 0 4px;
  color:#bfdbfe;
}
.help-body ul{
  padding-left:1.1rem;
  margin:4px 0 10px;
}
.help-body li{
  margin-bottom:4px;
}
.help-close{
  position:absolute;
  top:8px;
  right:10px;
  border:none;
  background:transparent;
  color:#e5e7f5;
  font-size:22px;
  cursor:pointer;
}
@media (max-width:480px){
  .help-dialog{
    max-height:82vh;
    padding:16px 14px 18px;
  }
}
</style>
</head>
<body>

<!-- ğŸ”˜ Quit + â“ Help -->
<button type="button" class="top-nav-btn" onclick="window.location.href='index.html'">
  <span class="jp">ã‚„ã‚ã‚‹</span>
  <span class="en">QUIT</span>
</button>
<button id="helpBtn" type="button" class="help-btn">?</button>

<header>
  <div class="h1">THE BOO-RICULUM</div>
  <div class="h2">MAKE THE SENTENCES</div>
  <div class="h3">January Week 1 â€“ Sentences</div>
  <div class="h4">ï¼‘æœˆç¬¬ï¼‘é€± â€“ æ–‡ã®ç·´ç¿’</div>
</header>

<div class="wrap" id="page-round">
<div class="panel" id="panel">
  <div class="jpCard"><div id="jp" class="jpText"></div></div>
  <div id="hira" class="hira"></div>
  <div id="bank" class="wordbank"></div>

  <div style="position:relative;">
    <div id="sentence" class="sentence">
      <button id="playBtn" class="playBtn" title="Play"></button>
    </div>
  </div>

  <div id="okWrap" style="text-align:center;display:none">
    <div>æ­£ã—ã„é †ç•ªã«ä¸¦ã¹ã¦ã‹ã‚‰ OK ã‚’ã‚¯ãƒªãƒƒã‚¯</div>
    <button id="okBtn" class="btn green" disabled>Next</button>
  </div>

  <div id="nextWrap" style="text-align:center;display:none">
    <button id="nextBtn" class="btn blue">Next</button>
  </div>

  <button id="checkBtn" class="btn green" disabled>Check</button>
  <div id="progress">1 / 15</div>
</div>
</div>

<!-- â“ Help popup -->
<div id="helpModal" class="help-modal" aria-hidden="true">
  <div class="help-backdrop" data-close-help></div>
  <div class="help-dialog">
    <button class="help-close" type="button" data-close-help>Ã—</button>
    <h2>How to Play ï¼ éŠã³æ–¹</h2>
    <div class="help-sub">Booha Make the Sentences Game</div>
    <div class="help-body">
      <h3>English</h3>
      <ul>
        <li>Look at the big <strong>Japanese sentence</strong> and the hiragana hint under it.</li>
        <li>Use the <strong>white word chips</strong> from the word bank to build the correct English sentence.</li>
        <li>Drag the words into the gray sentence area and put them in the order you think is correct.</li>
        <li>When you finish, tap <strong>Check</strong>.</li>
        <li>If the order is <strong>perfect</strong> on the first try, you get 1 point and hearts + sound.</li>
        <li>If itâ€™s not correct, youâ€™ll see smoke and enter <strong>retry mode</strong>. Listen with the gold â–¶ button and fix the order.</li>
        <li>In retry mode, you can still learn and move on, but only the <strong>first perfect try</strong> counts toward your final score.</li>
        <li>There are <strong>15 sentences</strong>. Your final result screen and sound depend on how many first-try perfects you get.</li>
      </ul>

      <h3>æ—¥æœ¬èª</h3>
      <ul>
        <li>ä¸Šã®å¤§ããª<strong>æ—¥æœ¬èªã®æ–‡</strong>ã¨ã€ãã®ä¸‹ã®ã²ã‚‰ãŒãªãƒ’ãƒ³ãƒˆã‚’ã‚ˆãè¦‹ã¾ã™ã€‚</li>
        <li>ä¸‹ã®<strong>ç™½ã„å˜èªã‚«ãƒ¼ãƒ‰</strong>ï¼ˆword chipsï¼‰ã‚’ä½¿ã£ã¦ã€æ­£ã—ã„è‹±èªã®æ–‡ã‚’ä½œã‚Šã¾ã™ã€‚</li>
        <li>å˜èªã‚«ãƒ¼ãƒ‰ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ã€ã‚°ãƒ¬ãƒ¼ã®æ–‡ã‚¨ãƒªã‚¢ã«å…¥ã‚Œã€æ­£ã—ã„é †ç•ªã«ä¸¦ã¹ã¾ã™ã€‚</li>
        <li>ã§ããŸã¨æ€ã£ãŸã‚‰ã€<strong>Check</strong>ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚</li>
        <li><strong>ä¸€å›ç›®ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸</strong>ã§å®Œãºããªé †ç•ªã«ã§ãã‚‹ã¨ã€ãƒãƒ¼ãƒˆã¨éŸ³ãŒå‡ºã¦ã€ãƒã‚¤ãƒ³ãƒˆãŒ1å…¥ã‚Šã¾ã™ã€‚</li>
        <li>ã¾ã¡ãŒãˆãŸå ´åˆã¯ã€ã‚‚ãã‚‚ãã®ç…™ãŒå‡ºã¦<strong>ã‚„ã‚Šç›´ã—ãƒ¢ãƒ¼ãƒ‰</strong>ã«ãªã‚Šã¾ã™ã€‚é‡‘è‰²ã®â–¶ãƒœã‚¿ãƒ³ã§æ­£ã—ã„è‹±èªã‚’èã„ã¦ã‹ã‚‰ã€é †ç•ªã‚’ç›´ã—ã¾ã—ã‚‡ã†ã€‚</li>
        <li>ã‚„ã‚Šç›´ã—ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚å­¦ã¹ã¾ã™ãŒã€æœ€çµ‚ã‚¹ã‚³ã‚¢ã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã‚‹ã®ã¯<strong>æœ€åˆã®ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆ</strong>ã ã‘ã§ã™ã€‚</li>
        <li>æ–‡ã¯å…¨éƒ¨ã§<strong>15å€‹</strong>ã‚ã‚Šã¾ã™ã€‚æœ€çµ‚ç”»é¢ã®è‰²ã¨éŸ³ã¯ã€ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆã®å›æ•°ã§æ±ºã¾ã‚Šã¾ã™ã€‚</li>
      </ul>
    </div>
  </div>
</div>

<div id="page-results" class="end">
  <div class="msg" id="resultMsg"></div>
  <div class="score" id="resultScore"></div>
  <button class="btn blue" onclick="window.location.href='index.html'">Back to Main Menu</button>
  <footer style="opacity:.8">Bryanâ€™s English School</footer>
</div>

<div id="fx" class="fx"></div>
<footer>Bryanâ€™s English School</footer>

<!-- RESULTS AUDIO -->
<audio id="s_r05" src="assets/audio/result_0-5.mp3"></audio>
<audio id="s_r610" src="assets/audio/result_6-10.mp3"></audio>
<audio id="s_r1114" src="assets/audio/result_11-14.mp3"></audio>
<audio id="s_r15" src="assets/audio/result_15.mp3"></audio>

<script>
const DATA=[
{en:"I will study every day.",jp:"æ¯æ—¥å‹‰å¼·ã—ã¾ã™ã€‚",hira:"ã¾ã„ã«ã¡ ã¹ã‚“ãã‚‡ã† ã—ã¾ã™"},
{en:"I will clean my desk today.",jp:"ä»Šæ—¥ã¯æœºã‚’ç‰‡ã¥ã‘ã¾ã™ã€‚",hira:"ãã‚‡ã† ã¯ ã¤ããˆ ã‚’ ã‹ãŸã¥ã‘ ã¾ã™"},
{en:"I will speak more English.",jp:"ã‚‚ã£ã¨è‹±èªã‚’è©±ã—ã¾ã™ã€‚",hira:"ã‚‚ã£ã¨ ãˆã„ã” ã‚’ ã¯ãªã— ã¾ã™"},
{en:"I will make a new friend.",jp:"æ–°ã—ã„å‹ã ã¡ã‚’ä½œã‚Šã¾ã™ã€‚",hira:"ã‚ãŸã‚‰ã—ã„ ã¨ã‚‚ã ã¡ ã‚’ ã¤ãã‚Š ã¾ã™"},
{en:"I will not be late anymore.",jp:"ã‚‚ã†é…åˆ»ã—ã¾ã›ã‚“ã€‚",hira:"ã‚‚ã† ã¡ã“ã ã—ã¾ã›ã‚“"},
{en:"I will listen carefully in class.",jp:"æˆæ¥­ã§ã—ã£ã‹ã‚Šèãã¾ã™ã€‚",hira:"ã˜ã‚…ãã‚‡ã† ã§ ã—ã£ã‹ã‚Š ãã ã¾ã™"},
{en:"I will read more books.",jp:"ã‚‚ã£ã¨æœ¬ã‚’èª­ã¿ã¾ã™ã€‚",hira:"ã‚‚ã£ã¨ ã»ã‚“ ã‚’ ã‚ˆã¿ ã¾ã™"},
{en:"I will write in my diary every week.",jp:"æ¯é€±æ—¥è¨˜ã‚’æ›¸ãã¾ã™ã€‚",hira:"ã¾ã„ã—ã‚…ã† ã«ã£ã ã‚’ ã‹ã ã¾ã™"},
{en:"I will enjoy learning.",jp:"å­¦ã¶ã“ã¨ã‚’æ¥½ã—ã¿ã¾ã™ã€‚",hira:"ã¾ãªã¶ ã“ã¨ ã‚’ ãŸã®ã—ã¿ ã¾ã™"},
{en:"I will try new things.",jp:"æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã—ã¾ã™ã€‚",hira:"ã‚ãŸã‚‰ã—ã„ ã“ã¨ ã« ã¡ã‚‡ã†ã›ã‚“ ã—ã¾ã™"},
{en:"I will help my friends.",jp:"å‹ã ã¡ã‚’åŠ©ã‘ã¾ã™ã€‚",hira:"ã¨ã‚‚ã ã¡ ã‚’ ãŸã™ã‘ ã¾ã™"},
{en:"I will eat more vegetables.",jp:"ã‚‚ã£ã¨é‡èœã‚’é£Ÿã¹ã¾ã™ã€‚",hira:"ã‚‚ã£ã¨ ã‚„ã•ã„ ã‚’ ãŸã¹ ã¾ã™"},
{en:"I will sleep early.",jp:"æ—©ãå¯ã¾ã™ã€‚",hira:"ã¯ã‚„ã ã­ ã¾ã™"},
{en:"I will do my homework first.",jp:"ã¾ãšå®¿é¡Œã‚’ã—ã¾ã™ã€‚",hira:"ã¾ãš ã—ã‚…ãã ã„ ã‚’ ã— ã¾ã™"},
{en:"I will be kind to everyone.",jp:"ã¿ã‚“ãªã«ã‚„ã•ã—ãã—ã¾ã™ã€‚",hira:"ã¿ã‚“ãª ã« ã‚„ã•ã—ã ã— ã¾ã™"}
];

// ğŸ”€ shuffle entire question order every time
shuffle(DATA);

let i=0,score=0,wrongMode=false,totalScore=0;
const jp=qs('#jp'),hira=qs('#hira'),bank=qs('#bank'),sent=qs('#sentence');
const check=qs('#checkBtn'),okWrap=qs('#okWrap'),okBtn=qs('#okBtn'),nextWrap=qs('#nextWrap'),nextBtn=qs('#nextBtn');
const playBtn=qs('#playBtn'),progress=qs('#progress'),fx=qs('#fx');
function qs(s){return document.querySelector(s)}

/* ğŸ”Š audio helpers */
function sfx(name){const a=new Audio(`assets/audio/${name}.mp3`);a.volume=1;a.play().catch(()=>{});}
function filename(en){return "audio/"+en.toLowerCase().replace(/[^a-z]/g,'')+".mp3";}
function playSage(en,onEnd){const a=new Audio(filename(en));let done=false;
a.onended=()=>{if(done)return;done=true;if(onEnd)onEnd();};
a.onerror=()=>{if(done)return;done=true;if(onEnd)onEnd();};
a.play().catch(()=>{if(!done){done=true;if(onEnd)onEnd();}});
setTimeout(()=>{if(!done){done=true;if(onEnd)onEnd();}},7000);}

/* âœ… update button states after any move (drag or tap) */
function updateAfterMove(){
  check.disabled = bank.children.length !== 0;
  if(wrongMode){
    okBtn.disabled = currentBuilt() !== currentCorrect();
  }
}

/* shared move helper */
function moveWordTo(area, word){
  area.appendChild(word);
  updateAfterMove();
}

function mount(){
  bank.innerHTML='';sent.innerHTML='';sent.appendChild(playBtn);
  playBtn.classList.remove('show');wrongMode=false;
  okWrap.style.display='none';nextWrap.style.display='none';
  okBtn.disabled=true;check.disabled=true;check.style.display='block';
  const item=DATA[i];jp.textContent=item.jp;hira.textContent=item.hira;
  const words=item.en.trim().split(/\s+/);shuffle(words).forEach((w,idx)=>{
    const b=document.createElement('button');b.textContent=w;b.className='word';
    b.style.setProperty('--color',chipColor(idx));
    b.draggable=true;

    /* desktop drag start/end */
    b.addEventListener('dragstart',()=>b.classList.add('drag'));
    b.addEventListener('dragend',()=>b.classList.remove('drag'));

    /* ğŸ–ï¸ tap-to-move for mobile + desktop */
    b.addEventListener('click',()=>{
      const parent = b.parentElement;
      if(parent === bank){
        moveWordTo(sent, b);
      }else{
        moveWordTo(bank, b);
      }
    });

    bank.appendChild(b);
  });
  updateProgress();
  check.onclick=()=>{check.disabled=true;checkLogic();};
}

/* drop areas â€“ keep desktop drag & drop */
['bank','sentence'].forEach(id=>{
  const area=document.getElementById(id);
  area.addEventListener('dragover',e=>e.preventDefault());
  area.addEventListener('drop',e=>{
    e.preventDefault();
    const drag=document.querySelector('.drag');if(!drag)return;
    moveWordTo(area, drag);
  });
});

function currentBuilt(){return [...sent.querySelectorAll('.word')].map(e=>e.textContent).join(' ').trim();}
function currentCorrect(){return DATA[i].en.trim();}

function checkLogic(){
  const correct=currentCorrect(),built=currentBuilt();
  if(built===correct){
    if(!wrongMode){
      score++;sfx('sugoi');heartsBurst(sent);
      setTimeout(()=>{playSage(correct,()=>{nextWrap.style.display='block';});},1800);
    }else{
      okBtn.textContent="Next";okBtn.disabled=false;
    }
  }else{
    wrongMode=true;sfx('yada');smokeBurst(sent);
    playBtn.classList.add('show');
    [...sent.querySelectorAll('.word')].forEach(ch=>bank.appendChild(ch));
    check.style.display='none';okWrap.style.display='block';okBtn.disabled=true;
  }
}
okBtn.onclick=()=>{if(wrongMode&&okBtn.textContent==="Next"){next();}
  else if(wrongMode&&currentBuilt()===currentCorrect()){okBtn.textContent="Next";okBtn.disabled=false;}};
nextBtn.onclick=()=>next();playBtn.onclick=()=>{if(wrongMode)playSage(currentCorrect());};

function next(){i++;if(i>=DATA.length)return finish();mount();}
function finish(){document.getElementById('page-round').style.display='none';totalScore=score;showResults();}

/* FX */
function heartsBurst(el){const r=el.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2;
const radius=70;for(let n=0;n<5;n++){const angle=(-80+n*40)*Math.PI/180;
const dx=Math.cos(angle)*radius+(Math.random()*8-4);
const up=60+Math.random()*40;const h=document.createElement('div');h.className='heart';h.textContent='â¤';
h.style.left=cx+'px';h.style.top=cy+'px';h.style.setProperty('--dx',dx+'px');h.style.setProperty('--up',up+'px');
fx.appendChild(h);setTimeout(()=>h.remove(),1800);}}
function smokeBurst(el){const r=el.getBoundingClientRect(),cx=r.left+r.width/2,cy=r.top+r.height/2;
for(let k=0;k<3;k++){const s=document.createElement('div');s.className='smoke';const w=70+Math.random()*20;
s.style.setProperty('--w',w+'px');s.style.setProperty('--h',w+'px');s.style.left=cx+'px';s.style.top=cy+'px';
s.style.setProperty('--sx',(Math.random()<.5?-1:1)*(15+Math.random()*25)+'px');
s.style.setProperty('--up',(30+Math.random()*35)+'px');fx.appendChild(s);setTimeout(()=>s.remove(),1800);}}
function chipColor(n){const c=["#ff6ec7","#5ee6ff","#ffd166","#8aff80","#c77dff","#fff680","#ff9a8b","#9bffb7","#7cc6ff","#f7a6ff"];return c[n%c.length];}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function updateProgress(){progress.textContent=`${i+1} / ${DATA.length}`;}
mount();

/* RESULTS */
function $(sel){return document.querySelector(sel);}
function showResults(){
  $("#page-results").style.display="flex";
  const pct=Math.round((totalScore/15)*100);
  const msgEl=$("#resultMsg"),scoreEl=$("#resultScore");
  let bg="blueGlow",msg="ã„ã„ã­ï¼ã‚ã¨å°‘ã—ã§ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼",snd=$("#s_r1114");
  if(totalScore<=5){bg="redGlow";msg="ãƒ–ãƒ¼ãƒªã‚­ãƒ¥ãƒ©ãƒ è¦‹ã¦ãªã„ã§ã—ã‚‡ï¼";snd=$("#s_r05");}
  else if(totalScore<=10){bg="orangeGlow";msg="YouTubeè¦‹ã™ãï¼ãƒ–ãƒ¼ãƒªã‚­ãƒ¥ãƒ©ãƒ ã‚‚ã‚„ã‚ã†ï¼";snd=$("#s_r610");}
  else if(totalScore===15){bg="goldGlow";msg="ã™ã”ã„ï¼ã‚ãªãŸã¯åœ°çƒã§ä¸€ç•ªé ­ãŒã„ã„ï¼";snd=$("#s_r15");}
  document.body.className=bg;
  msgEl.textContent=msg;
  scoreEl.textContent=`${totalScore}/15ï¼ˆ${pct}%ï¼‰`;
  try{snd.currentTime=0;snd.play();}catch(e){}
  if(totalScore===15){
    for(let i=0;i<160;i++){
      setTimeout(()=>{
        const c=document.createElement("div");
        c.className="confetti";
        c.style.left=(Math.random()*100)+"vw";
        c.style.background=`hsl(${Math.random()*360},100%,60%)`;
        c.style.animationDuration=(0.9+Math.random()*0.9)+"s";
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1900);
      },i*10);
    }
  }
}

/* ---------- HELP MODAL ---------- */
const helpBtn=document.querySelector('#helpBtn');
const helpModal=document.querySelector('#helpModal');
if(helpBtn && helpModal){
  const closeEls=helpModal.querySelectorAll('[data-close-help]');
  const openHelp=()=>{helpModal.classList.add('show');helpModal.setAttribute('aria-hidden','false');};
  const closeHelp=()=>{helpModal.classList.remove('show');helpModal.setAttribute('aria-hidden','true');};
  helpBtn.addEventListener('click',openHelp);
  closeEls.forEach(el=>el.addEventListener('click',closeHelp));
  helpModal.addEventListener('click',e=>{if(e.target===helpModal)closeHelp();});
  document.addEventListener('keydown',e=>{if(e.key==='Escape')closeHelp();});
}
</script>
</body>
</html>
