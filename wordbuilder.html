<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Word Builder ‚Äì January Week 1</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26;
  --green:#22c55e; --red:#ef4444; --purple:#7c3aed;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg); color:var(--ink);
  font-family:system-ui,'Noto Sans JP',sans-serif;
  min-height:100vh; display:flex; flex-direction:column; overflow:hidden;
}

/* Global overlays */
#overlay{position:fixed; inset:0; pointer-events:none; z-index:9999}
.flashRed{
  position:fixed; inset:0; background:rgba(255,0,0,.35);
  animation:flash .35s ease; pointer-events:none; z-index:9998;
}
@keyframes flash{0%{opacity:.0}40%{opacity:1}100%{opacity:0}}

/* Header */
header{text-align:center;padding:18px 16px 8px;position:relative;z-index:5}
header h1,header h2,header h3{font-family:'Cinzel',serif}
header h2{font-size:clamp(2rem,6vw,3rem);margin-top:4px}
header h3{margin-top:6px;opacity:.9}

/* Play (above header; fizzle behind triangle) */
.playWrap{position:relative;z-index:10000;display:flex;flex-direction:column;align-items:center;margin-top:10px}
.playBtn{
  appearance:none;border:none;cursor:pointer;width:240px;height:240px;border-radius:50%;
  display:grid;place-items:center;font-size:6rem;font-weight:900;color:#0b1530;
  background:conic-gradient(from 0deg,#ff007f,#ff7f00,#ffff00,#00ff00,#00ffff,#007fff,#ff00ff,#ff007f);
  box-shadow:0 0 80px #ff00ff88,0 0 150px #00ffff66;
  animation:rgbSpin 4s linear infinite,pulse 2s ease-in-out infinite;
  position:relative;overflow:hidden;z-index:10001;
}
.playBtn::before,.playBtn::after{content:"";position:absolute;inset:0;border-radius:50%;pointer-events:none}
.playBtn.fizzy::before{
  background:
    radial-gradient(circle at 25% 75%,rgba(255,255,255,.6),transparent 60%),
    radial-gradient(circle at 75% 25%,rgba(255,255,255,.4),transparent 60%),
    radial-gradient(circle at 50% 50%,rgba(255,255,255,.3),transparent 60%);
  animation:fizzmove .35s infinite linear; z-index:0; /* behind ‚ñ∂ */
}
.playBtn.fizzy::after{
  box-shadow:0 0 40px 10px #fff8,0 0 90px 20px #00ffff99;
  animation:fizzglow .25s ease-in-out infinite alternate; z-index:0; /* behind ‚ñ∂ */
}
.playBtn span{position:relative;z-index:5;transform:translateX(4px)}
@keyframes rgbSpin{to{filter:hue-rotate(360deg)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
@keyframes fizzmove{0%{transform:translate(0,0) rotate(0)}50%{transform:translate(-4px,-4px) rotate(180deg)}100%{transform:translate(0,0) rotate(360deg)}}
@keyframes fizzglow{0%{opacity:.4;filter:blur(3px)}100%{opacity:1;filter:blur(7px)}}

/* Main centered layout */
main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px}

/* Drag area (no box), lighter slots */
.dropZone,.bank{display:flex;gap:18px;justify-content:center;flex-wrap:wrap}
.slot,.tile{
  width:96px;height:96px;border-radius:18px;display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:54px;transition:box-shadow .15s, background .15s, transform .15s;
}
.slot{
  border:2px dashed #ffffff3a;         /* lighter border */
  background:#27306b99;                /* lighter base than before */
}
.slot.filled{
  background:#2a2f6b;                  /* slightly darker when filled */
  border-color:#fff9;
  box-shadow:0 0 12px #facc15, 0 0 28px #fde68a66; /* steady gold */
}
.slot.gold{ /* kept for steady gold if needed elsewhere */
  background:#2a2f6b;
  border-color:#ffd54a;
  box-shadow:0 0 18px #ffd54a,0 0 32px #ffe59966;
}

.tile{
  background:#1b2046;border:1px solid #8690ff33;box-shadow:0 8px 14px rgba(0,0,0,.28);
  cursor:grab;color:#fff
}

/* Controls + Next + counter under buttons */
.controls{display:flex;gap:12px;justify-content:center;margin-top:10px}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 20px;border-radius:14px;font-weight:800;font-size:16px}
.btn.primary{background:linear-gradient(135deg,#a78bfa,#7c3aed);color:#fff;box-shadow:0 0 20px #7c3aed66}
#nextWrap{display:none;flex-direction:column;align-items:center;margin-top:14px}
#nextBtn{
  appearance:none;border:none;cursor:pointer;
  padding:12px 24px;border-radius:14px;font-weight:900;font-size:18px;color:#fff;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  box-shadow:0 0 20px #16a34a80,0 0 40px #22c55e55;
  animation:nextPulse 1.4s ease-in-out infinite;
}
@keyframes nextPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
#progressCount{margin-top:10px;font-weight:700;font-size:1.1rem}

/* RGB slot cycle (unfilled only ‚Äî continuous) */
@keyframes slotGlow {0%{box-shadow:0 0 20px var(--c),0 0 40px color-mix(in oklab, var(--c) 60%, transparent)} 100%{box-shadow:0 0 20px var(--c),0 0 40px color-mix(in oklab, var(--c) 60%, transparent)}}

/* Hearts / Farts (brown, consistent point) */
@keyframes floatHeart{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-140px) scale(1.6);opacity:0}}
@keyframes fartCloud{0%{transform:scale(.6);opacity:0}40%{transform:scale(1.2);opacity:1}100%{transform:translateY(-60px) scale(1.6);opacity:0}}
.heart,.fart{position:absolute;font-size:36px;pointer-events:none}
.heart{color:#ff4fa6;animation:floatHeart 1.3s ease-out forwards}
.fart{color:#8B4513;animation:fartCloud 1.2s ease-out forwards} /* brown */

/* Results (minimal) */
#page-results{display:none;text-align:center;padding:60px 16px;min-height:60vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px}
#resultMsg{font-size:clamp(1.6rem,4vw,2rem);font-weight:900;text-shadow:0 0 10px rgba(255,255,255,.2)}
#resultScore{font-size:clamp(1.4rem,3.5vw,1.8rem);font-weight:700}
.redGlow{background:#2b0b0b}
.orangeGlow{background:#2b1a0b}
.blueGlow{background:#0b1530}
.goldGlow{background:#2b210b}
.confetti{position:fixed;top:-10vh;width:10px;height:16px;border-radius:2px;animation:fall linear both;z-index:9999}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}

/* Back to Menu (results only) */
#backMenu{
  position:fixed;top:14px;left:14px;z-index:10000;
  padding:8px 12px;border-radius:12px;border:1px solid #ffffff30;
  background:#0b1530cc;color:#fff;font-weight:800;backdrop-filter:blur(6px);
  display:none;
}

footer{text-align:center;padding:16px;font-family:'Cinzel',serif;font-size:.95rem;opacity:.85;border-top:1px solid var(--outline)}
</style>
</head>
<body>
<div id="overlay"></div>
<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>WORD BUILDER</h2>
  <h3>January Week 1 ‚Äì ÔºëÊúàÁ¨¨ÔºëÈÄ±</h3>
</header>

<div class="playWrap" id="playWrap">
  <button class="playBtn" id="playBtn"><span>‚ñ∂</span></button>
</div>

<main id="page-round">
  <div class="dropZone" id="dropZone"></div>
  <div class="bank" id="bank"></div>
  <div class="controls">
    <button class="btn primary" id="checkBtn" disabled>CHECK</button>
  </div>
  <div id="nextWrap"><button id="nextBtn">Next / „Å§„Åé„Å∏</button></div>
  <div id="progressCount">1 / 15</div>
</main>

<section id="page-results">
  <h2>RESULTS / „É™„Ç∂„É´„Éà</h2>
  <div id="resultMsg">„ÅÑ„ÅÑ„Å≠ÔºÅ„ÅÇ„Å®Â∞ë„Åó„Åß„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ</div>
  <div id="resultScore">0/15Ôºà0%Ôºâ</div>
</section>

<button id="backMenu" onclick="location.href='index.html'">‚Üê Back to Menu</button>

<footer>BRYAN'S ENGLISH SCHOOL</footer>

<script>
const $=s=>document.querySelector(s);
const MASTER=["goal","plan","future","dream","challenge","try","change","habit","exercise","study","learn","practice","success","focus","motivation"];
let index=0,totalScore=0,firstTry=true;

const drop=$("#dropZone"),bank=$("#bank"),play=$("#playBtn"),check=$("#checkBtn");
const nextWrap=$("#nextWrap"),nextBtn=$("#nextBtn"),progressCount=$("#progressCount");
const overlay=$("#overlay"),pageRound=$("#page-round"),pageResults=$("#page-results");
const playWrap=$("#playWrap");
const backMenu=$("#backMenu");

/* Audio (local) */
const sfx={ding:new Audio('assets/audio/ding.mp3'), fart:new Audio('assets/audio/fart.mp3')};
Object.values(sfx).forEach(a=>a.preload='auto');
const sage=new Map();
MASTER.forEach(w=>{const a=new Audio(`audio/${w}.mp3`);a.preload='auto';a.loop=false;sage.set(w,a);});

/* Speak every click; fizzle behind triangle */
function speak(){
  const w=MASTER[index], a=sage.get(w);
  if(!a) return;
  a.currentTime=0; play.classList.add("fizzy");
  a.play().catch(()=>{});
  a.onended=()=>play.classList.remove("fizzy");
}
play.addEventListener("click", speak);

/* Effects */
function spawnHeart(x,y){
  const h=document.createElement("div");
  h.className="heart"; h.textContent="‚ù§Ô∏è";
  h.style.left=x+"px"; h.style.top=y+"px";
  overlay.appendChild(h); setTimeout(()=>h.remove(),1300);
}
function spawnFart(x,y){
  const f=document.createElement("div");
  f.className="fart"; f.textContent="üí®";
  f.style.left=x+"px"; f.style.top=y+"px";
  overlay.appendChild(f); setTimeout(()=>f.remove(),1200);
}
/* Screen blink red on incorrect */
function flashRedScreen(){
  const el=document.createElement('div');
  el.className='flashRed';
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),400);
}

/* RGB cycle for unfilled slots (continuous) */
const glowColors=['#a78bfa','#22c55e','#3b82f6','#f59e0b','#ef4444','#f472b6'];
let glowIdx=0;
setInterval(()=>{
  const slots=[...drop.children];
  if(!slots.length) return;
  // clear unfilled
  slots.forEach(s=>{
    if(!s.classList.contains('filled')){
      s.style.boxShadow='none';
      s.classList.remove('gold'); // ensure only filled get steady gold
    }
  });
  // find next unfilled to glow
  let i=glowIdx, count=0;
  while(count<slots.length && slots[i%slots.length].classList.contains('filled')){ i++; count++; }
  const target=slots[i%slots.length];
  if(target && !target.classList.contains('filled')){
    const c=glowColors[i%glowColors.length];
    target.style.boxShadow=`0 0 20px ${c},0 0 40px ${c}66`;
    glowIdx=(i+1)%slots.length;
  }
}, 480);

/* Drag & drop with auto-snap and return */
function attachTileDnD(tile){
  tile.draggable=true;
  tile.addEventListener("dragstart",e=>{
    e.dataTransfer.setData("text/plain",tile.id);
    requestAnimationFrame(()=>tile.style.opacity=".7");
  });
  tile.addEventListener("dragend",()=>{ tile.style.opacity="1"; enableCheck(); });
  tile.addEventListener("pointerdown",e=>{
    tile.setPointerCapture(e.pointerId);
    const rect=tile.getBoundingClientRect(), ox=e.clientX-rect.left, oy=e.clientY-rect.top;
    const move=ev=>{
      tile.style.position="fixed";
      tile.style.left=(ev.clientX-ox)+"px";
      tile.style.top=(ev.clientY-oy)+"px";
      tile.style.zIndex="1000";
    };
    const up=ev=>{
      tile.releasePointerCapture(e.pointerId);
      document.removeEventListener("pointermove",move);
      document.removeEventListener("pointerup",up);
      tile.style.position=""; tile.style.zIndex="";
      const el=document.elementFromPoint(ev.clientX,ev.clientY);
      const slot=el ? (el.classList?.contains("slot") ? el : el.closest?.(".slot")) : null;
      if(slot) placeTileInSlot(tile,slot);
      else bank.appendChild(tile);
      enableCheck();
    };
    document.addEventListener("pointermove",move);
    document.addEventListener("pointerup",up);
  });
}
function attachSlotDnD(slot){
  slot.addEventListener("dragover",e=>e.preventDefault());
  slot.addEventListener("drop",e=>{
    e.preventDefault();
    const id=e.dataTransfer.getData("text/plain");
    const t=document.getElementById(id);
    if(t) placeTileInSlot(t,slot);
  });
}
function placeTileInSlot(tile,slot){
  if(slot.firstChild) bank.appendChild(slot.firstChild);
  slot.appendChild(tile);
  slot.classList.add("filled","gold"); // steady gold on fill
  // steady gold visual (redundant but explicit)
  slot.style.boxShadow='0 0 18px #ffd54a,0 0 32px #ffe59966';
  enableCheck();
}
function enableCheck(){ check.disabled=!allFilled(); }
function allFilled(){ return [...drop.children].every(s=>s.firstChild); }
function currentAnswer(){ return [...drop.children].map(s=>s.firstChild?.textContent ?? "").join(""); }

/* Build */
function buildSlots(w){
  drop.innerHTML="";
  for(let i=0;i<w.length;i++){
    const s=document.createElement("div");
    s.className="slot"; attachSlotDnD(s); drop.appendChild(s);
  }
}
function buildBank(w){
  bank.innerHTML="";
  const chars=[...w]; let scr=[...chars];
  if(chars.length>1){ do{ scr.sort(()=>Math.random()-.5); } while(scr.join("")===w); }
  scr.forEach((ch,i)=>{
    const t=document.createElement("div");
    t.className="tile"; t.id=`tile-${Date.now()}-${i}`; t.textContent=ch;
    attachTileDnD(t); bank.appendChild(t);
  });
}

/* Round logic */
check.addEventListener("click",()=>{
  const ans=currentAnswer(), correct=MASTER[index];
  if(ans===correct){
    if(firstTry) totalScore++;
    try{ sfx.ding.currentTime=0; sfx.ding.play(); }catch{}
    // hearts from a consistent point on each tile (center-top)
    [...drop.querySelectorAll(".tile")].forEach(t=>{
      const r=t.getBoundingClientRect();
      spawnHeart(r.left + r.width/2, r.top);
    });
    nextWrap.style.display="flex";
    check.style.display="none";
  } else {
    firstTry=false;
    // screen blink red; fart sfx and brown fart from consistent point
    flashRedScreen();
    try{ sfx.fart.currentTime=0; sfx.fart.play(); }catch{}
    [...drop.children].forEach(s=>{
      if(s.firstChild){
        const t=s.firstChild;
        const r=t.getBoundingClientRect();
        spawnFart(r.left + r.width/2, r.top);
        t.style.background="#3b0f0f";
        setTimeout(()=>t.style.background="#1b2046",800);
        bank.appendChild(t);
      }
      s.classList.remove("filled","gold");
      s.style.boxShadow='';
    });
    enableCheck();
  }
});

nextBtn.addEventListener("click",()=>{
  index++; progressCount.textContent=`${Math.min(index+1,15)} / 15`;
  if(index>=MASTER.length){ showResults(); return; }
  loadCard();
});

/* Results (minimal screens + local audio) */
function showResults(){
  // hide game UI including Play button; show results + Back to Menu
  pageRound.style.display="none";
  playWrap.style.display="none";
  pageResults.style.display="flex";
  backMenu.style.display="inline-block";

  const pct=Math.round((totalScore/15)*100);
  const msg=$("#resultMsg"), score=$("#resultScore");
  let bg="blueGlow", file="result_11-14.mp3", text="„ÅÑ„ÅÑ„Å≠ÔºÅ„ÅÇ„Å®Â∞ë„Åó„Åß„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ";
  if(totalScore<=5){ bg="redGlow"; file="result_0-5.mp3"; text="„Éñ„Éº„É™„Ç≠„É•„É©„É†Ë¶ã„Å¶„Å™„ÅÑ„Åß„Åó„ÇáÔºÅ"; }
  else if(totalScore<=10){ bg="orangeGlow"; file="result_6-10.mp3"; text="YouTubeË¶ã„Åô„ÅéÔºÅ„Éñ„Éº„É™„Ç≠„É•„É©„É†„ÇÇ„ÇÑ„Çç„ÅÜÔºÅ"; }
  else if(totalScore===15){ bg="goldGlow"; file="result_15.mp3"; text="„Åô„Åî„ÅÑÔºÅ„ÅÇ„Å™„Åü„ÅØÂú∞ÁêÉ„Åß‰∏ÄÁï™È†≠„Åå„ÅÑ„ÅÑÔºÅ"; }

  document.body.className=bg;
  msg.textContent=text;
  score.textContent=`${totalScore}/15Ôºà${pct}%Ôºâ`;

  const snd=new Audio(`assets/audio/${file}`);
  snd.play().catch(()=>{});

  if(totalScore===15){
    for(let i=0;i<160;i++){
      setTimeout(()=>{
        const c=document.createElement("div");
        c.className="confetti";
        c.style.left=(Math.random()*100)+"vw";
        c.style.background=`hsl(${Math.random()*360},100%,60%)`;
        c.style.animationDuration=(0.9+Math.random()*0.9)+"s";
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1900);
      }, i*10);
    }
  }
}

/* Game init */
function loadCard(){
  const w=MASTER[index]; firstTry=true;
  buildSlots(w); buildBank(w);
  check.disabled=true; check.style.display="inline-block";
  nextWrap.style.display="none";
}
function initGame(){
  index=0; totalScore=0; firstTry=true;
  document.body.className="";
  pageResults.style.display="none";
  playWrap.style.display="flex";
  pageRound.style.display="flex";
  backMenu.style.display="none";
  progressCount.textContent="1 / 15";
  loadCard();
}
initGame();

/* Animations on page (for spec completeness) */
function noop(){}
</script>
</body>
</html>
