<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Word Builder – January Week 1</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26;
  --green:#22c55e; --red:#ef4444; --purple:#7c3aed;
  --gold:#ffd54a; --goldSoft:#ffe59966;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg); color:var(--ink);
  font-family:system-ui,'Noto Sans JP',sans-serif;
  min-height:100vh; display:flex; flex-direction:column; overflow:hidden;
  user-select:none; -webkit-user-select:none; -ms-user-select:none;
}

/* --- existing styles unchanged --- */
#overlay{position:fixed; inset:0; pointer-events:none; z-index:9999}
.flashRed{position:fixed; inset:0; background:rgba(255,0,0,.35);animation:flash .35s ease;pointer-events:none;z-index:9998}
@keyframes flash{0%{opacity:0}40%{opacity:1}100%{opacity:0}}

header{text-align:center;padding:18px 16px 8px;position:relative;z-index:5}
header h1,header h2,header h3{font-family:'Cinzel',serif}
header h2{font-size:clamp(2rem,6vw,3rem);margin-top:4px}
header h3{margin-top:6px;opacity:.9}

.playWrap{position:relative;z-index:10000;display:flex;flex-direction:column;align-items:center;margin-top:28px}
.playBtn{appearance:none;border:none;cursor:pointer;width:240px;height:240px;border-radius:50%;display:grid;place-items:center;font-size:6rem;font-weight:900;color:#0b1530;background:conic-gradient(from 0deg,#ff007f,#ff7f00,#ffff00,#00ff00,#00ffff,#007fff,#ff00ff,#ff007f);box-shadow:0 0 80px #ff00ff88,0 0 150px #00ffff66;animation:rgbSpin 4s linear infinite,pulse 2s ease-in-out infinite;position:relative;overflow:hidden;z-index:10001;}
.playBtn::before,.playBtn::after{content:"";position:absolute;inset:0;border-radius:50%;pointer-events:none}
.playBtn.fizzy::before{background:radial-gradient(circle at 25% 75%,rgba(255,255,255,.6),transparent 60%),radial-gradient(circle at 75% 25%,rgba(255,255,255,.4),transparent 60%),radial-gradient(circle at 50% 50%,rgba(255,255,255,.3),transparent 60%);animation:fizzmove .35s infinite linear;z-index:0}
.playBtn.fizzy::after{box-shadow:0 0 40px 10px #fff8,0 0 90px 20px #00ffff99;animation:fizzglow .25s ease-in-out infinite alternate;z-index:0}
.playBtn span{position:relative;z-index:5;transform:translateX(4px)}
@keyframes rgbSpin{to{filter:hue-rotate(360deg)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
@keyframes fizzmove{0%{transform:translate(0,0) rotate(0)}50%{transform:translate(-4px,-4px) rotate(180deg)}100%{transform:translate(0,0) rotate(360deg)}}
@keyframes fizzglow{0%{opacity:.4;filter:blur(3px)}100%{opacity:1;filter:blur(7px)}}
@keyframes rainbowPulse{0%{transform:scale(1);filter:hue-rotate(0deg) brightness(1.1);box-shadow:0 0 22px #ff00ff80,0 0 44px #ff7f0080;}25%{transform:scale(1.05);filter:hue-rotate(90deg) brightness(1.3);box-shadow:0 0 26px #00ffff99,0 0 52px #00ff8080;}50%{transform:scale(1.1);filter:hue-rotate(180deg) brightness(1.4);box-shadow:0 0 30px #00ffcc99,0 0 58px #ff00ff99;}75%{transform:scale(1.05);filter:hue-rotate(270deg) brightness(1.3);box-shadow:0 0 26px #ff007f99,0 0 52px #ffff0080;}100%{transform:scale(1);filter:hue-rotate(360deg) brightness(1.1);box-shadow:0 0 22px #ff00ff80,0 0 44px #ff7f0080;}}

main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px}
.dropZone,.bank{display:flex;gap:18px;justify-content:center;flex-wrap:wrap}
.slot,.tile{width:96px;height:96px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:54px;transition:box-shadow .15s, background .15s, transform .12s, filter .1s;}
.slot{border:2px dashed #ffffff3a;background:#27306b99;}
.slot.filled{background:#2a2f6b;border-color:#fff9;box-shadow:0 0 12px #facc15,0 0 28px #fde68a66;}
.slot.hover{border-color:#fff;box-shadow:0 0 22px #7dd3fc66,0 0 44px #a78bfa55;}

.tile{background:#1b2046;border:1px solid #8690ff33;box-shadow:0 8px 14px rgba(0,0,0,.28);color:#fff;touch-action:none;}
.tile.dragging{animation:rainbowPulse 1.2s linear infinite;filter:saturate(1.3) brightness(1.2);}
.tile.handled{filter:hue-rotate(var(--hue,0deg)) saturate(1.35) brightness(1.05);}
.tile.inSlot{box-shadow:0 0 18px var(--gold),0 0 32px var(--goldSoft);}
.aura{position:absolute;inset:0;pointer-events:none;overflow:visible;}
.spark{position:absolute;width:6px;height:6px;border-radius:50%;background:radial-gradient(circle,#fff 0%,#ffe49a 50%,transparent 70%);opacity:.9;animation:floatSpark linear infinite;}
@keyframes floatSpark{0%{transform:translate(var(--x0),var(--y0)) scale(1);opacity:0}10%{opacity:.85}50%{transform:translate(var(--x1),var(--y1)) scale(1.1);opacity:.9}90%{opacity:.85}100%{transform:translate(var(--x0),var(--y0)) scale(1);opacity:0}}

.controls{display:flex;gap:12px;justify-content:center;margin-top:10px}
.btn{appearance:none;border:none;cursor:pointer;padding:12px 20px;border-radius:14px;font-weight:800;font-size:16px}
.btn.primary{background:linear-gradient(135deg,#a78bfa,#7c3aed);color:#fff;box-shadow:0 0 20px #7c3aed66}
#nextWrap{display:none;flex-direction:column;align-items:center;margin-top:14px}
#nextBtn{appearance:none;border:none;cursor:pointer;padding:12px 24px;border-radius:14px;font-weight:900;font-size:18px;color:#fff;background:linear-gradient(135deg,#22c55e,#16a34a);box-shadow:0 0 20px #16a34a80,0 0 40px #22c55e55;animation:nextPulse 1.4s ease-in-out infinite;}
@keyframes nextPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.06)}}
#progressCount{margin-top:10px;font-weight:700;font-size:1.1rem}

.heart,.fart{position:fixed;font-size:36px;pointer-events:none}
.heart{color:#ff4fa6;animation:floatHeart 1.3s ease-out forwards}
.fart{color:#8B4513;animation:fartCloud 1.2s ease-out forwards}
@keyframes floatHeart{0%{transform:translateY(0) scale(1);opacity:1}100%{transform:translateY(-140px) scale(1.6);opacity:0}}
@keyframes fartCloud{0%{transform:scale(.6);opacity:0}40%{transform:scale(1.2);opacity:1}100%{transform:translateY(-60px) scale(1.6);opacity:0}}

#page-results{display:none;text-align:center;padding:60px 16px;min-height:60vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:22px}
#resultMsg{font-size:clamp(1.6rem,4vw,2rem);font-weight:900;text-shadow:0 0 10px rgba(255,255,255,.2)}
#resultScore{font-size:clamp(1.4rem,3.5vw,1.8rem);font-weight:700}
.redGlow{background:#2b0b0b}
.orangeGlow{background:#2b1a0b}
.blueGlow{background:#0b1530}
.goldGlow{background:#2b210b}
.confetti{position:fixed;top:-10vh;width:10px;height:16px;border-radius:2px;animation:fall linear both;z-index:9999}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg)}}

#backMenu{position:fixed;top:14px;left:14px;z-index:10000;padding:8px 12px;border-radius:12px;border:1px solid #ffffff30;background:#0b1530cc;color:#fff;font-weight:800;backdrop-filter:blur(6px);display:none;}
footer{text-align:center;padding:16px;font-family:'Cinzel',serif;font-size:.95rem;opacity:.85;border-top:1px solid var(--outline)}
</style>
</head>
<body>
<div id="overlay"></div>
<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>WORD BUILDER</h2>
  <h3>January Week 1 – １月第１週</h3>
</header>

<div class="playWrap" id="playWrap">
  <button class="playBtn" id="playBtn"><span>▶</span></button>
</div>

<main id="page-round">
  <div class="dropZone" id="dropZone"></div>
  <div class="bank" id="bank"></div>
  <div class="controls"><button class="btn primary" id="checkBtn" disabled>CHECK</button></div>
  <div id="nextWrap"><button id="nextBtn">Next / つぎへ</button></div>
  <div id="progressCount">1 / 15</div>
</main>

<section id="page-results">
  <h2>RESULTS / リザルト</h2>
  <div id="resultMsg">いいね！あと少しでパーフェクト！</div>
  <div id="resultScore">0/15（0%）</div>
</section>

<button id="backMenu" onclick="location.href='index.html'">← Back to Menu</button>
<footer>BRYAN'S ENGLISH SCHOOL</footer>

<script>
const $=s=>document.querySelector(s);
const MASTER=["goal","plan","future","dream","challenge","try","change","habit","exercise","study","learn","practice","success","focus","motivation"];
let index=0,totalScore=0,firstTry=true;

const drop=$("#dropZone"),bank=$("#bank"),play=$("#playBtn"),check=$("#checkBtn");
const nextWrap=$("#nextWrap"),nextBtn=$("#nextBtn"),progressCount=$("#progressCount");
const overlay=$("#overlay"),pageRound=$("#page-round"),pageResults=$("#page-results"),playWrap=$("#playWrap"),backMenu=$("#backMenu");

/* --- Audio etc. unchanged --- */
const sfx={ding:new Audio('assets/audio/ding.mp3'),fart:new Audio('assets/audio/fart.mp3'),r0_5:new Audio('assets/audio/result_0-5.mp3'),r6_10:new Audio('assets/audio/result_6-10.mp3'),r11_14:new Audio('assets/audio/result_11-14.mp3'),r15:new Audio('assets/audio/result_15.mp3')};
Object.values(sfx).forEach(a=>{a.preload='auto';a.load();});
function playSfx(a){try{a.currentTime=0;a.play().catch(()=>{});}catch{}}

const sage=new Map();
MASTER.forEach(w=>{const a=new Audio(`audio/${w}.mp3`);a.preload='auto';a.load();sage.set(w,a);});
function speak(){const w=MASTER[index],a=sage.get(w);if(!a)return;a.currentTime=0;play.classList.add("fizzy");a.play().catch(()=>{});a.onended=()=>play.classList.remove("fizzy");}
play.addEventListener("click",speak);

/* --- Aura --- */
function addAura(t){removeAura(t);const aura=document.createElement('div');aura.className='aura';for(let i=0;i<10;i++){const s=document.createElement('div');s.className='spark';const w=t.clientWidth,h=t.clientHeight;const x0=(Math.random()*w-w/2)+'px',y0=(Math.random()*h-h/2)+'px',x1=(Math.random()*w-w/2)+'px',y1=(Math.random()*h-h/2)+'px';s.style.setProperty('--x0',x0);s.style.setProperty('--y0',y0);s.style.setProperty('--x1',x1);s.style.setProperty('--y1',y1);s.style.left='50%';s.style.top='50%';s.style.animationDuration=(3.5+Math.random()*2.5)+'s';s.style.animationDelay=(Math.random()*2)+'s';aura.appendChild(s);}t.style.position='relative';t.appendChild(aura);}
function removeAura(t){const o=t.querySelector('.aura');if(o)o.remove();}

/* --- new SNAP DRAG LOGIC --- */
function attachTileControls(tile){
  tile.draggable=false;
  let startX=0,startY=0,offX=0,offY=0,moved=false;

  function onDown(e){
    tile.setPointerCapture(e.pointerId);
    const r=tile.getBoundingClientRect();
    startX=e.clientX;startY=e.clientY;
    offX=e.clientX-r.left;offY=e.clientY-r.top;
    moved=false;
    tile.classList.add("handled","dragging");
    tile.style.position="fixed";
    tile.style.left=r.left+"px";
    tile.style.top=r.top+"px";
    tile.style.zIndex=1000;
    document.addEventListener("pointermove",onMove);
    document.addEventListener("pointerup",onUp);
  }

  function onMove(e){
    moved=true;
    const nx=e.clientX-offX,ny=e.clientY-offY;
    tile.style.left=nx+"px";
    tile.style.top=ny+"px";
  }

  function onUp(e){
    try{tile.releasePointerCapture(e.pointerId);}catch{}
    document.removeEventListener("pointermove",onMove);
    document.removeEventListener("pointerup",onUp);
    tile.classList.remove("dragging");

    const el=document.elementFromPoint(e.clientX,e.clientY);
    const slot=el?.closest?.(".slot");
    const bankRect=bank.getBoundingClientRect();
    const overBank=e.clientX>bankRect.left&&e.clientX<bankRect.right&&e.clientY>bankRect.top&&e.clientY<bankRect.bottom;

    if(slot&&!slot.firstChild){
      slot.appendChild(tile);
      slot.classList.add("filled");
      tile.classList.add("inSlot");
      addAura(tile);
      // auto-snap to slot top center
      tile.style.position="absolute";
      tile.style.top="0";tile.style.left="50%";tile.style.transform="translateX(-50%)";
    }else if(overBank){
      sendToBank(tile);
    }else{
      sendToBank(tile);
    }
    enableCheck();
  }
  tile.addEventListener("pointerdown",onDown);
}

function sendToBank(tile){
  bank.appendChild(tile);
  tile.removeAttribute("style");
  tile.classList.remove("inSlot","handled");
  removeAura(tile);
  [...drop.children].forEach(s=>{if(!s.firstChild)s.classList.remove("filled");});
}

/* --- unchanged helpers, logic, results etc. --- */
function buildSlots(w){drop.innerHTML="";for(let i=0;i<w.length;i++){const s=document.createElement("div");s.className="slot";drop.appendChild(s);}}
function buildBank(w){bank.innerHTML="";const arr=[...w];let scr=[...arr];if(arr.length>1){do{scr.sort(()=>Math.random()-.5);}while(scr.join("")===w);}scr.forEach((ch,i)=>{const t=document.createElement("div");t.className="tile";t.textContent=ch;attachTileControls(t);bank.appendChild(t);});}
function enableCheck(){check.disabled=![...drop.children].every(s=>s.firstChild);}
function currentAnswer(){return[...drop.children].map(s=>s.firstChild?.textContent||"").join("");}

check.addEventListener("click",()=>{const ans=currentAnswer(),correct=MASTER[index];if(ans===correct){if(firstTry)totalScore++;playSfx(sfx.ding);[...drop.querySelectorAll(".tile")].forEach(t=>{const r=t.getBoundingClientRect();const h=document.createElement("div");h.className="heart";h.textContent="❤️";h.style.left=r.left+"px";h.style.top=r.top+"px";overlay.appendChild(h);setTimeout(()=>h.remove(),1300);});nextWrap.style.display="flex";check.style.display="none";}else{firstTry=false;playSfx(sfx.fart);const el=document.createElement("div");el.className="flashRed";document.body.appendChild(el);setTimeout(()=>el.remove(),400);[...drop.children].forEach(s=>{if(s.firstChild){const t=s.firstChild;const f=document.createElement("div");f.className="fart";f.textContent="💨";const r=t.getBoundingClientRect();f.style.left=r.left+"px";f.style.top=r.top+"px";overlay.appendChild(f);setTimeout(()=>f.remove(),1200);sendToBank(t);}s.classList.remove("filled");});enableCheck();}});

nextBtn.addEventListener("click",()=>{index++;progressCount.textContent=`${Math.min(index+1,15)} / 15`;if(index>=MASTER.length){showResults();return;}loadCard();});
function showResults(){pageRound.style.display="none";playWrap.style.display="none";pageResults.style.display="flex";backMenu.style.display="inline-block";const pct=Math.round((totalScore/15)*100);const msg=$("#resultMsg"),score=$("#resultScore");let bg="blueGlow",snd=sfx.r11_14,text="いいね！あと少しでパーフェクト！";if(totalScore<=5){bg="redGlow";snd=sfx.r0_5;text="ブーリキュラム見てないでしょ！";}else if(totalScore<=10){bg="orangeGlow";snd=sfx.r6_10;text="YouTube見すぎ！ブーリキュラムもやろう！";}else if(totalScore===15){bg="goldGlow";snd=sfx.r15;text="すごい！あなたは地球で一番頭がいい！";}document.body.className=bg;msg.textContent=text;score.textContent=`${totalScore}/15（${pct}%）`;playSfx(snd);if(totalScore===15){for(let i=0;i<160;i++){setTimeout(()=>{const c=document.createElement("div");c.className="confetti";c.style.left=Math.random()*100+"vw";c.style.background=`hsl(${Math.random()*360},100%,60%)`;c.style.animationDuration=(0.9+Math.random()*0.9)+"s";document.body.appendChild(c);setTimeout(()=>c.remove(),1900);},i*10);}}}
function loadCard(){const w=MASTER[index];firstTry=true;buildSlots(w);buildBank(w);check.disabled=true;check.style.display="inline-block";nextWrap.style.display="none";}
function initGame(){index=0;totalScore=0;firstTry=true;document.body.className="";pageResults.style.display="none";playWrap.style.display="flex";pageRound.style.display="flex";backMenu.style.display="none";progressCount.textContent="1 / 15";loadCard();}
initGame();
</script>
</body>
</html>
