<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Booha Word Builder – January Week 1</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1530; --ink:#fff; --outline:#ffffff26;
  --green:#22c55e; --red:#ef4444; --purple:#7c3aed;
  --gold:#ffd54a; --goldSoft:#ffe59966;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--bg); color:var(--ink);
  font-family:system-ui,'Noto Sans JP',sans-serif;
  min-height:100vh; display:flex; flex-direction:column; overflow:hidden;
  user-select:none; -webkit-user-select:none; -ms-user-select:none;
}

/* --------------------------------------------------- */
/* Energetic rainbow pulse animation while dragging    */
/* --------------------------------------------------- */
@keyframes rainbowPulse{
  0%{transform:scale(1);filter:hue-rotate(0deg) brightness(1.1);
      box-shadow:0 0 22px #ff00ff80,0 0 44px #ff7f0080;}
  25%{transform:scale(1.05);filter:hue-rotate(90deg) brightness(1.3);
      box-shadow:0 0 26px #00ffff99,0 0 52px #00ff8080;}
  50%{transform:scale(1.1);filter:hue-rotate(180deg) brightness(1.4);
      box-shadow:0 0 30px #00ffcc99,0 0 58px #ff00ff99;}
  75%{transform:scale(1.05);filter:hue-rotate(270deg) brightness(1.3);
      box-shadow:0 0 26px #ff007f99,0 0 52px #ffff0080;}
  100%{transform:scale(1);filter:hue-rotate(360deg) brightness(1.1);
      box-shadow:0 0 22px #ff00ff80,0 0 44px #ff7f0080;}
}

#overlay{position:fixed;inset:0;pointer-events:none;z-index:9999}
.flashRed{position:fixed;inset:0;background:rgba(255,0,0,.35);
  animation:flash .35s ease;pointer-events:none;z-index:9998;}
@keyframes flash{0%{opacity:.0}40%{opacity:1}100%{opacity:0}}

header{text-align:center;padding:18px 16px 8px;position:relative;z-index:5}
header h1,header h2,header h3{font-family:'Cinzel',serif}
header h2{font-size:clamp(2rem,6vw,3rem);margin-top:4px}
header h3{margin-top:6px;opacity:.9}

.playWrap{position:relative;z-index:10000;display:flex;flex-direction:column;align-items:center;margin-top:28px}
.playBtn{
  appearance:none;border:none;cursor:pointer;width:240px;height:240px;border-radius:50%;
  display:grid;place-items:center;font-size:6rem;font-weight:900;color:#0b1530;
  background:conic-gradient(from 0deg,#ff007f,#ff7f00,#ffff00,#00ff00,#00ffff,#007fff,#ff00ff,#ff007f);
  box-shadow:0 0 80px #ff00ff88,0 0 150px #00ffff66;
  animation:rgbSpin 4s linear infinite,pulse 2s ease-in-out infinite;
  position:relative;overflow:hidden;z-index:10001;
}
.playBtn span{position:relative;z-index:5;transform:translateX(4px)}
@keyframes rgbSpin{to{filter:hue-rotate(360deg)}}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px}
.dropZone,.bank{display:flex;gap:18px;justify-content:center;flex-wrap:wrap}
.slot,.tile{
  width:96px;height:96px;border-radius:18px;display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:54px;transition:box-shadow .15s,background .15s,transform .12s,filter .1s;
}
.slot{border:2px dashed #ffffff3a;background:#27306b99;}
.slot.filled{background:#2a2f6b;border-color:#fff9;
  box-shadow:0 0 12px #facc15,0 0 28px #fde68a66;}
.tile{
  background:#1b2046;border:1px solid #8690ff33;
  box-shadow:0 8px 14px rgba(0,0,0,.28);
  color:#fff;touch-action:none;
}
.tile:not(.dragging):not(.inSlot){background:#1b2046;}
.tile.dragging{animation:rainbowPulse 1.2s linear infinite;filter:saturate(1.3) brightness(1.2);}
.tile.inSlot{box-shadow:0 0 18px var(--gold),0 0 32px var(--goldSoft);}
.aura{position:absolute;inset:0;pointer-events:none;overflow:visible;}
.spark{position:absolute;width:6px;height:6px;border-radius:50%;
  background:radial-gradient(circle,#fff 0%,#ffe49a 50%,transparent 70%);
  opacity:.9;animation:floatSpark linear infinite;}
@keyframes floatSpark{
  0%{transform:translate(var(--x0),var(--y0)) scale(1);opacity:.0}
  10%{opacity:.85}
  50%{transform:translate(var(--x1),var(--y1)) scale(1.1);opacity:.9}
  90%{opacity:.85}
  100%{transform:translate(var(--x0),var(--y0)) scale(1);opacity:.0}
}

footer{text-align:center;padding:16px;font-family:'Cinzel',serif;font-size:.95rem;opacity:.85;border-top:1px solid var(--outline)}
</style>
</head>
<body>
<div id="overlay"></div>
<header>
  <h1>THE BOO-RICULUM</h1>
  <h2>WORD BUILDER</h2>
  <h3>January Week 1 – １月第１週</h3>
</header>

<div class="playWrap" id="playWrap">
  <button class="playBtn" id="playBtn"><span>▶</span></button>
</div>

<main id="page-round">
  <div class="dropZone" id="dropZone"></div>
  <div class="bank" id="bank"></div>
  <div class="controls">
    <button class="btn primary" id="checkBtn" disabled>CHECK</button>
  </div>
  <div id="nextWrap" style="display:none;"><button id="nextBtn">Next / つぎへ</button></div>
  <div id="progressCount">1 / 15</div>
</main>

<section id="page-results" style="display:none;text-align:center;padding:60px 16px;min-height:60vh;">
  <h2>RESULTS / リザルト</h2>
  <div id="resultMsg">いいね！あと少しでパーフェクト！</div>
  <div id="resultScore">0/15（0%）</div>
</section>

<button id="backMenu" style="display:none;position:fixed;top:14px;left:14px;">← Back to Menu</button>

<footer>BRYAN'S ENGLISH SCHOOL</footer>

<script>
const $=s=>document.querySelector(s);
let MASTER=["goal","plan","future","dream","challenge","try","change","habit","exercise","study","learn","practice","success","focus","motivation"];
MASTER.sort(()=>Math.random()-0.5);

let index=0,totalScore=0,firstTry=true;
const drop=$("#dropZone"),bank=$("#bank"),check=$("#checkBtn"),
      nextWrap=$("#nextWrap"),nextBtn=$("#nextBtn"),progressCount=$("#progressCount"),
      pageRound=$("#page-round"),pageResults=$("#page-results"),
      play=$("#playBtn"),playWrap=$("#playWrap"),backMenu=$("#backMenu"),overlay=$("#overlay");

/* Audio */
const sfx={ding:new Audio('assets/audio/ding.mp3'),fart:new Audio('assets/audio/fart.mp3')};
Object.values(sfx).forEach(a=>{a.preload='auto';a.load();});
function playSfx(a){try{a.currentTime=0;a.play().catch(()=>{});}catch{}}

/* Sage */
const sage=new Map();
MASTER.forEach(w=>{const a=new Audio(`audio/${w}.mp3`);a.preload='auto';a.load();sage.set(w,a);});
function speak(){const w=MASTER[index],a=sage.get(w);if(a){a.currentTime=0;a.play().catch(()=>{});}}
play.addEventListener("click",speak);

/* sparkles */
function addAura(tile){
  removeAura(tile);
  const aura=document.createElement('div');aura.className='aura';
  const c=10,w=tile.clientWidth,h=tile.clientHeight;
  for(let i=0;i<c;i++){
    const s=document.createElement('div');s.className='spark';
    const x0=(Math.random()*w - w/2)+"px",y0=(Math.random()*h - h/2)+"px";
    const x1=(Math.random()*w - w/2)+"px",y1=(Math.random()*h - h/2)+"px";
    const dur=(3.5+Math.random()*2.5)+'s';
    s.style.setProperty('--x0',x0);s.style.setProperty('--y0',y0);
    s.style.setProperty('--x1',x1);s.style.setProperty('--y1',y1);
    s.style.animationDuration=dur;s.style.animationDelay=(Math.random()*2)+'s';
    aura.appendChild(s);
  }
  tile.style.position='relative';tile.appendChild(aura);
}
function removeAura(t){const a=t.querySelector('.aura');if(a)a.remove();}

/* helpers */
function allFilled(){return[...drop.children].every(s=>s.firstChild);}
function currentAnswer(){return[...drop.children].map(s=>s.firstChild?.textContent??"").join("");}

/* pointer drag */
function attachTile(t){
  let startX=0,startY=0,offX=0,offY=0;
  t.addEventListener('pointerdown',e=>{
    t.setPointerCapture(e.pointerId);
    const r=t.getBoundingClientRect();
    startX=e.clientX;startY=e.clientY;offX=e.clientX-r.left;offY=e.clientY-r.top;
    t.classList.add('dragging');t.classList.remove('inSlot');removeAura(t);
    t.style.position='fixed';t.style.left=r.left+'px';t.style.top=r.top+'px';t.style.zIndex='1000';
    const move=ev=>{t.style.left=(ev.clientX-offX)+'px';t.style.top=(ev.clientY-offY)+'px';};
    const up=ev=>{
      document.removeEventListener('pointermove',move);
      document.removeEventListener('pointerup',up);
      t.style.position='';t.style.zIndex='';t.classList.remove('dragging');
      const el=document.elementFromPoint(ev.clientX,ev.clientY);
      const slot=el?(el.classList?.contains('slot')?el:el.closest?.('.slot')):null;
      const brect=bank.getBoundingClientRect();
      const overBank=(ev.clientX>brect.left&&ev.clientX<brect.right&&ev.clientY>brect.top&&ev.clientY<brect.bottom);
      if(slot){slot.appendChild(t);slot.classList.add('filled');t.classList.add('inSlot');addAura(t);}
      else if(overBank){bank.appendChild(t);t.classList.remove('inSlot');removeAura(t);}
      else{bank.appendChild(t);t.classList.remove('inSlot');removeAura(t);}
      enableCheck();
    };
    document.addEventListener('pointermove',move);
    document.addEventListener('pointerup',up);
  });
}

function enableCheck(){check.disabled=!allFilled();}

function buildSlots(w){drop.innerHTML="";for(let i=0;i<w.length;i++){const s=document.createElement('div');s.className='slot';drop.appendChild(s);}}
function buildBank(w){
  bank.innerHTML="";const chars=[...w];let scr=[...chars];
  if(chars.length>1){do{scr.sort(()=>Math.random()-.5);}while(scr.join("")===w);}
  scr.forEach(ch=>{
    const t=document.createElement('div');
    t.className='tile';t.textContent=ch;attachTile(t);bank.appendChild(t);
  });
}

/* --- game logic --- */
check.addEventListener('click',()=>{
  const ans=currentAnswer(),correct=MASTER[index];
  if(ans===correct){
    if(firstTry)totalScore++;
    playSfx(sfx.ding);
    [...drop.querySelectorAll('.tile')].forEach(addAura);
    nextWrap.style.display="flex";check.style.display="none";
  }else{
    firstTry=false;
    const el=document.createElement('div');el.className='flashRed';
    document.body.appendChild(el);setTimeout(()=>el.remove(),400);
    playSfx(sfx.fart);
    [...drop.children].forEach(s=>{
      if(s.firstChild){bank.appendChild(s.firstChild);}
      s.classList.remove('filled');
    });
    enableCheck();
  }
});

nextBtn.addEventListener('click',()=>{
  index++;progressCount.textContent=`${Math.min(index+1,15)} / 15`;
  if(index>=MASTER.length){showResults();return;}
  loadCard();
});

function showResults(){
  pageRound.style.display="none";playWrap.style.display="none";
  pageResults.style.display="flex";backMenu.style.display="inline-block";
  const pct=Math.round((totalScore/15)*100);
  const msg=$("#resultMsg"),score=$("#resultScore");
  let bg="blueGlow",file="result_11-14.mp3",text="いいね！あと少しでパーフェクト！";
  if(totalScore<=5){bg="redGlow";file="result_0-5.mp3";text="ブーリキュラム見てないでしょ！";}
  else if(totalScore<=10){bg="orangeGlow";file="result_6-10.mp3";text="YouTube見すぎ！ブーリキュラムもやろう！";}
  else if(totalScore===15){bg="goldGlow";file="result_15.mp3";text="すごい！あなたは地球で一番頭がいい！";}
  msg.textContent=text;score.textContent=`${totalScore}/15（${pct}%）`;
  const snd=new Audio(`assets/audio/${file}`);snd.play().catch(()=>{});
  if(totalScore===15){
    for(let i=0;i<160;i++){
      setTimeout(()=>{
        const c=document.createElement('div');
        c.className='confetti';
        c.style.left=(Math.random()*100)+'vw';
        c.style.background=`hsl(${Math.random()*360},100%,60%)`;
        c.style.position='fixed';
        c.style.top='-10px';c.style.width='10px';c.style.height='16px';
        c.style.borderRadius='2px';
        c.style.animation=`fall ${0.9+Math.random()*0.9}s linear forwards`;
        document.body.appendChild(c);
        setTimeout(()=>c.remove(),1900);
      },i*10);
    }
  }
}

function loadCard(){
  const w=MASTER[index];firstTry=true;
  buildSlots(w);buildBank(w);
  check.disabled=true;check.style.display="inline-block";
  nextWrap.style.display="none";
}

function init(){
  index=0;totalScore=0;firstTry=true;
  document.body.className="";
  pageResults.style.display="none";playWrap.style.display="flex";
  pageRound.style.display="flex";backMenu.style.display="none";
  progressCount.textContent="1 / 15";loadCard();
}
init();
</script>
</body>
</html>
